<!-- build time:Mon Feb 10 2025 22:46:08 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><script src="http://echarts.baidu.com/dist/echarts.common.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@4.7.0/map/js/china.min.js"></script><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="yandex-verification" content="fadb7324b0f3dbe2"><link rel="alternate" type="application/rss+xml" title="æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ ." href="https://flechazoclf.github.io/FlechazoCLF.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ ." href="https://flechazoclf.github.io/FlechazoCLF.github.io/atom.xml"><link rel="alternate" type="application/json" title="æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ ." href="https://flechazoclf.github.io/FlechazoCLF.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="AUTOSAR,åµŒå…¥å¼,è½¯ä»¶å¼€å‘"><link rel="canonical" href="https://flechazoclf.github.io/FlechazoCLF.github.io/archives/c9ca48bd.html"><title>å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement - AUTOSAR - æŠ€æœ¯æ•™ç¨‹ğŸƒ | flechazo = æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ . = æœ‰å¹¸æ¥åˆ°äººé—´çš„æ—…äºº</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2024-08-31 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2024-08-31T00:00:00+08:00">2024-08-31</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">flechazo</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/archives/c9ca48bd.html../../../wallpaper/11.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem"><a href="/categories/technique/" itemprop="item" rel="index" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ"><span itemprop="name">æŠ€æœ¯æ•™ç¨‹ğŸƒ</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem"><a href="/categories/technique/AUTOSAR/" itemprop="item" rel="index" title="åˆ†ç±»äº AUTOSAR"><span itemprop="name">AUTOSAR</span></a><meta itemprop="position" content="2"></span></div><article itemscope="" itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://flechazoclf.github.io/FlechazoCLF.github.io/archives/c9ca48bd.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="flechazo"><meta itemprop="description" content="æœ‰å¹¸æ¥åˆ°äººé—´çš„æ—…äºº, æˆ‘åœ¨äººé—´è´©å–æ˜Ÿå…‰"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ ."></span><div class="body md" itemprop="articleBody"><p></p><div class="links"><div class="item" title="ã€çŸ¥ä¹ã€‘flechazo" style="--block-color:#21d4fd"><span class="exturl image" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9qaXVfc2hlbmc=" data-background-image="https://foruda.gitee.com/avatar/1680342439464493317/9010997_flechazo5201314_1680342439.png!avatar200"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9qaXVfc2hlbmc=">ã€çŸ¥ä¹ã€‘flechazo</span><p class="desc">https://www.zhihu.com/people/jiu_sheng</p></div></div></div><p></p><p></p><div class="links"><div class="item" title="ã€CSDNã€‘å°æŸ´å¸¦ä½ å­¦AutoSaræ€»ç›®å½•" style="--block-color:#21d4fd"><span class="exturl image" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpYW5zaGFuZzUyMDEzL2FydGljbGUvZGV0YWlscy8xMzgxNDAyMzU/c3BtPTEwMDEuMjAxNC4zMDAxLjU1MDE=" data-background-image="https://foruda.gitee.com/avatar/1680342439464493317/9010997_flechazo5201314_1680342439.png!avatar200"></span><div class="info"><span class="exturl title" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpYW5zaGFuZzUyMDEzL2FydGljbGUvZGV0YWlscy8xMzgxNDAyMzU/c3BtPTEwMDEuMjAxNC4zMDAxLjU1MDE=">ã€CSDNã€‘å°æŸ´å¸¦ä½ å­¦AutoSaræ€»ç›®å½•</span><p class="desc">https://blog.csdn.net/qianshang52013/article/details/138140235?spm=1001.2014.3001.5501</p></div></div></div><p></p><p>Autosar ç³»åˆ—æ•™ç¨‹ï¼š<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3M/X19iaXo9TXpBeE9ETTJOVFEwTnc9PSZhbXA7bWlkPTIyNDc0OTIzMjYmYW1wO2lkeD0xJmFtcDtzbj1kNDdhYWM4YTE4MWJkZjM0NGNmMzJhOThmNzAxMjkyNyZhbXA7Y2hrc209OWJkNWNmOGVhY2EyNDY5ODgyMzcxZTEyOTY5Yzc3NzdiMDY1NGRiMGE3MDVlNWE1ZDNkZGFmNjRjODk5ZjhmYzUyYmRhNTM4MzczMiZhbXA7cGF5cmVhZHRpY2tldD1IQjBaZE1Tc3RNVmVRVXF2RkdBb2E1U2Q3Mnk2bzJOb192OF9PLUhsaXRxMHBaOWcxVzFablBrbmwwQmJySGZZajcxeUtkZyNyZA==">å°æŸ´å¸¦ä½ å­¦ AutoSar æ€»ç›®å½•</span></p><h1 id="å°æŸ´å¸¦ä½ å­¦autosarç³»åˆ—ä¸‰-æ ‡å‡†å’Œè§„èŒƒç¯‡3modemanagement"><a class="anchor" href="#å°æŸ´å¸¦ä½ å­¦autosarç³»åˆ—ä¸‰-æ ‡å‡†å’Œè§„èŒƒç¯‡3modemanagement">#</a> å°æŸ´å¸¦ä½ å­¦ AutoSar ç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement</h1><p>å®å­ä»¬ï¼Œæˆ‘æ¥å•¦</p><p>è™½è¿Ÿä½†åˆ°å“ˆå“ˆå“ˆğŸ˜œ</p><p>ä¸€ä¸ªäººçš„ç²¾åŠ›æœç„¶æ˜¯æœ‰é™çš„</p><p>æœ€è¿‘åœ¨æ¬å®¶å“ˆå“ˆå“ˆğŸ˜‹</p><p>åªè¦åšæŒä¸‹å»å°±å¯ä»¥æ‰“è´¥ 99.99% çš„äººäº†âœŒï¸</p><p>ä¸»æ‰“ä¸€ä¸ªé»˜é»˜æ— é—»</p><h1 id="modemanagementguide"><a class="anchor" href="#modemanagementguide">#</a> ModeManagementGuide</h1><h2 id="2-overall-mechanisms-and-concepts"><a class="anchor" href="#2-overall-mechanisms-and-concepts">#</a> 2 Overall mechanisms and concepts</h2><blockquote><p>A mode can be seen as the current state of an ECU1 wide, global variable, which is maintained by the RTE respectively the Schedule Manager.</p></blockquote><p>ä¸€ä¸ªä»£è¡¨ ECU å½“å‰çŠ¶æ€çš„å…¨å±€å˜é‡æ˜¯ç”± RTE å’Œè°ƒåº¦ç®¡ç†å™¨ç»´æŠ¤</p><blockquote><p>Modes can be used for different purposes.</p><p>First of all modes are used to synchronize Software Components and Basic Software Modules. Via modes specified triggers can be enabled and disabled, and consequently the activation of Executable Entitys can be prevented.</p><p>Also Executable Entitys can be triggered explicitely during a Mode Switch.</p><p>On the other hand mode switches can explicitly trigger executable entities during transition from one mode to another. For example the RTE can activate an OnEntry ExecutableEntity to initialize acertain resource before entering a specific mode. In this mode the triggers of this ExecutableEntity are activated. If the mode is left the OnExit ExecutableEntity is called, which could execute some cleanup code and the triggers would be deacti vated.</p></blockquote><p>æ¨¡å¼ç®¡ç†æœ‰å¦‚ä¸‹å‡ ä¸ªç›®çš„ï¼š</p><ul><li>å¯ä»¥åŒæ­¥ SWC å’Œ BSW<ul><li>é€šè¿‡ä½¿èƒ½å’Œå¤±èƒ½ç‰¹æ®Šçš„è§¦å‘å™¨æ¥æ‰§è¡Œæˆ–ç¦æ­¢ç›¸åº”çš„è¿è¡Œå®ä½“</li><li>æ­¤å¤–è¿è¡Œå®ä½“åœ¨æ¨¡å¼åˆ‡æ¢æœŸé—´æ˜¾ç¤ºè§¦å‘</li></ul></li></ul><p>è¿™é‡Œå¯¹è‡ªå·±å†™ä»£ç ä¹Ÿæœ‰ä¸€äº›æ„Ÿè§¦äº†ï¼Œå°±æ˜¯ä»£ç å†™å¥½ä¹‹åï¼Œé€šè¿‡æ¨¡å¼åˆ‡æ¢æ¥è§¦å‘å‡½æ•°ï¼Œè¿™æ ·æ¶æ„å¸ˆå°±å¯ä»¥å°†ä»£ç åˆ†é…ç»™ Coderï¼Œä¹‹åæ¶æ„å¸ˆé€šè¿‡æ¨¡å¼ç®¡ç†æ¥ç»„ç»‡ä»£ç çš„æ‰§è¡Œã€‚å½“ç„¶å•¦ï¼Œåˆå§‹åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªçŠ¶æ€åˆ‡æ¢å“¦ï¼</p><h3 id="21-declaration-of-modes"><a class="anchor" href="#21-declaration-of-modes">#</a> 2.1 Declaration of modes</h3><p>ä¾‹å¦‚ï¼š</p><blockquote><p>ECU state management there may exist the ModeDeclarations</p><ul><li>STARTUP,</li><li>RUN</li><li>POST_RUN</li><li>SLEEP</li></ul></blockquote><h3 id="22-mode-managers-and-mode-users"><a class="anchor" href="#22-mode-managers-and-mode-users">#</a> 2.2 Mode managers and mode users</h3><p>ä¸¤ä¸ªæ¨¡å¼ï¼šç®¡ç†è€…æ¨¡å¼ å’Œ ç”¨æˆ·æ¨¡å¼</p><blockquote><p>Responsible for switching modes are <em>Mode managers</em>, which are the only instances able to change the value of the global variable.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´è¦å•ç‹¬å°†æ¨¡å¼ç®¡ç†åšæˆè½¯ä»¶ç»„ä»¶çš„å½¢å¼</p><h3 id="23-modes-in-the-rte"><a class="anchor" href="#23-modes-in-the-rte">#</a> 2.3 Modes in the RTE</h3><p>æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ¨¡å¼ç®¡ç†æ¥å£</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240831180708672.png" alt="image-20240831180708672"></p><h3 id="24-modes-in-the-basic-software-scheduler"><a class="anchor" href="#24-modes-in-the-basic-software-scheduler">#</a> 2.4 Modes in the Basic Software Scheduler</h3><blockquote><p>Another possibility for a Basic Software Module acting as a Mode user to get informed about mode switches, is to register a BSW Module Entry, which is triggered by a Mode Switch Event (see also [3]).</p></blockquote><p>è¿™é‡Œä¹Ÿæœ‰å¦ä¸€ç§è®¾æƒ³ï¼Œæ¨¡å¼çš„åˆ‡æ¢çš„é€»è¾‘éƒ½æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥å°†æ¨¡å¼å’Œæ¨¡å¼çš„å…¥å£å‡ºå£éƒ½é€šè¿‡æ³¨å†Œçš„æœºåˆ¶æ¥å¤„ç†ï¼Œè¿™æ ·å°±æ— éœ€å†å¤šå†™æ¨¡å¼åˆ‡æ¢çš„é€»è¾‘äº†ã€‚è¯´å¹²å°±å¹²<a href="">ä¹‹åä¼šè®¾è®¡ä¸€ä¸ªæ³¨å†Œæœºåˆ¶çš„æ¨¡å¼ç®¡ç†æ¡†æ¶</a></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240807115103069.png" alt="image-20240807115103069"></p><h3 id="25-communication-of-modes"><a class="anchor" href="#25-communication-of-modes">#</a> 2.5 Communication of modes</h3><p>åˆ†ä¸ºï¼š</p><ul><li>Mode Switch</li><li>Mode Request</li></ul><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240831180853675.png" alt="image-20240831180853675"></p><h2 id="3-configuration-of-the-basic-software-modemanager"><a class="anchor" href="#3-configuration-of-the-basic-software-modemanager">#</a> 3 Configuration of the Basic Software Modemanager</h2><h3 id="32-semantics-of-bswm-configuration-interfaces-and-behavioral-aspects"><a class="anchor" href="#32-semantics-of-bswm-configuration-interfaces-and-behavioral-aspects">#</a> 3.2 Semantics of BswM Configuration: Interfaces and behavioral aspects</h3><blockquote><p>In general the BswM can be seen as a state machine, which is defined by its interface and a behavioral description. The input actions of this state machine are mode requests. Each mode request is described in the ECU configuration of the BswM as a BswMModeRequestSource. These mode requests can be of different types (C-API calls, mode requests via RTE, mode notifications via RTE, etc.) but internally they are treated in the same way.</p><p>If a mode is requested the internal mirror of this BswMModeRequestSource is updated and depending on the configuration a rule evaluation is triggered, which results in the execution of predefined action lists. Action lists group Actions. Typically an action is a triggering of a mode switch in the RTE or Schedule Manager, but there are also predefined actions which change the status of some Basic Software Module.</p></blockquote><p>æ€»çš„æ¥è¯´ï¼ŒBswM å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒç”±å…¶æ¥å£å’Œè¡Œä¸ºæè¿°å®šä¹‰è¯¥çŠ¶æ€æœºçš„è¾“å…¥æ“ä½œæ˜¯æ¨¡å¼è¯·æ±‚ã€‚æ¯ä¸ªæ¨¡å¼è¯·æ±‚åœ¨ BswM çš„ ECU é…ç½®ä¸­ä½œä¸º BswMModeRequestSource è¿›è¡Œæè¿°ã€‚è¿™äº›æ¨¡å¼è¯·æ±‚å¯ä»¥æ˜¯ä¸åŒç±»å‹ (C-API è°ƒç”¨ï¼Œé€šè¿‡ RTE å‘é€çš„æ¨¡å¼è¯·æ±‚ï¼Œé€šè¿‡ RTE å‘é€æ¨¡å¼é€šçŸ¥ç­‰)ï¼Œä½†å®ƒä»¬åœ¨å†…éƒ¨ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†ã€‚<br>å¦‚æœè¯·æ±‚æ¨¡å¼ï¼Œåˆ™æ­¤ BswMModeRequestSource çš„å†…éƒ¨é•œåƒå°†è¿›è¡Œæ›´æ–°å¹¶ä¸”æ ¹æ®é…ç½®è§¦å‘è§„åˆ™è¯„ä¼°ï¼Œä»è€Œå¯¼è‡´æ‰§è¡Œé¢„å®šä¹‰çš„åŠ¨ä½œåˆ—è¡¨ã€‚åŠ¨ä½œåˆ—è¡¨å°†åŠ¨ä½œåˆ†ç»„ã€‚é€šå¸¸ï¼ŒåŠ¨ä½œæ˜¯è§¦å‘ RTE æˆ–è°ƒåº¦ç®¡ç†å™¨ä¸­çš„æ¨¡å¼åˆ‡æ¢ï¼Œä½†ä¹Ÿæœ‰é¢„å®šä¹‰çš„åŠ¨ä½œï¼Œå¯ä»¥æ›´æ”¹æŸäº›åŸºæœ¬è½¯ä»¶æ¨¡å—çš„çŠ¶æ€ã€‚</p><p><strong>Interface of the BswM</strong></p><blockquote><p>The interface is defined by the BswMModeRequestSource and the BswMActionListItem containers.</p></blockquote><p>BswM çš„æ¥å£æœ‰ä¸¤ä¸ª</p><ul><li>BswMModeRequestSource</li><li>BswMActionListItem</li></ul><p><strong>Mode Requests</strong></p><p>BswMModeRequestSource æ˜¯ä¸€ä¸ªå¯é€‰çš„å®¹å™¨</p><p><strong>Available Actions</strong></p><p>ä¼ªä»£ç </p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token function">EcuM_SetState</span><span class="token punctuation">(</span>EcuM_StateType State<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>modeGroup EcuM_StateType <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    ECUM_STATE_STARTUP<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    ECUM_STATE_APP_RUN<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    ECUM_STATE_APP_POST_RUN<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    ECUM_STATE_SHUTDOWN<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    ECUM_STATE_SLEEP</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>åé¢åˆä¸€å †æ— èŠçš„ä¼ªä»£ç </p><p><strong>Configuration of the BswM behavior</strong></p><blockquote><p>The behavior of the BswM is specified via rules and action lists. A rule is a logical expression, which combines the current values of ModeRequestTypeMaps. The evaluation of each rule either results in the execution of its true or false action lists.</p></blockquote><p>BswM çš„è¡Œä¸ºæ˜¯é€šè¿‡è§„åˆ™å’Œæ“ä½œåˆ—è¡¨æ¥æŒ‡å®šçš„ã€‚è§„åˆ™æ˜¯ä¸€ä¸ªé€»è¾‘è¡¨è¾¾å¼ï¼Œå®ƒç»“åˆäº† ModeRequestTypeMaps çš„å½“å‰å€¼ã€‚å¯¹æ¯ä¸ªè§„åˆ™çš„è¯„ä¼°è¦ä¹ˆå¯¼è‡´å…¶çœŸæˆ–å‡æ“ä½œåˆ—è¡¨çš„æ‰§è¡Œã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240807151000055.png" alt="image-20240807151000055"></p><blockquote><p>The ModeControlContainer contains these ActionLists. An ActionList can consist of a set of atomic actions, other â€œnestedâ€ ActionLists or it can reference (nested) rules which are then evaluated in the context of this Actionlist.</p></blockquote><p>ModeControlcontainer åŒ…å«è¿™äº› ActionListsã€‚ActionList å¯ä»¥ç”±ä¸€ç»„åŸå­æ“ä½œã€å…¶ä»– â€œåµŒå¥— ActionLists æˆ–å¼•ç”¨ (åµŒå¥—) è§„åˆ™ç»„æˆï¼Œç„¶ååœ¨æ­¤ Actionlist çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè¯„ä¼°ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240807151015607.png" alt="image-20240807151015607"></p><h3 id="33-ecu-state-management"><a class="anchor" href="#33-ecu-state-management">#</a> 3.3 ECU state management</h3><blockquote><p>During startup and shutdown the task of the BswM is to initialize all basic software modules in a similar way as it is done by the ECUM in older AUTOSAR releases. To achieve this the following ModeDeclarationGroup is defined, which indicates the overall state of the ECU to application software components and is used for internal rule arbitration.</p></blockquote><p>åœ¨å¯åŠ¨å’Œå…³é—­æœŸé—´ï¼ŒBswM çš„ä»»åŠ¡æ˜¯åˆå§‹åŒ–æ‰€æœ‰åŸºæœ¬è½¯ä»¶æ¨¡å—ï¼Œå…¶æ–¹å¼ä¸æ—©æœŸ AUTOSAR ç‰ˆæœ¬ä¸­çš„ ECUM ç±»ä¼¼ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹å®šä¹‰äº†ä»¥ä¸‹ ModeDeclarationGroupï¼Œå®ƒæŒ‡ç¤º ECU å¯¹åº”ç”¨è½¯ä»¶ç»„ä»¶çš„æ€»ä½“çŠ¶æ€ï¼Œå¹¶ç”¨äºå†…éƒ¨è§„åˆ™ä»²è£ã€‚</p><pre><code class="language-C">modeGroup MDG_EcuMode {
    ECU_RUN,
    ECU_APP_RUN,
    ECU_APP_POST_RUN,
    ECU_GO_SLEEP,
    ECU_GO_OFF_ONE,
    ECU_SLEEP,
    ECU_GO_OFF_TWO,
    ECU_STARTUP_ONE,
    ECU_STARTUP_TWO,
    ECU_RESET_READY
}
interface modeSwitch MSIF_EcuMode {
    mode MDG_EcuMode ecuMode
}
</code></pre><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240807180720010.png" alt="image-20240807180720010"></p><h3 id="34-communication-management"><a class="anchor" href="#34-communication-management">#</a> 3.4 Communication Management</h3><blockquote><p>Besides parts of the ECU state management, the BswM is also responsible for parts of the communication management. This section describes the functionality of the BswM, which is related to the Communication Stack of AUTOSAR. This covers but is not restricted to the following uses cases.</p><ul><li>Starting and stopping of IPDU Groups in general</li><li>Partial Networking</li><li>Diagnostic use cases which influence the communication of an ECU. e.g. it might be necessary to set the FlexRay State manager to passive mode via FrSm_SetEcuPassive() when requested by an application.</li><li>Service Discovery Control for Appplication SWCs</li></ul><p>To fulfill the requested functionality the BswM has ModeRequestSources to</p><ul><li>the Communication Manager</li><li>the bus state managers</li><li>AUTOSAR COM</li><li>Service Discovery</li></ul></blockquote><p>é™¤äº† ECU çŠ¶æ€ç®¡ç†çš„ä¸€éƒ¨åˆ†å¤–ï¼ŒBswM è¿˜è´Ÿè´£é€šä¿¡ç®¡ç†çš„ä¸€éƒ¨åˆ†ã€‚æœ¬èŠ‚æè¿°äº† BswM çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¸ AUTOSAR çš„é€šä¿¡å †æ ˆæœ‰å…³ã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹ç”¨ä¾‹ã€‚</p><p><strong>Partial Network Cluster</strong></p><blockquote><p>A Partial Network Cluster (PNC) is a (logical) group of ECUs which have to be active at the same time to realize some distributed functionality. A PNC can be assigned to one or multiple users (configuration in ComM) and specific software components can request or release communication for a PNC by requesting the communication mode of a user mapped to the PNC. ComM implements a state machine for each partial network cluster (PNC) and each PNC has its own state. For a simple mapping, the PNC state definitions are related to the states of ComM.</p></blockquote><p>éƒ¨åˆ†ç½‘ç»œé›†ç¾¤ (PNC) æ˜¯ (é€»è¾‘) ECU ç»„ï¼Œè¿™äº› ECU å¿…é¡»åŒæ—¶å¤„äºæ´»åŠ¨çŠ¶æ€æ‰èƒ½å®ç°æŸäº›åˆ†å¸ƒå¼åŠŸèƒ½ã€‚PNC å¯ä»¥åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ· (åœ¨ ComM ä¸­è¿›è¡Œé…ç½®)ï¼Œç‰¹å®šçš„è½¯ä»¶ç»„ä»¶å¯ä»¥é€šè¿‡è¯·æ±‚æ˜ å°„åˆ° PNC çš„ç”¨æˆ·é€šä¿¡æ¨¡å¼æ¥è¯·æ±‚æˆ–é‡Šæ”¾ PNC çš„é€šä¿¡ã€‚ComM ä¸ºæ¯ä¸ªéƒ¨åˆ†ç½‘ç»œé›†ç¾¤ (PNCS) å®ç°ä¸€ä¸ªçŠ¶æ€æœºï¼Œæ¯ä¸ª PNC éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ã€‚å¯¹äºç®€å•çš„æ˜ å°„ï¼ŒPNC çŠ¶æ€å®šä¹‰ä¸ ComM çš„çŠ¶æ€ç›¸å…³ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240808104459145.png" alt="image-20240808104459145"></p><blockquote><p>The status of all PNCs on the nodes of a system channel is exchanged within the so-called PNC bit vector via a network management message (NM message).</p></blockquote><p>ç³»ç»Ÿä¿¡é“èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ PNC çš„çŠ¶æ€é€šè¿‡ç½‘ç»œç®¡ç†æ¶ˆæ¯ (NM æ¶ˆæ¯) åœ¨æ‰€è°“çš„ PNC ä½çŸ¢é‡å†…äº¤æ¢ã€‚</p><blockquote><p>Each PNC uses a dedicated bit position within a bit vector (PNC bit vector) transferred by a NM message on CAN, FlexRay and Ethernet. If a PNC is requested by a local ComM user on the node, the node sets the corresponding PNC bit in the PNC bit vector to 1. If the PNC is not requested anymore; the node sets the corresponding PNC bit in the PNC bit vector to 0. (Please note: If the optional feature "Synchronized PNC shutdown" is used and a PN shutdown messages has to be transmitted, the PNC bits are set to 1 for the PNCs which are released and the remaining PNC bits are set to 0). The &lt;Bus&gt;Nm extract the PNC bit vector from a received NM-PDU and forward the PNC bit vector to the NM interface. The Nm interface module collects and aggregates PNC requests.</p></blockquote><p>æ¯ä¸ª PNC åœ¨ç”± CANã€FlexRay å’Œä»¥å¤ªç½‘ä¸Šçš„ NM æ¶ˆæ¯ä¼ è¾“çš„ä½å‘é‡ (PNC ä½å‘é‡) ä¸­éƒ½ä½¿ç”¨ä¸€ä¸ªä¸“ç”¨ä½ã€‚å¦‚æœèŠ‚ç‚¹ä¸Šçš„æœ¬åœ° ComM ç”¨æˆ·è¯·æ±‚ PNCï¼Œåˆ™èŠ‚ç‚¹å°† PNC ä½å‘é‡ä¸­çš„ç›¸åº” PNC ä½è®¾ç½®ä¸º 1ã€‚å¦‚æœä¸å†éœ€è¦ PNCï¼Œåˆ™èŠ‚ç‚¹ä¼šå°† PNC ä½å‘é‡çš„ç›¸åº” PNC ä½è®¾ä¸º 0ã€‚(è¯·æ³¨æ„ï¼šå¦‚æœä½¿ç”¨äº†å¯é€‰åŠŸèƒ½ â€œåŒæ­¥ PNC å…³é—­â€ å¹¶ä¸”å¿…é¡»å‘é€ PN å…³é—­æ¶ˆæ¯ï¼Œåˆ™å·²é‡Šæ”¾çš„ PNC çš„ PNC ä½å°†è®¾ç½®ä¸º 1ï¼Œå…¶ä½™çš„ PNC ä½å°†è®¾ä¸º 0)ã€‚&lt;Bus&gt;Nm ä»æ¥æ”¶åˆ°çš„ NM-PDU ä¸­æå– PNC ä½å‘é‡å¹¶å°† PNC ä½çŸ¢é‡è½¬å‘åˆ° NM æ¥å£ã€‚Nm æ¥å£æ¨¡å—æ”¶é›†å’Œæ±‡æ€» PNC è¯·æ±‚ã€‚</p><blockquote><p>Each PNC uses the same bit position in the PNC bit vector on every system channel within the NM message. ComM uses 3 types of PNC bit vector named External and Internal Request Array (<strong>EIRA</strong>), External Request Array (<strong>ERA</strong>) and <strong>I</strong>nternal Request Array (<strong>IRA</strong>) to exchange PNC status information with NM interface and &lt;Bus&gt;Nms.</p></blockquote><p>æœ‰ä¸‰ç§ç±»å‹</p><ul><li>External and Internal Request Array (<strong>EIRA</strong>) å¤–éƒ¨ä¸­æ–­è¯·æ±‚é˜µåˆ—</li><li>External Request Array (<strong>ERA</strong>) å¤–éƒ¨è¯·æ±‚é˜µåˆ—</li><li><strong>I</strong>nternal Request Array (<strong>IRA</strong>) å†…éƒ¨è¯·æ±‚é˜µåˆ—</li></ul><blockquote><p>Partial networking is supported on the bus types CAN, FlexRay and Ethernet. Activation and deactivation of the I-PDU groups of the PNCs on a CAN, FlexRay and Ethernet node is required to control the communication capabilities considering the current state of the PNC and to avoid false timeouts in the system.</p></blockquote><p>éƒ¨åˆ†ç½‘ç»œæ”¯æŒ CANã€FlexRay å’Œä»¥å¤ªç½‘æ€»çº¿ç±»å‹ã€‚åœ¨ CANã€Flex-Ray å’Œä»¥å¤ªç½‘èŠ‚ç‚¹ä¸Šï¼Œéœ€è¦å¯¹ PNC çš„ I-PDU ç»„è¿›è¡Œæ¿€æ´»å’Œå¤±æ´»ï¼Œä»¥æ§åˆ¶é€šä¿¡èƒ½åŠ›ï¼Œè€ƒè™‘åˆ° PNC çš„å½“å‰çŠ¶æ€ï¼Œå¹¶é¿å…ç³»ç»Ÿä¸­çš„é”™è¯¯è¶…æ—¶ã€‚</p><blockquote><p>Starting and stopping of I-PD groups in COM are handled in BswM. I-PDU-Groups shall be started if the corresponding PNC is internally or externally requested. As soon as a PNC is neither internally norexternally requested, the corresponding I-PDU-Group shall be stopped.</p></blockquote><p>COM ä¸­çš„ I-PDU ç»„å¯åŠ¨å’Œåœæ­¢ç”± BswM å¤„ç†ã€‚å¦‚æœç›¸åº”çš„ PNC å†…éƒ¨æˆ–å¤–éƒ¨è¯·æ±‚ï¼Œåˆ™åº”å¯åŠ¨ç›¸åº”çš„ I-PDU-Groupï¼Œä¸€æ—¦ PNC æ—¢æ²¡æœ‰å†…éƒ¨è¯·æ±‚ä¹Ÿæ²¡æœ‰å¤–éƒ¨è¯·æ±‚ï¼Œåˆ™åº”åœæ­¢ç›¸åº”çš„ I-PDU ç¾¤ç»„ã€‚</p><blockquote><p>Internal PNC requests indicate communication needs locally on the ECU and are also called "active PNC request". External PNC requests indicate communication needs of a remote ECU in the network and are also called "passive PNC request".</p></blockquote><p>å†…éƒ¨ PNC è¯·æ±‚æŒ‡ç¤º ECU ä¸Šçš„æœ¬åœ°é€šä¿¡éœ€æ±‚ï¼Œä¹Ÿç§°ä¸º â€œä¸»åŠ¨ PNC è¯·æ±‚â€ã€‚</p><p>å¤–éƒ¨ PNC è¯·æ±‚æŒ‡ç¤ºç½‘ç»œä¸­è¿œç¨‹ ECU çš„é€šä¿¡éœ€æ±‚ï¼Œä¹Ÿç§°ä¸º â€œè¢«åŠ¨ PNC è¯·æ±‚â€ã€‚</p><blockquote><p>The logic to control I-PDU-Groups is handled as interaction between ComM and BswM. ComM indicates the current state of a particular PNC state machine to BswM.</p></blockquote><p>æ§åˆ¶ I-PDU - ç¾¤çš„é€»è¾‘æ˜¯ä½œä¸º ComM å’Œ BswM ä¹‹é—´çš„äº¤äº’å¤„ç†çš„ã€‚ComM å‘ BswM è¡¨ç¤ºç‰¹å®š PNC çŠ¶æ€æœºçš„å½“å‰çŠ¶æ€ã€‚</p><blockquote><p>The BswM controls the corresponding I-PDU groups by means of mode arbitration and mode control. Please note, deactivation of single FlexRay ECUs is not possible.</p></blockquote><p>BswM é€šè¿‡æ¨¡å¼ä»²è£å’Œæ¨¡å¼æ§åˆ¶æ¥æ§åˆ¶ç›¸åº”çš„ I-PDU ç»„ã€‚è¯·æ³¨æ„ï¼Œå•ä¸ª FlexRayECU æ˜¯ä¸å¯ç”¨çš„ã€‚å› ä¸º FlexRay æ˜¯ä¸¥æ ¼åŸºäºæ—¶é—´ä¼ è¾“çš„ï¼Œéœ€è¦è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹æ‰å¯ä»¥æ­£å¸¸é€šä¿¡ã€‚</p><blockquote><p>The PNC Gateway feature is used to span (logical) partial network clusters across bus / communication channel boundaries, "gatewaying" PNC requests from one bus/net work to the others.</p></blockquote><p>PNC ç½‘å…³åŠŸèƒ½ç”¨äºè·¨è¶Šæ€»çº¿ / é€šä¿¡ä¿¡é“è¾¹ç•Œçš„ (é€»è¾‘) éƒ¨åˆ†ç½‘ç»œé›†ç¾¤ï¼Œå°† PNC è¯·æ±‚ä»ä¸€ä¸ªæ€»çº¿ / ç½‘ç»œ â€œç½‘å…³åŒ–â€ åˆ°å…¶ä»–ç½‘ç»œã€‚</p><blockquote><p>The PNC Gateway collects PNC requests from all of its multiple active channels (which are called active since it actively keeps them awake, if required) and aggregates them.</p></blockquote><p>PNC ç½‘å…³ä»å…¶æ‰€æœ‰å¤šä¸ªæ´»åŠ¨é€šé“ (è¿™äº›é€šé“è¢«ç§°ä¸ºæ´»åŠ¨é€šé“ï¼Œå› ä¸ºå¦‚æœéœ€è¦ï¼Œå®ƒä¼šä¸»åŠ¨ä¿æŒå®ƒä»¬å¤„äºæ¸…é†’çŠ¶æ€) æ”¶é›† PNC è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œæ±‡æ€»ã€‚</p><blockquote><p>The PNC Gateway sends the aggregated PNC state in the network to all its active channels, which causes all nodes to have the same view on the global PNC request state as the gateway.</p></blockquote><p>PNC ç½‘å…³å°†ç½‘ç»œä¸­èšåˆçš„ PNC çŠ¶æ€å‘é€åˆ°å…¶æ‰€æœ‰æ´»åŠ¨ä¿¡é“ï¼Œè¿™ä½¿å¾—æ‰€æœ‰èŠ‚ç‚¹å¯¹å…¨å±€ PNC è¯·æ±‚çŠ¶æ€å…·æœ‰ä¸ç½‘å…³ç›¸åŒçš„è§†å›¾ã€‚</p><blockquote><p>If the PNC Gateway is not the topmost PNC Gateway in the network hierarchy, the PNC Gateway will also send the aggregated PNC request state of all subordinate nodes, plus its own internal request state, to its superior PNC coordinator, which is connected via the so-called connector type "passive".</p></blockquote><p>å¦‚æœ PNC ç½‘å…³ä¸æ˜¯ç½‘ç»œå±‚æ¬¡ç»“æ„ä¸­çš„æœ€é«˜ PNC ç½‘å…³ï¼Œåˆ™ PNC ç½‘å…³è¿˜å°†å‘é€æ‰€æœ‰å­èŠ‚ç‚¹çš„èšåˆ PNC è¯·æ±‚çŠ¶æ€ä»¥åŠå®ƒè‡ªå·±çš„å†…éƒ¨è¯·æ±‚çŠ¶æ€åˆ°å…¶ä¸Šçº§ PNC åè°ƒå™¨ï¼Œè¯¥åè°ƒå™¨é€šè¿‡æ‰€è°“çš„ â€œè¢«åŠ¨â€ è¿æ¥å™¨ç±»å‹è¿æ¥ã€‚</p><blockquote><p>The superior PNC coordinators will aggregate the subordinate coordinators PNC request states, so the top-level coordinator will know about all active PNC requests in the network, and send that info to the subordinate nodes.</p></blockquote><p>ä¸Šçº§ PNC åè°ƒå™¨å°†èšåˆä¸‹å±åè°ƒå™¨çš„ PNC è¯·æ±‚çŠ¶æ€ï¼Œå› æ­¤é¡¶çº§åè°ƒå™¨å°†äº†è§£ç½‘ç»œä¸­æ‰€æœ‰æ´»åŠ¨çš„ PNC è¯·æ±‚ï¼Œå¹¶å°†è¯¥ä¿¡æ¯å‘é€åˆ°å­èŠ‚ç‚¹ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240808175912278.png" alt="image-20240808175912278"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240808180646651.png" alt="image-20240808180646651"></p><p><strong>Aggregation of internal and external Partial Network Cluster</strong></p><p>å†…éƒ¨å’Œå¤–éƒ¨çš„ç½‘ç»œé›†ç¾¤çš„èšåˆ</p><blockquote><p>This feature is used by every ECU that is member of a Partial Network Cluster (PNC).</p><ul><li>Active PNC requests are forwarded by the ComM via the Nm to the &lt;Bus&gt;Nms.</li><li>Passive PNC requests are received by the &lt;Bus&gt;Nms and forwarded to the Nm.</li></ul></blockquote><p>ä½œä¸ºéƒ¨åˆ†ç½‘ç»œé›†ç¾¤ (PNC) æˆå‘˜çš„æ¯ä¸ª ECU éƒ½ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚</p><ul><li>ä¸»åŠ¨ PNC è¯·æ±‚ç”± ComM é€šè¿‡ Nm è½¬å‘åˆ° &lt;Bus&gt;Nmã€‚</li><li>&lt;Bus&gt;Nm æ¥æ”¶è¢«åŠ¨ PNC è¯·æ±‚å¹¶å°†å…¶è½¬å‘ç»™ Nmã€‚</li></ul><blockquote><p>Nm handles received PNC request with respect to a so-called PN filter mask. The PN filter mask define which of the received PNC requests are relevant. Nm collects and maintains internal and external PNC requests.</p></blockquote><p>Nm å¤„ç†æ¥æ”¶åˆ°çš„ä¸ PN è¿‡æ»¤å™¨æ©ç ç›¸å…³çš„ PNC è¯·æ±‚ã€‚PN è¿‡æ»¤å™¨æ©ç å®šä¹‰äº†å“ªäº›æ¥æ”¶åˆ°çš„ PNC è¯·æ±‚æ˜¯ç›¸å…³çš„ã€‚Nm æ”¶é›†å’Œç»´æŠ¤å†…éƒ¨å’Œå¤–éƒ¨ PNC è¯·æ±‚ã€‚</p><blockquote><p>The aggregation of internal and external requested PNCs is called "External Internal Request Array (EIRA)".</p></blockquote><p>å†…éƒ¨å’Œå¤–éƒ¨è¯·æ±‚çš„ PNC çš„æ±‡æ€»ç§°ä¸º â€œå¤–éƒ¨å†…éƒ¨è¯·æ±‚é˜µåˆ— (EIRA)</p><blockquote><p>Changes of the EIRA are forwarded by Nm to ComM. ComM needs this information to handle changes in the corresponding PNC state machines.</p></blockquote><p>EIA çš„æ›´æ”¹ç”± Nm è½¬å‘åˆ° ComMã€‚ComM éœ€è¦æ­¤ä¿¡æ¯æ¥å¤„ç†ç›¸åº” PNC çŠ¶æ€æœºä¸­çš„æ›´æ”¹ã€‚</p><blockquote><p>The provided information of a request change (PNC request changed from requested to released and vice versa) to ComM at (almost) the same time on every ECU, results to switch the I-PDU-Groups synchronously on all direct connected ECUs.</p></blockquote><p>åœ¨æ¯ä¸ª ECU ä¸Š (å‡ ä¹) åŒæ—¶å‘ ComM æä¾›çš„è¯·æ±‚æ›´æ”¹ (PNC è¯·æ±‚ä»è¯·æ±‚å˜ä¸ºé‡Šæ”¾åä¹‹äº¦ç„¶) ä¿¡æ¯å¯¼è‡´åœ¨æ‰€æœ‰ç›´æ¥è¿æ¥çš„ ECU ä¸ŠåŒæ­¥åˆ‡æ¢ I-PDU ç»„ã€‚</p><blockquote><p>Therefore the Nm maintain timers (so-called PNC reset timer) of each PNC request in the EIRA.</p></blockquote><p>å› æ­¤ï¼ŒNm åœ¨ EIRA ä¸­ç»´æŠ¤æ¯ä¸ª PNC è¯·æ±‚çš„å®šæ—¶å™¨ (å³ PNC å¤ä½å®šæ—¶å™¨)</p><blockquote><p>The PNC reset timer is restarted every time the corresponding PNC is requested within received PNC bit vector and every time the corresponding PNC request is transmitted.</p></blockquote><p>æ¯æ¬¡åœ¨æ¥æ”¶åˆ°çš„ PNC ä½çŸ¢é‡å†…è¯·æ±‚å¯¹åº”çš„ PNC ä»¥åŠæ¯æ¬¡å‘é€å¯¹åº”çš„ PNC è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šé‡æ–°å¯åŠ¨ PNC å¤ä½å®šæ—¶å™¨ã€‚</p><p><strong>Aggregation of external Partial Network Cluster</strong></p><p>å¤–éƒ¨çš„ç½‘ç»œé›†ç¾¤çš„èšåˆ</p><blockquote><p>This feature is used by the ECUs where the PNC Gateway functionality is enabled to collect the external PNC requests per channel.</p></blockquote><p>æ­¤åŠŸèƒ½ç”±å¯ç”¨ PNC ç½‘å…³åŠŸèƒ½çš„ ECU ä½¿ç”¨ï¼Œä»¥æ”¶é›†æ¯ä¸ªé€šé“çš„å¤–éƒ¨ PNC è¯·æ±‚ã€‚</p><blockquote><p>The external PNC requests have to be coordinated across all affected channels. The logic of the PNC coordination is provided by ComM.</p></blockquote><p>å¤–éƒ¨ PNC è¯·æ±‚å¿…é¡»é€šè¿‡æ‰€æœ‰å—å½±å“çš„é€šé“è¿›è¡Œåè°ƒã€‚PNC åè°ƒçš„é€»è¾‘ç”± ComM æä¾›ã€‚</p><blockquote><p>There, for each channel it is configured if it is actively or passively coordinated.</p></blockquote><p>å¯¹äºæ¯ä¸ªé€šé“ï¼Œå¦‚æœå®ƒæ˜¯ä¸»åŠ¨åè°ƒè¿˜æ˜¯è¢«åŠ¨åè°ƒï¼Œéƒ½ä¼šè¿›è¡Œé…ç½®ã€‚</p><blockquote><p>On actively coordinated channels, external PNC requests are mirrored back to the channel where the PNC request was received and also forwarded to all other coordinated channels (either passively or actively coordinated) where this PNC is assigned to.</p></blockquote><p>åœ¨ä¸»åŠ¨åè°ƒçš„é€šé“ä¸Šï¼Œå¤–éƒ¨ PNC è¯·æ±‚è¢«é•œåƒå›æ¥æ”¶ PNC è¯·æ±‚çš„é€šé“ï¼Œå¹¶è½¬å‘åˆ°åˆ†é…æœ‰è¯¥ PNC çš„æ‰€æœ‰å…¶ä»–åè°ƒé€šé“ (æ— è®ºæ˜¯è¢«åŠ¨åè°ƒè¿˜æ˜¯ä¸»åŠ¨åè°ƒ)ã€‚</p><blockquote><p>On passive coordinated channels external PNC requests are forwarded to other actively coordinated channels where this PNC is assigned to without mirroring back on the channel from where the external PNC request was received.</p><p>This avoids endless mirroring of partial network cluster requests,</p></blockquote><p>åœ¨è¢«åŠ¨åè°ƒé€šé“ä¸­ï¼Œå¤–éƒ¨ PNC è¯·æ±‚è¢«è½¬å‘åˆ°å…¶ä»–ä¸»åŠ¨åè°ƒé€šé“ï¼Œè¯¥ PNC ä¹Ÿä¼šè¢«åˆ†é…ç»™ä¸»åŠ¨åè°ƒé€šé“ï¼Œè€Œä¸ä¼šåœ¨æ¥æ”¶å¤–éƒ¨ PNC è¯·æ±‚çš„é€šé“ä¸­é•œåƒå›æ¥ã€‚è¿™é¿å…äº†éƒ¨åˆ†ç½‘ç»œé›†ç¾¤è¯·æ±‚çš„æ— ä¼‘æ­¢çš„åå°„ã€‚</p><blockquote><p>if 2 ECUs have PNC Gateway functionality enabled and are connected to the same channel.</p><p>The Nm module provides the information if PNCs are externally requested or released to ComM and manages the PNC timer handling for each relevant PNC and per channel.</p><p>The aggregated state of the external requested PNCs is called "External Request Array" (ERA).</p></blockquote><p>å¦‚æœä¸¤ä¸ª ECU å¯ç”¨äº† PNC Gateway åŠŸèƒ½å¹¶è¿æ¥åˆ°åŒä¸€ä¿¡é“ï¼Œåˆ™ Nm æ¨¡å—ä¼šåœ¨å¤–éƒ¨å‘ ComM è¯·æ±‚æˆ–é‡Šæ”¾ PNC æ—¶æä¾›è¿™äº›ä¿¡æ¯ï¼Œå¹¶ç®¡ç†æ¯ä¸ªç›¸å…³ PNC å’Œæ¯ä¸ªä¿¡é“çš„ PNC å®šæ—¶å™¨å¤„ç†ã€‚å¤–éƒ¨è¯·æ±‚çš„ PNC çš„èšåˆç§°ä¸º â€œå¤–éƒ¨è¯·æ±‚é˜µåˆ—â€(ERA)</p><p><strong>Synchronized PNC shutdown</strong></p><p>PNC shutdown çš„åŒæ­¥</p><blockquote><p>In order to avoid timeout failure on application level, the PNC shall shutdown in a synchronized way (all nodes in the PNC will shutdown at the same point in time).</p></blockquote><p>ä¸ºäº†é¿å…åº”ç”¨å±‚çš„è¶…æ—¶æ•…éšœï¼ŒPNC åº”ä»¥åŒæ­¥æ–¹å¼å…³é—­ (PNC ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å°†åœ¨åŒä¸€æ—¶é—´ç‚¹å…³é—­)ã€‚</p><blockquote><p>The synchronized PNC shutdown is a functionality which is a cooperation of ComM, Nm and &lt;Bus&gt;Nm to ensure a synchronized PNC shutdown at almost the same point in time across the whole PN topology.</p></blockquote><p>åŒæ­¥ PNC å…³é—­æ˜¯ä¸€ä¸ªç”± ComMã€Nm å’Œ æ€»çº¿ Nm å…±åŒå®ç°çš„åŠŸèƒ½ &lt;Bus&gt;ï¼Œå¯ç¡®ä¿åœ¨æ•´ä¸ª PN æ‹“æ‰‘ä¸­å‡ ä¹ç›¸åŒçš„æ—¶é—´ç‚¹åŒæ­¥ PNC å…³æ–­ã€‚</p><blockquote><p>A synchronized PNC shutdown is handled by ECUs in role of a top-level PNC coordinator or intermediate PNC coordinator if the PNC Gateway is enabled.</p></blockquote><p>å¦‚æœ PNC ç½‘å…³å¤„äºå¯ç”¨çŠ¶æ€ï¼Œåˆ™ç”± ECU å……å½“é¡¶çº§ PNC åè°ƒå™¨æˆ–ä¸­é—´ PNC åè°ƒå™¨å¤„ç†åŒæ­¥ PNC å…³é—­ã€‚</p><blockquote><p>If the ComM of an ECU in the role of a top-level PNC coordinator detects that a PNC is released (PNC is no longer internally or externally requested), the ComM requests a synchronized PNC shutdown.</p></blockquote><p>å¦‚æœå……å½“é¡¶çº§ PNC åè°ƒæ•´ä¸ª ECU çš„ ComM æ£€æµ‹åˆ° PNC é‡Šæ”¾ (PNC å†…éƒ¨æˆ–å¤–éƒ¨è¯·æ±‚ä¸å†å­˜åœ¨)ï¼Œåˆ™ ComM è¯·æ±‚åŒæ­¥ PNC å…³é—­</p><blockquote><p>The Nm module stores all requests and handles them in the context of the Nm_Mainfunction. The Nm module indicates the affected &lt;Bus&gt;Nms regarding an activated PNC shutdown process.</p></blockquote><p>Nm æ¨¡å—å­˜å‚¨æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶åœ¨ Nm_Mainfunction å‡½æ•°ä¸­å¤„ç†å®ƒä»¬ã€‚Nm æ¨¡å—æŒ‡ç¤ºä¸å·²æ¿€æ´»çš„ PNC å…³æœºè¿‡ç¨‹æœ‰å…³çš„å—å½±å“çš„ &lt;Bus&gt;Nmã€‚</p><blockquote><p>The &lt;Bus&gt;Nms call the Nm module to provide the aggregated requests for a synchronized PNC shutdown as PNC bit vector per given NM-Channel.</p></blockquote><p>&lt;Bus&gt;Nms è°ƒç”¨ Nm æ¨¡å—ï¼Œä»¥ä¾¿ä»¥æ¯ä¸ªç»™å®šçš„ NM ä¿¡é“çš„ PNC ä½å‘é‡çš„å½¢å¼æä¾›å¯¹åŒæ­¥ PNC å…³æœºçš„èšåˆè¯·æ±‚ã€‚</p><blockquote><p>The &lt;Bus&gt;Nms use the provided PNC bit vector to assemble a NM-PDU as PN shutdown message and transmit this message on the according NM channel.</p></blockquote><p>&lt;Bus&gt;Nm ä½¿ç”¨æä¾›çš„ PNC ä½çŸ¢é‡æ¥ç»„è£… NM-PDU ä½œä¸º PN å…³é—­æ¶ˆæ¯ï¼Œå¹¶åœ¨ç›¸åº”çš„ NM é€šé“ä¸Šä¼ è¾“è¯¥æ¶ˆæ¯ã€‚</p><blockquote><p>If a PN shutdown message is received by an ECU in the role of an intermediate PNC coordinator, the &lt;Bus&gt;Nms extract the PNC bit vector from the received PN shutdown message and forwards the information by calling the callback function Nm_ForwardSynchronizedPncShutdown.</p></blockquote><p>å¦‚æœä¸­é—´ PNC åè°ƒå™¨è§’è‰²ä¸­çš„ ECU æ¥æ”¶åˆ° PN å…³é—­æ¶ˆæ¯ï¼Œåˆ™ &lt;Bus&gt;Nms ä»æ¥æ”¶åˆ°çš„ PN å…³é—­æ¶ˆæ¯ä¸­æå– PNC ä½å‘é‡ï¼Œå¹¶é€šè¿‡è°ƒç”¨å›è°ƒå‡½æ•° Nm_ForwardSynchronizedPncShutdown æ¥è½¬å‘è¯¥ä¿¡æ¯ã€‚</p><blockquote><p>The callback function will immediately forward the indication to ComM by calling ComM_Nm_ForwardSynchronizedPncShutdown. ComM will immediately request a synchronized PNC shutdown of all actively PNC coordinated (coordinated by a PNC gateway) ComMChannels.</p></blockquote><p>å›è°ƒå‡½æ•°å°†ç«‹å³é€šè¿‡è°ƒç”¨ ComM_Nm_ForwardSynchronizedPncShutdown å°†æŒ‡ç¤ºè½¬å‘åˆ° ComMã€‚ComM å°†ç«‹å³è¯·æ±‚æ‰€æœ‰ç§¯æ PNC åè°ƒ (ç”± PNC ç½‘å…³åè°ƒ) çš„ ComMChannels çš„åŒæ­¥ PNC å…³é—­ã€‚</p><blockquote><p>The requests for a synchronized PNC shutdown are forwarded to the Nm module per NM-Channel and handled in the same way as described in the previous section. If a PNC leaf node receives a PN shutdown message, then it will handle the message as a usual NM message (update the local PN info and reset PN reset time).</p></blockquote><p>åŒæ­¥ PNC å…³é—­è¯·æ±‚é€šè¿‡ NM é€šé“è½¬å‘åˆ° Nm æ¨¡å—ï¼Œå¤„ç†æ–¹å¼ä¸å‰ä¸€èŠ‚æ‰€è¿°ç›¸åŒã€‚å¦‚æœ PNC å¶èŠ‚ç‚¹æ¥æ”¶åˆ° PN å…³é—­æ¶ˆæ¯ï¼Œåˆ™å®ƒå°†åƒå¤„ç†å¸¸è§„ NM æ¶ˆæ¯ä¸€æ ·å¤„ç†è¯¥æ¶ˆæ¯ (æ›´æ–°æœ¬åœ° PN ä¿¡æ¯å¹¶é‡ç½® PN å¤ä½æ—¶é—´)</p><p><strong>Scheduling of main functions</strong></p><blockquote><p>Since state changes of communication channels or PNCs are generally processed in the context of the main processing functions, it is important to properly consider the scheduling and the order of execution for the main processing functions for the modules involved in the communication and network management (ComM, Nm, &lt;Bus&gt;Nms).</p></blockquote><p>ç”±äºé€šä¿¡ä¿¡é“æˆ– PNC çš„çŠ¶æ€å˜åŒ–é€šå¸¸åœ¨ä¸»å¤„ç†åŠŸèƒ½çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œå¤„ç†ï¼Œå› æ­¤æ­£ç¡®è€ƒè™‘æ¶‰åŠé€šä¿¡å’Œç½‘ç»œç®¡ç† (ComMã€Nmã€&lt;Bus&gt;Nms) çš„æ¨¡å—çš„ä¸»å¤„ç†åŠŸèƒ½çš„è°ƒåº¦å’Œæ‰§è¡Œé¡ºåºéå¸¸é‡è¦ã€‚</p><blockquote><p>ComM generally coordinates the activities considering the events in the system and triggers the required actions (by calling the relevant APIs) of the lower layers.</p></blockquote><p>ComM é€šå¸¸ä¼šè€ƒè™‘ç³»ç»Ÿä¸­çš„äº‹ä»¶æ¥åè°ƒæ´»åŠ¨ï¼Œå¹¶è§¦å‘ä¸‹å±‚æ‰€éœ€çš„åŠ¨ä½œ (é€šè¿‡è°ƒç”¨ç›¸å…³çš„ API)ã€‚</p><blockquote><p>Events in the system causing specific actions required to be triggered by ComM can be internal requests of users (internal requests for channels or PNCs), passive/external requests for channels or PNCs or synchronized PNC shutdown messages received on the bus.</p></blockquote><p>ç³»ç»Ÿä¸­å¯¼è‡´éœ€è¦ç”± ComM è§¦å‘ç‰¹å®šæ“ä½œçš„äº‹ä»¶å¯ä»¥æ˜¯</p><ul><li>ç”¨æˆ·çš„å†…éƒ¨è¯·æ±‚ (å¯¹ä¿¡é“æˆ– PNC çš„å†…éƒ¨è¯·æ±‚)ã€</li><li>å¯¹ä¿¡é“æˆ– PNC çš„è¢«åŠ¨ / å¤–éƒ¨è¯·æ±‚</li><li>æˆ–åœ¨æ€»çº¿ä¸Šæ¥æ”¶åˆ°çš„åŒæ­¥ PNC å…³é—­æ¶ˆæ¯ã€‚</li></ul><blockquote><p>External events may be caused by wakeup events, reception of cyclic NM messages or synchronized shutdown messages.</p></blockquote><p>å¤–éƒ¨äº‹ä»¶å¯èƒ½ç”±</p><ul><li>å”¤é†’äº‹ä»¶ã€</li><li>å‘¨æœŸæ€§ NM æ¶ˆæ¯çš„æ¥æ”¶</li><li>æˆ–åŒæ­¥å…³æœºæ¶ˆæ¯å¼•èµ·ã€‚</li></ul><blockquote><p>ComM receives and processes all internal and external requests</p></blockquote><p>ComM æ¥æ”¶å’Œå¤„ç†æ‰€æœ‰å†…éƒ¨å’Œå¤–éƒ¨è¯·æ±‚</p><blockquote><p>and triggers required actions</p></blockquote><p>å¹¶è§¦å‘å¿…è¦çš„åŠ¨ä½œ</p><blockquote><p>that will lead to state changes in the state machines for communication and network management modules</p></blockquote><p>è¿™å°†å¼•å¯¼é€šä¿¡å’Œç½‘ç»œç®¡ç†æ¨¡å—çŠ¶æ€æœºçš„çŠ¶æ€å˜åŒ–</p><blockquote><p>and consequently the transmission of cyclic NM messages or synchronized shutdown messages on the bus.</p></blockquote><p>ä»è€Œåœ¨æ€»çº¿ä¸Šä¼ è¾“å¾ªç¯ NM æ¶ˆæ¯æˆ–åŒæ­¥å…³é—­æ¶ˆæ¯ã€‚</p><blockquote><p>During integration of the modules, it must be considered that the processing of specific requests is done asynchronously in the basic software (e.g. transmission requests,some requests from the application)</p></blockquote><p>åœ¨é›†æˆæ¨¡å—æ—¶ï¼Œå¿…é¡»è€ƒè™‘ç‰¹å®šè¯·æ±‚çš„å¤„ç†åœ¨åŸºæœ¬è½¯ä»¶ä¸­å¼‚æ­¥å®Œæˆ (ä¾‹å¦‚ä¼ è¾“è¯·æ±‚ã€æ¥è‡ªåº”ç”¨ç¨‹åºçš„æŸäº›è¯·æ±‚)</p><blockquote><p>and also that specific actions may be processed decoupled in the context of the main processing cycle of the involved modules (e.g.transmission in the &lt;Bus&gt;Nms, processing of timers, state changes and notificationsto upper layers).</p></blockquote><p>å¹¶ä¸”ç‰¹å®šæ“ä½œå¯èƒ½åœ¨æ‰€æ¶‰åŠæ¨¡å—çš„ä¸»è¦å¤„ç†å‘¨æœŸçš„ä¸Šä¸‹æ–‡ä¸­è„±é’©å¤„ç† (ä¾‹å¦‚åœ¨ &lt; Bus&gt;Nms ä¸­çš„ä¼ è¾“ã€å¤„ç†å®šæ—¶å™¨ã€çŠ¶æ€æ›´æ”¹å’Œé€šçŸ¥ç»™ä¸Šå±‚)ã€‚</p><p><strong>I-PDU Group Switching</strong></p><blockquote><p>For the I-PDU group switching it is expected that dedicated I-PDU groups for outgoing and incoming I-PDUs in COM exist for each channel or partial network.</p></blockquote><p>å¯¹äº I-PDU ç»„äº¤æ¢ï¼Œé¢„è®¡æ¯ä¸ªé€šé“æˆ–éƒ¨åˆ†ç½‘ç»œéƒ½å­˜åœ¨ç”¨äº COM ä¸­ä¼ å…¥å’Œä¼ å‡º I-PDUs çš„ä¸“ç”¨ I-PDU ç»„ã€‚</p><blockquote><p>AUTOSAR COM takes care that an I-PDU is active (started) if at least one I-PDU group containing this I-PDU is active.</p></blockquote><p>AUTOSAR COM ç¡®ä¿å¦‚æœè‡³å°‘ä¸€ä¸ªåŒ…å«æ­¤ I-PDU çš„ I-PDU ç»„å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™ I-PDU å¤„äºæ´»åŠ¨çŠ¶æ€ (å¯åŠ¨)</p><p>æœ‰ä¸¤ç§ç»„ç»‡æ–¹å¼</p><ul><li><strong>Channel related I-PDU Group Handling</strong></li><li><strong>PNC related I-PDU Group Handling</strong></li></ul><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240809114837791.png" alt="image-20240809114837791"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240809114845904.png" alt="image-20240809114845904"></p><p><strong>Channel related I-PDU Group Handling</strong></p><p><strong>Listing 3.18: ComM reports FULL_COMMUNICATION</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule channel1requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> ComM_Mode_Channel1 <span class="token operator">==</span> COMM_FULL_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    	actionlist channel1requestedActions<span class="token comment">/* channel 1 */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>actions channel1requestedActions on condition <span class="token punctuation">{</span> <span class="token comment">/* channel 1 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        init true</pre></td></tr><tr><td data-num="9"></td><td><pre>        enable 	ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>CAN1IPDUS_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        		ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>CAN1IPDUS_RX</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre>rule channel2requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> ComM_Mode_Channel2 <span class="token operator">==</span> COMM_FULL_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    	actionlist channel2requestedActions<span class="token comment">/* channel 2 */</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="18"></td><td><pre>actions channel2requestedActions on condition <span class="token punctuation">{</span><span class="token comment">/* channel 2 */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        init true</pre></td></tr><tr><td data-num="21"></td><td><pre>        enable 	ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>CAN2IPDUS_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        		ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>CAN2IPDUS_RX</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>Listing 3.19: ComM reports SILENT_COMMUNICATION</strong></p><p><strong>Listing 3.20: ComM reports NO_COMMUNICATION</strong></p><p><strong>PNC related I-PDU Group Handling</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">/* PNC 1 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre>rule pnc1requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC1 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span> PNC1 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    	actionlist pnc1requestedActions</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="7"></td><td><pre>actions pnc1requestedActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        init true</pre></td></tr><tr><td data-num="10"></td><td><pre>        enable 	ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC1IPDUS_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        		ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC1IPDUS_RX</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/* PNC 2 */</span></pre></td></tr><tr><td data-num="16"></td><td><pre>rule pnc2requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC2 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span> PNC2 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    	actionlist pnc2requestedActions</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="21"></td><td><pre>actions pnc2requestedActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        init true</pre></td></tr><tr><td data-num="24"></td><td><pre>        enable 	ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC2IPDUS_CH1_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC2IPDUS_CH1_RX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC2IPDUS_CH2_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC2IPDUS_CH1_RX</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">/* PNC 3 */</span></pre></td></tr><tr><td data-num="32"></td><td><pre>rule pnc3requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC3 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span> PNC3 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        actionlist pnc3requestedActions</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="37"></td><td><pre>actions pnc3requestedActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        init true</pre></td></tr><tr><td data-num="40"></td><td><pre>        enable 	ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC3IPDUS_TX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        		ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>PNC3IPDUS_RX</pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>Listing 3.21: ComM reports PNC_REQUESTED or PNC_READY_SLEEP</strong></p><p><strong>Listing 3.22: ComM reports PNC_PREPARE_SLEEP</strong></p><p><strong>Listing 3.23: ComM reports PNC_NO_COMMUNICATION</strong></p><p><strong>J1939 Networkmanagement</strong></p><blockquote><p>In contrast to current AUTOSAR network management, the task of J1939 network management is not to handle sleep and wake-up of ECUs, but to assign unique addresses to each node represented by an ECU.</p></blockquote><p>ä¸ç›®å‰çš„ AUTOSAR ç½‘ç»œç®¡ç†ä¸åŒï¼ŒJ1939 ç½‘ç»œç®¡ç†çš„ä»»åŠ¡ä¸æ˜¯å¤„ç† ECU çš„ä¼‘çœ å’Œå”¤é†’ï¼Œè€Œæ˜¯ä¸º ECU ä»£è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹åˆ†é…å”¯ä¸€åœ°å€ã€‚</p><blockquote><p>This is achieved by sending the AddressClaimed (AC, 0x0EE00) parameter group a start-up, which announces the desired address.</p></blockquote><p>è¿™æ˜¯é€šè¿‡å‘ AddressClaim (ACï¼ŒOxOEE00) å‚æ•°ç»„å‘é€å¯åŠ¨æ¥å®ç°çš„ï¼Œè¯¥å¯åŠ¨ä¼šå®£å¸ƒæ‰€éœ€çš„åœ°å€ã€‚</p><blockquote><p>If another node claims the same address, and has higher priority, the node has to go silent after sending the Cannot ClaimAddress parameter group ((AddressClaim)AC with null address as SA), or try to use another address.</p></blockquote><p>å¦‚æœå¦ä¸€ä¸ªèŠ‚ç‚¹å£°ç§°ç›¸åŒçš„åœ°å€ï¼Œå¹¶ä¸”å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œåˆ™è¯¥èŠ‚ç‚¹å¿…é¡»åœ¨å‘é€ CannotClaimAddress å‚æ•°ç»„ (ç©ºåœ°å€ä¸º SA çš„ AC) åä¿æŒæ²‰é»˜ï¼Œæˆ–è€…å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªåœ°å€ã€‚</p><blockquote><p>To support this use case the BswM is extended to accept state change indications from the J1939Nm via the API function BswM_J1939Nm_StateChangeNotification()(see also 3.2.2.2.15).</p></blockquote><p>ä¸ºäº†æ”¯æŒæ­¤ç”¨ä¾‹ï¼ŒBswM æ‰©å±•ä¸ºé€šè¿‡ API å‡½æ•° BswM_J1939Nm_StateChangeNotification (å¦å‚è§ 3.2.1.2.2.15) æ¥å—æ¥è‡ª l1939Nm çš„çŠ¶æ€å˜åŒ–æŒ‡ç¤ºã€‚</p><blockquote><p>Depending on the state indicated by the network management the BswM needs to switch ComIPduGroups of COM, PduRRoutingPathGroups of PduR, and general request handling of the J1939Rm.</p></blockquote><p>æ ¹æ®ç½‘ç»œç®¡ç†æ‰€æŒ‡ç¤ºçš„çŠ¶æ€ï¼ŒBswM éœ€è¦åˆ‡æ¢ COM çš„ ComIPduGroups ã€PduR çš„ PduRRoutingPathGroups ä»¥åŠ J1939 RM çš„é€šç”¨è¯·æ±‚ã€‚</p><blockquote><p>The first two actions are realized via BswMPduGroupSwitch- and BswMPduRouter Control -actions. The J1939 Request Manager shall be switched using the BswMJ1939Rm action.</p><p>COM is expected to have IPDU groups containing all locally received and transmitted I-PDUs for each network. The PduR shall be configured in the same way, having RoutingPathGroups for all locally received and transmitted IPDUs for each channel, excluding the received I-PDU for the Request message forwarded to the J1939Rm.</p></blockquote><p>COM åº”å…·æœ‰åŒ…å«æ¯ä¸ªç½‘ç»œæ‰€æœ‰æœ¬åœ°æ¥æ”¶å’Œä¼ è¾“çš„ IPDU çš„ IPDU ç»„ã€‚PduR åº”ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå…·æœ‰ç”¨äºæ¯ä¸ªä¿¡é“æ‰€æœ‰æœ¬åœ°æ¥æ”¶å’Œä¼ è¾“çš„æ‰€æœ‰ IPDU çš„ RoutingPathGroupsï¼Œä½†ä¸åŒ…æ‹¬è½¬å‘åˆ° J1939Rm çš„è¯·æ±‚æ¶ˆæ¯çš„æ¥æ”¶ IPDUã€‚</p><blockquote><p>The BswM must then be configured to</p><p>ç„¶åï¼ŒBSWM å¿…é¡»é…ç½®</p><p>switch on and off the aforementioned IPDU groups</p><p>æ‰“å¼€å’Œå…³é—­ä¸Šè¿° IPDU ç»„</p><p>and PduRRoutingPathGroups depending on the reported NM states,</p><p>å’Œä¾èµ–äº NM çŠ¶æ€çš„ PduRRoutingPathGroups</p><p>as well as general request handling of the J1939 Request Manager.</p><p>ä»¥åŠ J1939 è¯·æ±‚ç®¡ç†å™¨çš„ä¸€èˆ¬è¯·æ±‚å¤„ç†ã€‚</p></blockquote><p><strong>J1939 diagnostic mode management</strong></p><blockquote><p>In addition to address assignment the BswM has also to supervise the sending of<br>broadcast messages in a J1939 environment. Each IPDU group represents the broadcast messages (J1939 PGs with PDU2 format PGN or PDU1 format PGN and broadcast destination address) of one network.</p></blockquote><p>é™¤äº†åœ°å€åˆ†é…ä¹‹å¤–ï¼ŒBswM è¿˜å¿…é¡»ç›‘ç£ J1939 ç¯å¢ƒä¸­çš„å¹¿æ’­æ¶ˆæ¯çš„å‘é€ã€‚æ¯ä¸ª IPDU ç»„è¡¨ç¤ºä¸€ä¸ªç½‘ç»œçš„å¹¿æ’­æ¶ˆæ¯ (J1939 PGsï¼Œå…·æœ‰ PDU2 æ ¼å¼ PGN æˆ– PDU1 æ ¼å¼ PGN å’Œå¹¿æ’­ç›®æ ‡åœ°å€)</p><blockquote><p>For this purpose it is also expected that COM contains one IPDU group for each channel, which contains the broadcast messages of this ECU.</p></blockquote><p>ä¸ºæ­¤ï¼Œè¿˜å¸Œæœ› COM ä¸ºæ¯ä¸ªä¿¡é“åŒ…å«ä¸€ä¸ª IPDU ç»„ï¼Œè¯¥ç»„åŒ…å«è¯¥ ECU çš„å¹¿æ’­æ¶ˆæ¯ã€‚</p><p><strong>Listing 3.25: Rule to implement broadcast management according to J1939</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule J1939_broadcast_management initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> BswMJ1939DcmBroadcastStatus <span class="token operator">==</span> NETWORK_ENABLED<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    	actionlist J1939ActivateBroadcastActions</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    	actionlist J1939DeactivateBroadcastActions</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="8"></td><td><pre>actions J1939ActivateBroadcastActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        init true</pre></td></tr><tr><td data-num="11"></td><td><pre>        enable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>J1939BroadcastIPDUS</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="14"></td><td><pre>actions J1939DeactivateBroadcastActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    PduGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyCom<span class="token punctuation">.</span>J1939BroadcastIPDUS</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>LIN Schedule Table Switch</strong></p><blockquote><p>The BswM is able to switch the schedule tables LIN channels based on requests from Application SWCs.</p></blockquote><p>BswM èƒ½å¤Ÿæ ¹æ®åº”ç”¨ç¨‹åº SWC çš„è¯·æ±‚åˆ‡æ¢è°ƒåº¦è¡¨ LIN é€šé“ã€‚</p><blockquote><p>The SWC requests a LIN schedule table from the BswM in form of an application mode. After the successful switch the BswM switches to the requested mode.</p></blockquote><p>SWC ä»¥åº”ç”¨æ¨¡å¼çš„å½¢å¼å‘ BSWM è¯·æ±‚ LIN è°ƒåº¦è¡¨ã€‚æˆåŠŸåˆ‡æ¢åï¼ŒBswm åˆ‡æ¢åˆ°æ‰€è¯·æ±‚çš„æ¨¡å¼ã€‚</p><blockquote><p>In the following, an example for this behavior is shown. At first, a ModeDeclarationGroup is needed which is used by the Application SWCs to request a certain schedule to which the LIN channel shall be switched.</p></blockquote><p>ä¸‹é¢æ˜¾ç¤ºäº†è¿™ç§è¡Œä¸ºçš„ç¤ºä¾‹ã€‚é¦–å…ˆï¼Œéœ€è¦ä¸€ä¸ªæ¨¡å¼å£°æ˜ç»„ï¼Œè¯¥ç»„ç”±åº”ç”¨ç¨‹åº SWC ç”¨äºè¯·æ±‚ LIN é€šé“åº”åˆ‡æ¢åˆ°çš„ç‰¹å®šæ—¶é—´è¡¨ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>modeGroup MDG_LinScheduleTables <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Schedule1<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Schedule2</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>An enumeration containing the same values is needed for the SenderReceiverInterface between BswM and SWC.</p></blockquote><p>BSWM å’Œ SWC ä¹‹é—´çš„ SenderReceiverInterface éœ€è¦ä¸€ä¸ªåŒ…å«ç›¸åŒå€¼çš„æšä¸¾ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">ENUM_LinScheduleTables</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Schedule1<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Schedule2</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>A ModeSwitchInterface is necessary to switch the application mode after the LIN schedule table was set.</p></blockquote><p>åœ¨è®¾ç½® LIN è°ƒåº¦è¡¨åï¼Œå¿…é¡»ä½¿ç”¨ ModeSwitchInterface æ¥åˆ‡æ¢åº”ç”¨ç¨‹åºæ¨¡å¼ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>interface modeSwitch LinScheduleMode <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	mode MDG_LinScheduleTables LinScheduleMode</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>Also a SenderReceiverInterface which uses the previously defined enumeration is needed. It can be used by the application SWC to request a mode that should lead to a LIN schedule table switch.</p></blockquote><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦ä½¿ç”¨å…ˆå‰å®šä¹‰çš„æšä¸¾çš„ SenderReceiverInterfaceã€‚åº”ç”¨ç¨‹åº SWC å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯·æ±‚å¼•å¯¼ LIN è°ƒåº¦è¡¨åˆ‡æ¢çŠ¶æ€ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>interface senderReceiver LinChannel1ScheduleTableRequestPort <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    data ENUM_LinScheduleTables LinScheduleMode</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>The following BswM rule switches the schedule table of a LIN channel when the application SWC request another application mode.</p></blockquote><p>å½“åº”ç”¨ç¨‹åº SWC è¯·æ±‚å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¨¡å¼æ—¶ï¼Œä»¥ä¸‹ BswM è§„åˆ™æ˜¯åˆ‡æ¢ LIN é€šé“çš„è°ƒåº¦è¡¨ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule LinChannel1Schedule1Request initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>LinChannel1ScheduleTableRequestPort <span class="token operator">==</span> Schedule1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    	<span class="token function">LinScheduleSwitch</span><span class="token punctuation">(</span>LinSchedule1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>The following BswM rule switches the application mode to the mode which was previously requested by the application. It is triggered when the LinSM notifies the BswM that a LIN schedule table switch occurred.</p></blockquote><p>ä¸‹åˆ— BswM è§„åˆ™å°†åº”ç”¨ç¨‹åºæ¨¡å¼åˆ‡æ¢åˆ°å…ˆå‰ç”±åº”ç”¨ç¨‹åºè¯·æ±‚çš„æ¨¡å¼ã€‚å½“ LINSM é€šçŸ¥ BSWM å‘ç”Ÿäº† LIN è°ƒåº¦è¡¨åˆ‡æ¢æ—¶ï¼Œå°†è§¦å‘è¯¥è§„åˆ™ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule LinChannel1Schedule1Switched initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>LinSM_CurrentState <span class="token operator">==</span> LinSchedule1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    	<span class="token function">RteSwitch</span><span class="token punctuation">(</span>LinScheduleMode<span class="token punctuation">,</span> Schedule1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>And finally the corresponding rules for the LIN schedule table LinSchedule2:</p></blockquote><p>æœ€åä¸º LIN è¿›åº¦è¡¨ LinSchedule2 æä¾›äº†ç›¸åº”çš„è§„åˆ™:</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule LinChannel1Schedule2Request initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>LinChannel1ScheduleTableRequestPort <span class="token operator">==</span> Schedule2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    	<span class="token function">LinScheduleSwitch</span><span class="token punctuation">(</span>LinSchedule2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="7"></td><td><pre>rule LinChannel2Schedule1Switched initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>LinSM_CurrentState <span class="token operator">==</span> Schedule2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    	<span class="token function">RteSwitch</span><span class="token punctuation">(</span>LinScheduleMode<span class="token punctuation">,</span> LinSchedule2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>Ethernet switch port group switching</strong></p><blockquote><p>For Ethernet switch port switching it is expected that EthSwtPorts are condensed to EthIfSwitchPortGroups. EthIfSwitchGroups could be derived from the SystemDescriptionExtract.</p></blockquote><p>å¯¹äºä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£äº¤æ¢ï¼Œå¸Œæœ›æŠŠ EthSwtPorts å‹ç¼©ä¸º EthIfSwitchPortGroupsã€‚ EthIfSwitchGroups å¯ä»¥ä» SystemDescriptionExtract ä¸­æ´¾ç”Ÿã€‚</p><blockquote><p>According to the modelling each EthSwitchPortGroup is mapped to at least one PNC. The switching of EthIfSwitchPortGroup is realized with particular BswM rules.</p></blockquote><p>æ ¹æ®è¯¥æ¨¡å‹ï¼Œæ¯ä¸ª EthSwitchPortGroup è¢«æ˜ å°„åˆ°è‡³å°‘ä¸€ä¸ª PNCã€‚<br>EthIfSwitchPortGroup çš„åˆ‡æ¢æ˜¯ç”¨ç‰¹å®šçš„ BswM è§„åˆ™å®ç°çš„ã€‚</p><blockquote><p>Therefore, ComM reports the current mode of a PNC via BswM_ComM_CurrentPNCMode. The mapping between PNCs and EthSwitchPortGroup is known by the BswM.</p></blockquote><p>å› æ­¤ï¼ŒComM é€šè¿‡ BswM_ComM_CurrentPNCMode æŠ¥å‘Š PNC çš„å½“å‰æ¨¡å¼ã€‚PNCs ä¸ EthSwitchPortGroup ä¹‹é—´çš„æ˜ å°„ç”±åœ¨ BswM è¿™ ã€‚</p><blockquote><p>Thus, the BswM forward the reported current mode of a PNC to the EthIf by calling EthIf_SwitchPortGroupRequestMode with corresponding EthIfSwitchPortGroup.</p></blockquote><p><strong>å› æ­¤ï¼ŒBSwM é€šè¿‡è°ƒç”¨å…·æœ‰ç›¸åº” EthIfSwitchPortGroup çš„ EthIf_SwitchPortGroupRequestMode å°†æŠ¥å‘Šçš„ PNC å½“å‰æ¨¡å¼è½¬å‘åˆ° Ethlfã€‚</strong></p><blockquote><p>According to the given PortMode (either ETH_MODE_DOWN or ETH_MODE_ACTIVE) the EthIf manages the requests for EthIfSwitchPortGroups and decides to switch off or switch on EthSwtPorts.</p></blockquote><p>æ ¹æ®ç»™å®šçš„ PortMode (ETH_MODE_DOWN æˆ– ETH_MODE_ACTIVE)ï¼ŒEthlf ç®¡ç† EthIfSwitchPortGroups çš„è¯·æ±‚ï¼Œå¹¶å†³å®šå…³é—­æˆ–æ‰“å¼€ EthSwtPortsã€‚</p><blockquote><p>To illustrate how the switching of EthIfSwitchPortGroups can be managed the following scenario is created. The exemplary ECU shall have two partial networks (named PNC1 and PNC2) and two according EthIfSwtPortGroups (named EthIfSwtPortGroup1 and EthIfSwtPortGroup2) configured:</p></blockquote><p>ä¸ºäº†è¯´æ˜å¦‚ä½•ç®¡ç† EthIfSwitchPortGroups çš„åˆ‡æ¢ï¼Œåˆ›å»ºäº†ä»¥ä¸‹åœºæ™¯ã€‚ç¤ºä¾‹ ECU åº”é…ç½®ä¸¤ä¸ªéƒ¨åˆ†ç½‘ç»œ (åç§°ä¸º PNC1 å’Œ PNC2) å’Œä¸¤ä¸ªç›¸åº”çš„ EthIfSwtPortGroups (åç§°ä¸º EthIfSwtPortGroup1 å’Œ EthIfSwtPortGroup2)</p><blockquote><ul><li>If PNC1 is requested,than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup1 and ETH_MODE_ACTIV</li><li>If PNC1 is released, than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup1 and ETH_MODE_DOWN</li><li>If PNC2 is requested, than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup2 and ETH_MODE_ACTIVE</li><li>If PNC2 is released,than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup2 and ETH_MODE_DOWN</li></ul></blockquote><blockquote><p>If a partial network is requested than the corresponding EthSwtPortGroup is switched on.</p></blockquote><p>å¦‚æœè¯·æ±‚çš„éƒ¨åˆ†ç½‘ç»œåˆ™æ‰“å¼€ç›¸åº”çš„ EthSwtPortGroup</p><p><strong>Listing 3.26: ComM reports the transition to COMM_PNC_FULL_COMMUNICATION</strong></p><pre><code class="language-C">rule pnc1requested initially false {
    if ( PNC1 == COMM_PNC_REQUESTED ||
        PNC1 == COMM_PNC_READY_SLEEP ||
        PNC1 == COMM_PNC_PREPARE_SLEEP ){
        	actionlist pnc1requestedActions
    }
}
actions pnc1requestedActions on condition {
    EthIfSwitchPortGroupRequestMode {
        init false
        enable EthIfSwtPortGroup1
    }
}
rule pnc2requested initially false {
    if ( PNC2 == COMM_PNC_REQUESTED ||
        PNC2 == COMM_PNC_READY_SLEEP ||
        PNC2 == COMM_PNC_PREPARE_SLEEP ){
        	actionlist pnc2requestedActions
    }
}
actions pnc2requestedActions on condition {
    EthIfSwitchPortGroupRequestMode {
        init false
        enable EthIfSwtPortGroup2
    }
}
</code></pre><p><strong>Listing 3.27: ComM reports COMM_PNC_NO_COMMUNICATION</strong></p><p><strong>Ethernet switch port group switching with wake-up request</strong></p><blockquote><p>AUTOSAR supports the handling for OA TC10 compatible Ethernet hardware to sleep/wake-up over dataline. In combination with PNC handling and the Ethernet switch port group switching, the ComM indicate the BswM for an active PNC request with a wake-up request by reporting COMM_PNC_REQUESTED_WITH_WAKEUP_REQUEST.</p></blockquote><p>AUTOSAR æ”¯æŒå¤„ç† OA TC10 å…¼å®¹ä»¥å¤ªç½‘ç¡¬ä»¶çš„ä¼‘çœ  / å”¤é†’æ•°æ®çº¿ã€‚ç»“åˆ PNC å¤„ç†å’Œä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£ç»„äº¤æ¢ï¼ŒComM é€šè¿‡ COMM_PNC_REQUESTED_WITH_WAKEUP_REQUEST æ¥æŒ‡ç¤º BswM å…·æœ‰å”¤é†’è¯·æ±‚çš„æ´»è·ƒçš„ PNC ã€‚</p><blockquote><p>The BswM forwards the active PNC to the EthIf by calling EthIf_SwitchPortGroupRequestMode with the corresponding EthIfSwtPortGroup and the corresponding Eth_ModeType ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST.</p></blockquote><p>BswM é€šè¿‡è°ƒç”¨ EthIf_SwitchPortGroupRequestModeï¼Œå¹¶å°†ç›¸åº”çš„ EthIfSwtPortGroup å’Œç›¸åº”çš„ Eth_ModeType ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST ä¼ é€’ç»™ Ethlfï¼Œå°†æ´»åŠ¨çš„ PNC è½¬å‘ç»™ Ethlfã€‚</p><blockquote><p>Based on the exemplary configuration in chapter 3.4.8 Ethernet switch port group switching, the following example illustrates the Ethernet switch port switching with wake-up on dataline request:</p></blockquote><p>åŸºäºç¬¬ 3.4.8 ç« ä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£ç»„äº¤æ¢ä¸­çš„ç¤ºä¾‹é…ç½®ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†åœ¨ dataline è¯·æ±‚æ—¶å”¤é†’ä»¥å¤ªç½‘çš„äº¤æ¢æœºçš„ port</p><blockquote><ul><li>If PNC1 is requested, than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup1 and ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST</li><li>If PNC2 is requested, than EthIf_SwitchPortGroupRequestMode is called with EthSwtPortGroup2 and ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST</li></ul></blockquote><blockquote><p>If a partial network is requested and the Ethernet hardware supports and uses<br>the wake-up on dataline,</p><p>than the corresponding EthSwtPortGroup is switched<br>on</p><p>and the request for a wake-up over dataline is reported by the Eth_ModeType<br>ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST.</p></blockquote><p>å¦‚æœè¯·æ±‚éƒ¨åˆ†ç½‘ç»œï¼Œå¹¶ä¸”ä»¥å¤ªç½‘ç¡¬ä»¶æ”¯æŒå¹¶ä½¿ç”¨æ•°æ®çº¿ä¸Šçš„å”¤é†’ï¼Œ</p><p>åˆ™ç›¸åº”çš„ EthSwtPortGroup è¢«æ‰“å¼€ï¼Œ</p><p>å¹¶ä¸”é€šè¿‡ Eth_ModeType ETH_MODE_ACTIVE_WITH_WAKEUP_REQUEST æŠ¥å‘Šå¯¹æ•°æ®çº¿ä¸Šå”¤é†’çš„è¯·æ±‚ã€‚</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule pnc1requested_with_wakeup_request initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC1 <span class="token operator">==</span> COMM_PNC_REQUESTED_WITH_WAKEUP_REQUEST<span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    	actionlist pnc1requested_with_wakeup_request_Actions</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>actions pnc1requested_with_wakeup_request_Actions on condition</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    EthIfSwitchPortGroupRequestMode <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        init false</pre></td></tr><tr><td data-num="10"></td><td><pre>        enable EthIfSwtPortGroup1</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre>rule pnc2requested_with_wakeup_request initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC2 <span class="token operator">==</span> COMM_PNC_REQUESTED_WITH_WAKEUP_REQUEST<span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    	actionlist pnc2requested_with_wakeup_request_Actions</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="18"></td><td><pre>actions pnc2requested_with_wakeup_request_Actions on condition</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    EthIfSwitchPortGroupRequestMode <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        init false</pre></td></tr><tr><td data-num="22"></td><td><pre>        enable EthIfSwtPortGroup1</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>Besides the management of requests for EthIfSwitchPortGroup switching, the EthIf supervises the accumulated link state per EthSwitchPortGroup. If the EthIf detects an unexpected change of the accumulated link state of the EthIfSwitchPortGroup, the EthIf indicates this link state change by calling BswM_EthIf_PortGroupLinkStateChg of the affected EthIfSwitchPortGroup. This indication could be forwarded to the application via a ModeSwitch to react on such communication errors scenarios (e.g. Ethernet switch port hardware error, loose connection of the dataline,... a.s.o.).</p></blockquote><p>EthIf ä¹Ÿä¼šå»ç›‘æ§ port çš„ link çŠ¶æ€ï¼Œå½“ port link status å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè°ƒç”¨ BswM_EthIf_PortGroupLinkStateChg () æ¥åšä¸€äº›å¤„ç†ã€‚</p><p><strong>PduR routing path group switching</strong></p><blockquote><p>PduR routing path group switching is used to switch routing path of I-PDUs which are not assigned to a Com I-PDU group (see chapter 3.4.4 I-PDU Group Switching),</p><p>e.g I-PDUs transmitted via LdCom. LdCom has not the capability to control I-PDU groups as it is provided by Com.</p></blockquote><p>PduR è·¯ç”±è·¯å¾„ç»„äº¤æ¢ç”¨äºäº¤æ¢æœªåˆ†é…ç»™ Com I-PDU ç»„çš„ L-PDUs çš„è·¯ç”±è·¯å¾„ (è¯·å‚é˜…ç¬¬ 3.4.4 èŠ‚ I-PDU ç»„äº¤æ¢)</p><p>ä¾‹å¦‚é€šè¿‡ LdCom ä¼ è¾“çš„ I-PDUsã€‚LdCom æ²¡æœ‰ Com æä¾›çš„æ§åˆ¶ I-PDU ç¾¤çš„èƒ½åŠ›ã€‚</p><blockquote><p>Therefore it is possible to control the affected PudR routing paths by configured PduR routing path groups (similar to I-PDU groups in Com).</p></blockquote><p>å› æ­¤ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„ PduR è·¯ç”±è·¯å¾„ç»„ (ç±»ä¼¼äº com ä¸­çš„ I-PDU ç»„) æ¥æ§åˆ¶å—å½±å“çš„ PudR è·¯ç”±è·¯ç”±ã€‚</p><blockquote><p>The PduR routing path groups are controlled via the following API: PduR_EnableRouting(&lt;routing path group id&gt;) and PduR_DisableRouting(&lt;routing path group id&gt;).</p></blockquote><p>ä¿© API</p><blockquote><p>The APIs could be called by BswM based on particular BswM rules. This enable the switching of PduR routing path groups in combination with partial networking,</p><p>e.g. ComM indicate the current PNC state to BswM, BswM evaluate the trigger conditions of the dedicated BswM rules and trigger the BswM action (control the PduR routing path groups).</p></blockquote><p><strong>ä¹Ÿå°±æ˜¯è¯´ ComM å‘Šè¯‰ BswM å½“å‰ PNC çš„çŠ¶æ€ï¼Œç„¶å BswM æ ¹æ®ä½ ç‰¹å®šçš„è§„åˆ™å»å¤„ç†</strong></p><blockquote><p>Please note:</p><ul><li>If I-PDUs should be controlled, then it is recommended to control Com I-PDUs via Com I-PDU groups and the remaining I-PDUs via switching of PduR routing path groups.</li></ul></blockquote><p>å¦‚æœåº”è¯¥æ§åˆ¶ I-PDUs</p><p>é‚£ä¹ˆå»ºè®®é€šè¿‡ Com I-PDU ç»„æ¥æ§åˆ¶ Com I-PDUs</p><p>é€šè¿‡åˆ‡æ¢ PduR è·¯ç”±è·¯å¾„ç»„æ¥æ§åˆ¶å…¶ä½™çš„ I-PDUã€‚</p><blockquote><p>The following scenarios illustrate how PduR routing path groups of an ECU can be managed. The exemplary ECU shall have one physical Ethernet channel with two VLANs and three partial network clusters.</p></blockquote><p>ä¸‹é¢çš„åœºæ™¯è¯´æ˜å¦‚ä½•ç®¡ç†ä¸€ä¸ª ECU çš„ PduR è·¯ç”±è·¯å¾„ç»„ã€‚ç¤ºä¾‹ ECU åº”æœ‰ä¸€ä¸ªç‰©ç†ä»¥å¤ªç½‘ä¿¡é“ä¸ä¸¤ä¸ª VLAN å’Œä¸‰ä¸ªéƒ¨åˆ†ç½‘ç»œé›†ç¾¤ã€‚</p><blockquote><p>The mode request ports for the VLANs are named EthSM_Vlan1 and EthSM_Vlan2, the request sources for the partial network clusters are named PNC1, PNC2 and PNC3. I-PDUs of PNC1 shall be communicated only over Vlan1. I-PDUs of PNC2 shall be communicated over Vlan1 and Vlan2. I-PDUs of PNC3 shall be communicated only over Vlan2. In case of an indication by a bus state manager the BswM shall check, which partial network clusters are requested.</p></blockquote><p><strong>Listing 3.29: Active wakeup on channel</strong></p><pre><code class="language-ABAP">rule activeWakeupVlan1 initially false {
    if ( EthSM_Vlan1 == ETHSM_BSWM_FULL_COMMUNICATION){
    	actionlist activeWakeupVlan1Actions
    }
}
actions activeWakeupVlan1Actions on condition{
	rule pnc1requested rule pnc2requested
}
rule activeWakeupVlan2 initially false{
    if ( EthSM_Vlan2 == ETHSM_BSWM_FULL_COMMUNICATION &amp;&amp;
    PNC2 != PNC_REQUESTED &amp;&amp;
    PNC3 != PNC_REQUESTED ) {
    	actionlist activeWakeupVlan2Actions
    }
}
actions activeWakeupVlan2Actions on condition{
    rule pnc2requested rule pnc3requested
}
</code></pre><blockquote><p>If the bus state manager reports that a VLAN is going offline the BswM disable the corresponding I-PDU routing path groups. If the channel is part of a partial network the whole partial network has to be disabled.</p></blockquote><p>å¦‚æœæ€»çº¿çŠ¶æ€ç®¡ç†å™¨æŠ¥å‘Š VLAN å³å°†ä¸‹çº¿ï¼Œåˆ™ BswM åº”ç¦ç”¨ç›¸åº”çš„ I-PDU è·¯ç”±è·¯å¾„ç»„ã€‚å¦‚æœä¿¡é“æ˜¯éƒ¨åˆ†ç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™å¿…é¡»ç¦ç”¨æ•´ä¸ªéƒ¨åˆ†ç½‘ç»œã€‚</p><p><strong>Listing 3.30: EthSM reports NO_COMMUNICATION</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule offlineVlan1 initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>EthSM_Vlan1 <span class="token operator">==</span> ETHSM_BSWM_NO_COMMUNICATION<span class="token punctuation">)</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	actionlist offlineVlan1Actions <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre>actions offlineVlan1Actions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>PduRRoutingPathGroupSwitch<span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    init true disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>VLAN1_IPDU_ROUTING_PATHS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC1_IPDU_ROUTING_PATHS<span class="token punctuation">,</span> ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">.</span>PNC2_IPDU_ROUTING_PATHS <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="11"></td><td><pre>rule offlineVlan2 initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> EhtSM_Can2 <span class="token operator">==</span> CANSM_BSWM_NO_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        actionlist offlineVlan2Actions</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="16"></td><td><pre>actions offlineVlan2Actions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    PduRRoutingPathGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        init true disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>VLAN2_IPDU_ROUTING_PATHS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span> PNC2_IPDU_ROUTING_PATHS<span class="token punctuation">,</span> ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            MyPduR<span class="token punctuation">.</span>PNC3_IPDU_ROUTING_PATHS</pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>In case that a single partial network cluster is released the I-PDU routing path group representing this network has to be disabled.</p></blockquote><p>å¦‚æœé‡Šæ”¾äº†å•ä¸ªéƒ¨åˆ†ç½‘ç»œé›†ç¾¤ï¼Œåˆ™å¿…é¡»ç¦ç”¨è¡¨ç¤ºè¯¥ç½‘ç»œçš„ I-PDU è·¯ç”±è·¯å¾„ç»„ã€‚</p><p><strong>Listing 3.31: PNC reports NO_COMMUNICATION</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule pnc1nocom initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC1 <span class="token operator">==</span> PNC_NO_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    	actionlist pnc1nocomTrueActions</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>actions pnc1nocomActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    PduRRoutingPathGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    	init true disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC1_IPDU_ROUTING_PATHS</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="11"></td><td><pre>rule pnc2nocom initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC2 <span class="token operator">==</span> PNC_NO_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    	actionlist pnc2nocomTrueActions</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="16"></td><td><pre>actions pnc2nocomActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    PduRRoutingPathGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    	init true disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC2_IPDU_ROUTING_PATHS</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="21"></td><td><pre>rule pnc3nocom initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC3 <span class="token operator">==</span> PNC_NO_COMMUNICATION <span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    	actionlist pnc3nocomActions</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="26"></td><td><pre>actions pnc3nocomActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    PduRRoutingPathGroupSwitch <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    	init true disable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC3_IPDU_ROUTING_PATHS</pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>If a partial network cluster is requested the corresponding I-PDU routing path groups are enabled.</p></blockquote><p>å¦‚æœè¯·æ±‚éƒ¨åˆ†ç½‘ç»œé›†ç¾¤ï¼Œåˆ™å¯ç”¨ç›¸åº”çš„ 1-PDU è·¯ç”±è·¯å¾„ç»„ã€‚</p><p><strong>Listing 3.32: PNC reports PNC_REQUESTED or PNC_READY_SLEEP</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>rule pnc1requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC1 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    PNC1 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">{</span> actionlist pnc1requestedActions <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>actions pnc1requestedActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    PduRRoutingPathGroupSwitch</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">{</span> init true enable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC1_IPDU_ROUTING_PATHS <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="10"></td><td><pre>rule pnc2requested initially false <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC2 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    PNC2 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">{</span> actionlist pnc2requestedActions <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre>actions pnc2requestedActions on condition <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    PduRRoutingPathGroupSwitch</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">{</span> init true enable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span>PNC2_IPDU_ROUTING_PATHS <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="19"></td><td><pre>rule pnc3requested initially false</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> PNC3 <span class="token operator">==</span> PNC_REQUESTED <span class="token operator">||</span> PNC3 <span class="token operator">==</span> PNC_READY_SLEEP <span class="token punctuation">)</span> <span class="token punctuation">{</span> actionlist</pre></td></tr><tr><td data-num="21"></td><td><pre>    pnc3requestedActions <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="23"></td><td><pre>actions pnc3requestedActions on condition</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">{</span> PduRRoutingPathGroupSwitch <span class="token punctuation">{</span> init true enable ArMmExample<span class="token punctuation">.</span>EcuC<span class="token punctuation">.</span>MyPduR<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    PNC2_IPDU_ROUTING_PATHS <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>Service Discovery Control</strong></p><blockquote><p>AUTOSAR offers a standard mean to control Service Oriented Communication by Application Software Components. It makes use of the generic means to do mode management with BswM.</p></blockquote><p>AUTOSAR æä¾›äº†ä¸€ç§é€šè¿‡åº”ç”¨è½¯ä»¶ç»„ä»¶æ¥æ§åˆ¶é¢å‘æœåŠ¡çš„é€šä¿¡çš„æ ‡å‡†æ–¹æ³•ï¼Œå®ƒåˆ©ç”¨é€šç”¨çš„æ–¹æ³•æ¥ä½¿ç”¨ BswM è¿›è¡Œæ¨¡å¼ç®¡ç†ã€‚</p><blockquote><p>To achieve a standard interface and behavior, the Mode Request Ports and Mode Switch Interfaces are standardized together with a configuration description for the BswM (see [4] Specification of Basic Software Mode Manager, chapter 7.8). This way not only the interfaces but also the expected behavior is well defined.</p></blockquote><p>ä¸ºäº†å®ç°æ ‡å‡†çš„æ¥å£å’Œè¡Œä¸ºï¼Œå°†æ¨¡å¼è¯·æ±‚ç«¯å£å’Œæ¨¡å¼åˆ‡æ¢æ¥å£ä¸ BswM çš„é…ç½®æè¿°ä¸€èµ·æ ‡å‡†åŒ– (å‚è§ [4] åŸºæœ¬è½¯ä»¶æ¨¡å¼ç®¡ç†å™¨è§„èŒƒï¼Œç¬¬ 7.8 ç« ). è¿™æ ·ä¸ä»…æ¥å£å®šä¹‰å¾—å¾ˆå¥½ï¼Œè€Œä¸”é¢„æœŸçš„è¡Œä¸ºä¹Ÿå¾ˆå¥½çš„å®šä¹‰äº†ã€‚</p><blockquote><p>The configuration description is meant to be used for the tooling to generate a matching set of rules and actionlists to provide the actual control of service discovery.</p></blockquote><p>é…ç½®æè¿°æ—¨åœ¨ç”¨äºå·¥å…·ç”Ÿæˆä¸€ç»„åŒ¹é…çš„ rules å’Œ actionlists ï¼Œä»¥æä¾›å¯¹æœåŠ¡å‘ç°çš„å®é™…æ§åˆ¶ã€‚</p><blockquote><p>Both auto-offer/auto-subscribe as well as an own project-specific approach can be used in parallel.</p><p>Only exception is, that if auto-offer/auto-subscribe is used,</p><p>no applicative control is possible for the same service instance on the same ECU.</p></blockquote><p>auto-offer/auto-subscribe ä»¥åŠè‡ªå·±é¡¹ç›®çš„ç‰¹å®šæ–¹æ³•éƒ½å¯ä»¥å¹¶è¡Œä½¿ç”¨ã€‚</p><p>å”¯ä¸€çš„ä¾‹å¤–æ˜¯ï¼Œå¦‚æœä½¿ç”¨ auto-offer/auto-subscribeï¼Œåˆ™ä¸å¯èƒ½å¯¹åŒä¸€ ECU ä¸Šçš„åŒä¸€æœåŠ¡å®ä¾‹è¿›è¡Œåº”ç”¨æ§åˆ¶ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240814155205768.png" alt="image-20240814155205768"></p><blockquote><p>In order to be able to use the standard means for Service Discovery control, it has to be taken into account already at design time of the Application-SWCs.</p></blockquote><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨æ ‡å‡†çš„æœåŠ¡å‘ç°æ§åˆ¶æ‰‹æ®µï¼Œåœ¨åº”ç”¨ç¨‹åº - SWC çš„è®¾è®¡æ—¶å°±å¿…é¡»è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</p><blockquote><p>While the fact that the use cases are required must be known at design time, the actual interfaces are completely agnostic to which SOA technology they will be applied.</p></blockquote><p>è™½ç„¶åœ¨è®¾è®¡æ—¶å¿…é¡»çŸ¥é“éœ€è¦ç”¨ä¾‹è¿™ä¸€äº‹å®ï¼Œä½†å®é™…çš„æ¥å£å®Œå…¨ä¸çŸ¥é“ä¼šè¢«åº”ç”¨åˆ°å“ªä¸ª SOA æŠ€æœ¯ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240814155658948.png" alt="image-20240814155658948"></p><blockquote><p>For a SWC to be able to request the subscription to one or more events a corresponding S/R-port is needed.</p></blockquote><p>å¯¹äº SWC è¦èƒ½å¤Ÿè¯·æ±‚è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªæ´»åŠ¨ï¼Œå°±éœ€è¦ç›¸åº”çš„ S/R portã€‚</p><blockquote><p>The fact that this port shall be used to interact with ServiceDiscovery is expressed by setting ServiceNeedsKind to BswMgrNeeds.</p></blockquote><p>é€šè¿‡å°† ServiceNeedsKind è®¾ç½®ä¸º BswMgrNeeds æ¥è¡¨ç¤ºè¯¥ç«¯å£åº”ç”¨äºä¸ ServiceDiscovery äº¤äº’.</p><blockquote><p>The kind of interaction is determined by the RoleBasedDataAssignment which could be one of</p><ul><li>ClientEventSubscription</li><li>ClientEventSubscriptionStatus</li><li>ServerServiceOffer</li><li>ServerEventSubscriptionStatus</li></ul></blockquote><p>æœ‰è¿™ä¹ˆå‡ ä¸ªç±»å‹çš„äº¤äº’ç§ç±»</p><blockquote><p>The mapping to the actual payload ports (i.e. events/methods) is provided by referencing all Event-/Method-Ports relevant for this request/notification in RepresentedPort Group.</p></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240814160230207.png" alt="image-20240814160230207"></p><blockquote><p>The mapping is done at design time.</p></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240814160522126.png" alt="image-20240814160522126"></p><h3 id="35-diagnostics"><a class="anchor" href="#35-diagnostics">#</a> 3.5 Diagnostics</h3><blockquote><p>In AUTOSAR release 4.0.3 onwards the DCM is the overall mode manager for all diagnostic use cases. The BswM is responsible to change the state of the other basic software modules accordingly.</p></blockquote><p>åœ¨ AUTOSAR4.0.3 ç‰ˆä¹‹åï¼ŒDCM æ˜¯æ‰€æœ‰è¯Šæ–­ç”¨ä¾‹çš„æ€»ä½“æ¨¡å¼ç®¡ç†å™¨ï¼ŒBswM è´Ÿè´£ç›¸åº”åœ°æ”¹å˜å…¶ä»–åŸºæœ¬è½¯ä»¶æ¨¡å—çš„çŠ¶æ€ã€‚</p><p><strong>Diagnostic Session Control</strong></p><p>ä¾‹å­</p><p><strong>Listing 3.33: ModeGroup for session control service of the DCM</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>modeGroup DcmDiagnosticSessionControl <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    DefaultSession<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    ProgrammingSession<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    ExtendedDiagnosticSession<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    SafetySystemDiagnosticSession<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    AllSessionLevel</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="8"></td><td><pre>interface modeSwitch MSIF_DcmDiagnosticSessionControl <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    mode DcmDiagnosticSessionControl diagnosticSessionControl</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>The DCM acting as a mode manager can inform other BSW modules about the current mode of the session control service and if needed set the basic software in the<br>corresponding mode.</p></blockquote><p>DCM ä½œä¸ºæ¨¡å¼ç®¡ç†å™¨ï¼Œå¯ä»¥å°†ä¼šè¯æ§åˆ¶æœåŠ¡çš„å½“å‰æ¨¡å¼é€šçŸ¥å…¶ä»– BSW æ¨¡å—å¹¶åœ¨éœ€è¦æ—¶å°† Bsw è®¾ç½®åœ¨ç›¸åº”çš„æ¨¡å¼ä¸­ã€‚</p><p><strong>Listing 3.34: ModeRequestPort for session control service of the DCM</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>request BswModeNotification DiagnosticSessionControl <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    source MSIF_DcmDiagnosticSessionControl<span class="token punctuation">.</span>diagnosticSessionControl</pre></td></tr><tr><td data-num="3"></td><td><pre>    processing IMMEDIATE</pre></td></tr><tr><td data-num="4"></td><td><pre>    initialValue DefaultSession</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>ECU Reset</strong></p><blockquote><p>In case of ECU Reset, the interaction between DCM and BswM is more complex. The Specification of the Diagnostic Communication Manager [5] specifies for this purpose the interface as described in listing 3.35. Via this interface the DCM signals the BswM to</p><ol><li>prepare the ECU to execute a specific reset.</li><li>to explicitly execute this reset.</li></ol></blockquote><p>åœ¨ ECU reset çš„æƒ…å†µä¸‹ï¼ŒDCM ä¸ BswM çš„äº¤äº’æ›´åŠ å¤æ‚ã€‚è¯Šæ–­é€šä¿¡ç®¡ç†å™¨è§„èŒƒ [5] ä¸ºæ­¤ç›®çš„æŒ‡å®šæ¸…å• 3.35 ä¸­æè¿°çš„æ¥å£ã€‚é€šè¿‡è¯¥æ¥å£ï¼ŒDCM å‘ BswM å‘é€ä¿¡å·åˆ°<br>1. ä¸º ECU æ‰§è¡Œç‰¹å®š reset åšå¥½å‡†å¤‡ã€‚<br>2. ä»¥æ˜¾å¼æ‰§è¡Œæ­¤ resetã€‚</p><p><strong>Listing 3.35: Mode switch interface for ECU reset diagnostic service</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>modeGroup DcmEcuReset<span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    NONE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    HARD<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    KEYONOFF<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    SOFT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    JUMPTOBOOTLOADER<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    JUMPTOSYSSUPPLIERBOOTLOADER <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    EXECUTE</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="10"></td><td><pre>interface modeSwitch MSIF_DcmEcuReset <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    mode DcmEcuReset ecureset</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><blockquote><p>[SWS_Dcm_00373] states that on reception of a request for UDS Service with the sub functions other than enableRapidPowerShutDown (0x04) or disableRapidPower ShutDown (0x05), the DCM module shall switch the ModeDeclarationGroupPrototype DcmEcuReset to the received resetType. After the mode switch is requested the DCM triggers the start of the positive response message transmission.</p></blockquote><p>å¥½åƒæ˜¯åºŸè¯å“ˆå“ˆå“ˆ</p><p><strong>Rapid Power Shutdown</strong></p><p>enableRapidPowerShutdown (0x04) or disableRapidPowerShutdown (0x05)</p><p>è¿™ä¸ªæ§åˆ¶çš„ï¼Œå½“ç„¶å¦‚æœæœ‰ç‰¹å®šçš„ä¸‹ç”µåºåˆ—ï¼Œä¹Ÿå¯ä»¥æä¾›ç»™ BswM</p><p><strong>Communciation Control diagnostic service</strong></p><blockquote><p>If the DCM reports to the BswM that a specified communication control mode is entered, the BswM has to enable resp. disable the corresponding IPDU groups as shown in listing 3.38.</p></blockquote><p>å¦‚æœ DCM å‘ BswM æŠ¥å‘Šè¾“å…¥äº†æŒ‡å®šçš„é€šä¿¡æ§åˆ¶æ¨¡å¼ï¼Œåˆ™ Bswm å¿…é¡»å¯ç”¨ resp. ç¦ç”¨ç›¸åº”çš„ IPDU ç»„</p><p><strong>Control DTC Setting</strong></p><p><strong>Listing 3.39: Mode switch interface for Control of DTC setting</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>modeGroup DcmControlDTCSetting <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ENABLEDTCSETTING<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DISABLEDTCSETTING</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre>interface modeSwitch MSIF_DcmControlDtcSetting <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    mode DcmControlDTCSetting dtcSetting</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><strong>Roe Status</strong></p><blockquote><p>The Dcm will switch the current status of the Roe per configured Roe Event via a mode switch of ModeDeclarationGroupPrototype DcmResponseOnEvent_&lt;RoeEventID&gt; switching the mode to EVENT_STARTED, EVENT_STOPPED and EVENT_CLEARED.</p><p>The information is necessary mainly for applications that need to interact with the Dcm if the events shall be triggered from external.</p></blockquote><p>Dcm å°†é€šè¿‡æ¨¡å¼å¼€å…³ ModeDeclarationGroupPrototype DcmResponseOnEvent_ &lt;Roe EventID&gt; å°† Roe äº‹ä»¶çš„å½“å‰çŠ¶æ€åˆ‡æ¢ä¸º EVENT_STARTEDã€EVENT_STOPPED å’Œ EVENT_CLEAREDï¼Œä»¥é…ç½® Roe äº‹ä»¶ã€‚</p><p>å¦‚æœäº‹ä»¶è¦ä»å¤–éƒ¨è§¦å‘ï¼Œè¿™äº›ä¿¡æ¯ä¸»è¦å¯¹éœ€è¦ä¸ DCM äº¤äº’çš„åº”ç”¨ç¨‹åºæ˜¯å¿…è¦çš„ã€‚</p><p><strong>Listing 3.40: Mode switch interface for Roe Status</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>ModeGroup DcmResponseOnEvent_<span class="token operator">&lt;</span>RoeEventID<span class="token operator">&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    EVENT_STARTED<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    EVENT_STOPPED<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    EVENT_CLEARED</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>interface modeSwitch MSIF_DcmResponseOnEvent<span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    mode DcmResponseOnEvent currentMode</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><h3 id="36-bswm-to-bswm-interaction-on-multicore-ecus"><a class="anchor" href="#36-bswm-to-bswm-interaction-on-multicore-ecus">#</a> 3.6 BswM to BswM interaction on multicore ECUs</h3><blockquote><p>The BswM mainly interacts with the state managers of the functional clusters, e.g. with the ComM, and should therefore be locally available on the same partition in order to limit inter-core communication as much as possible.</p></blockquote><p>BswM ä¸»è¦ä¸åŠŸèƒ½é›†ç¾¤çš„çŠ¶æ€ç®¡ç†å™¨è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚ä¸ ComM è¿›è¡Œäº¤äº’ï¼Œå› æ­¤åº”è¯¥åœ¨åŒä¸€åˆ†åŒºä¸Šæœ¬åœ°å¯ç”¨ï¼Œä»¥å°½å¯èƒ½é™åˆ¶å†…æ ¸ä¹‹é—´çš„é€šä¿¡ã€‚</p><blockquote><p>Therefore, the BswM can be distributed over multiple partitions containing BSW modules. These independent BswMs have partition specific configuration sets. The synchronization of the different partition local BswM instances can be accomplished by normal mode-communication (mode request, mode switch) between BswM service components.</p></blockquote><p>å› æ­¤ï¼ŒBSwM å¯ä»¥åˆ†å¸ƒåœ¨åŒ…å« BSW æ¨¡å—çš„å¤šä¸ªåˆ†åŒºä¸­ã€‚è¿™äº›ç‹¬ç«‹çš„ BswMs å…·æœ‰åˆ†åŒºç‰¹å®šçš„é…ç½®é›†ã€‚ä¸åŒåˆ†åŒºæœ¬åœ° BswM å®ä¾‹ä¹‹é—´çš„åŒæ­¥å¯ä»¥é€šè¿‡ BswM æœåŠ¡ç»„ä»¶ä¹‹é—´çš„æ­£å¸¸æ¨¡å¼é€šä¿¡ (æ¨¡å¼è¯·æ±‚ï¼Œæ¨¡å¼åˆ‡æ¢) æ¥å®ç°ã€‚</p><blockquote><p>If a partition of the ECU contains BSW modules running inside the partition, the partition would also have a partition local BswM.</p></blockquote><p>å¦‚æœ ECU çš„åˆ†åŒºåŒ…å«åœ¨è¯¥åˆ†åŒºå†…éƒ¨è¿è¡Œçš„ BSW æ¨¡å—ï¼Œåˆ™è¯¥åˆ†åŒºä¹Ÿå°†æœ‰ä¸€ä¸ªåˆ†åŒºæœ¬åœ° BsWMã€‚</p><blockquote><p>A partition local BswM is responsible for the complete initialization of the BSW Modules within its partition. As the initialization sequence largely depends on the distribution of the modules in different partitions, this has a big impact on the configuration of all partition local BswMs.</p></blockquote><p>åˆ†åŒºæœ¬åœ° BSwM è´Ÿè´£å…¶åˆ†åŒºå†…çš„ BSW æ¨¡å—çš„å®Œæ•´åˆå§‹åŒ–ã€‚æ¯ä¸ªåˆ†åŒºå†…çš„ BswM çš„é…ç½®å¾ˆå…³é”®</p><blockquote><p>Each partition local BswM has the job of coordinating the initialization of the BSW modules which are running in its partition.</p></blockquote><p>æ¯ä¸ªåˆ†åŒºæœ¬åœ° BSwM è´Ÿè´£åè°ƒåœ¨å…¶åˆ†åŒºä¸­è¿è¡Œçš„ Bsw æ¨¡å—çš„åˆå§‹åŒ–ã€‚</p><blockquote><p>Each instance of the BswM will then take care of the correct initialization and deinitialization of the partition local BSW modules, so that the following scenarios can be realized:</p></blockquote><p>ç„¶åï¼ŒBswM çš„æ¯ä¸ªå®ä¾‹å°†å¤„ç†åˆ†åŒºæœ¬åœ° Bsw æ¨¡å—çš„æ­£ç¡®åˆå§‹åŒ–å’Œå»åˆå§‹åŒ–ï¼Œä»è€Œå¯ä»¥å®ç°ä»¥ä¸‹åœºæ™¯:</p><blockquote><ul><li>Startup up: After startup of the OS, each EcuM will hand over control to the partition local BswM, which then takes care of the initialization of the other partition local BSW Modules. Afterwards, the partition local BswM signals the readiness of the partition to the other BswM instances running in other partitions. This signalling is done using normal mode-communication between the BswM service components.</li><li>Shutdown: The partition local BswM determines via its ModeRequestSources, whether it can be shut down or not. If this is the case, it signals its current state to the other BswM instances running in other partitions. This signalling is done using normal mode communication between the BswM service components. The BswM placed inside the partition of the Master EcuM can then decide on this information whether it initiates a shutdown of the ECU.</li><li>Deinitialization: The BswM (on the partition where the Master EcuM is running inside) can signal the other BswMs that it wants to shutdown the ECU. This signalling is done using normal mode-communication between the BswM service components. The other BwsMs can then deinitialize the modules running inside their partition in order to enable a clean shutdown.</li><li>Restart of a partition: If a partition is restarted, the local BswM signals to the other BswM instances that it is in a restart mode. This signalling is done using normal mode communication between the BswM service components. Then, the other BswMs can determine if local applications need to be informed or potentially restarted, and how to synchronize them to the newly started partition.</li></ul></blockquote><h3 id="37-inter-partition-actions"><a class="anchor" href="#37-inter-partition-actions">#</a> 3.7 Inter-partition Actions</h3><blockquote><p>The BswM does not implement mechanisms to prevent the execution of actions which affect modules residing on another partition.</p></blockquote><p>BswM ä¸å®ç°é˜»æ­¢æ‰§è¡Œå½±å“é©»ç•™åœ¨å¦ä¸€åˆ†åŒºçš„æ¨¡å—çš„æ“ä½œçš„æœºåˆ¶ã€‚</p><blockquote><p>The configurator of the BswM needs to be aware of this during the configuration of BswM actions. Generally, the BswM can safely execute actions which affect its own partition, but special consideration on the part of the configurator must be given when configuring a BswM action which affects another partition.</p></blockquote><p>åœ¨é…ç½® BswM æ“ä½œæ—¶ï¼ŒBswM çš„é…ç½®å™¨éœ€è¦æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ BswM å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œå½±å“å…¶è‡ªèº«ä»½åŒºçš„æ“ä½œï¼Œä½†å½“é…ç½®å½±å“å¦ - ä¸ªåˆ†åŒºçš„ BswM æ“ä½œæ—¶å¿…é¡»ç‰¹åˆ«è€ƒè™‘é…ç½®å™¨çš„éƒ¨åˆ†ã€‚</p><blockquote><p>When configuring a cross-partition action, care must be taken to ensure tha the cross-partition action (in implementation, a function call to another partition) can be executed safely and without endangering system performance or stability.</p></blockquote><p>å½“é…ç½®è·¨åˆ†åŒºæ“ä½œæ—¶ï¼Œå¿…é¡»æ³¨æ„ç¡®ä¿è·¨åˆ†åŒºæ“ä½œ (åœ¨å®ç°ä¸­ï¼Œå¯¹å¦ä¸€ä¸ªåˆ†åŒºçš„å‡½æ•°è°ƒç”¨) å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ä¼šå±åŠç³»ç»Ÿæ€§èƒ½æˆ–ç¨³å®šæ€§ã€‚</p><blockquote><p>If necessary, the implementor of a function needs to state limitations with respect to its usage(e.g. â€™not prepared to be called cross-partition with memory protection enabledâ€™).</p></blockquote><p>å¦‚æœæœ‰å¿…è¦ï¼Œå‡½æ•°çš„å®ç°è€…éœ€è¦å¯¹å®ƒçš„ä½¿ç”¨çŠ¶æ€è¿›è¡Œé™åˆ¶ (ä¾‹å¦‚ä¸å‡†å¤‡åœ¨å¯ç”¨å†…å­˜ä¿æŠ¤çš„æƒ…å†µä¸‹è¢«ç§°ä¸ºäº¤å‰åˆ†åŒºâ€™)ã€‚</p><blockquote><p>Among other things, the following issues need to be considered on the part of the configurator of cross-partition actions: memory protection, stopping/restarting of partitions, and proper preparation of the calleeâ€™s (i.e. the recipient of the action) partition.</p></blockquote><p>è·¨åˆ†åŒºæ“ä½œçš„é…ç½®å™¨éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼šå†…å­˜ä¿æŠ¤ã€åˆ†åŒºåœæ­¢é‡æ–°å¯åŠ¨ä»¥åŠæ­£ç¡®å‡†å¤‡è¢«è°ƒç”¨æ–¹ (å³æ“ä½œçš„æ¥æ”¶æ–¹) çš„åˆ†åŒºã€‚</p><h3 id="38-inter-partition-requestsindications"><a class="anchor" href="#38-inter-partition-requestsindications">#</a> 3.8 Inter-partition Requests/Indications</h3><blockquote><p>If the BswM is integrated in a multi-partition ECU, mode requests and/or mode indications could possibly be sent across partition boundaries to the BswM.</p></blockquote><p>å¦‚æœ BswM é›†æˆåœ¨å¤šåˆ†åŒº ECU ä¸­ï¼Œåˆ™å¯èƒ½è·¨åˆ†åŒºè¾¹ç•Œå‘ BswM å‘é€æ¨¡å¼è¯·æ±‚å’Œ / æˆ–æ¨¡å¼æŒ‡ç¤ºã€‚</p><blockquote><p>In the case of a mode request/indication which crosses a partition via the Rte (e.g. BswMSwcModeRequest), the configurator does not need to take special considerations regarding system stability or data consistency, the Rte handles the communication of this type of cross-partition mode request/indication.</p></blockquote><p>å¦‚æœæ¨¡å¼è¯·æ±‚ / æŒ‡ç¤ºé€šè¿‡ Rte è·¨è¶Šåˆ†åŒº (ä¾‹å¦‚ BswMSwcModeRequest)ï¼Œåˆ™é…ç½®å™¨ä¸éœ€è¦ç‰¹åˆ«è€ƒè™‘ç³»ç»Ÿç¨³å®šæ€§æˆ–æ•°æ®ä¸€è‡´æ€§ï¼ŒRte ä¼šå¤„ç†æ­¤ç±»è·¨åˆ†åŒºæ¨¡å¼è¯·æ±‚ / æŒ‡ç¤ºçš„é€šä¿¡ã€‚</p><blockquote><p>However, if the cross-partition mode request/indication comes directly from a BSW module (e.g. BswMComMIndication) or from a generic source (e.g. BswMGenericRequest), the configurator must take special considerations, for example:</p><ol><li><p>When the configurator uses memory protection, memory sections which are in volved in cross-partition mode requests/indications (e.g. BswM-internal status flags) need to be configured to allow such cross-partition access.</p></li><li><p>Cross-partition Mode requests/indications which are configured with IMMEDIATE processing may also trigger an immediately executed actionlist. The resultant actions will be executed in the context of the caller (e.g. a BSW module in another partition). For these IMMEDIATE cross-partition mode requests/indication, the same issues as in chapter "Inter-partition Actions" also need to be considered.</p></li></ol></blockquote><p>ç„¶è€Œï¼Œå¦‚æœè·¨åˆ†åŒºæ¨¡å¼è¯·æ±‚ / æŒ‡ç¤ºç›´æ¥æ¥è‡ª BSW æ¨¡å— (ä¾‹å¦‚ BswMComMIndication) æˆ–æ¥è‡ªé€šç”¨æº (ä¾‹å¦‚ BswMGenericRequest) é‚£é…ç½®å¾—ç‰¹æ®Šè€ƒè™‘ä¾‹å¦‚ï¼š</p><ul><li>å½“é…ç½®å™¨ä½¿ç”¨å†…å­˜ä¿æŠ¤æ—¶ï¼Œæ¶‰åŠè·¨åˆ†åŒºæ¨¡å¼è¯·æ±‚ / æŒ‡ç¤ºçš„å†…å­˜æ®µ (ä¾‹å¦‚ BswM - å†…éƒ¨çŠ¶æ€æ ‡å¿—) éœ€è¦è¿›è¡Œé…ç½®ä»¥å…è®¸æ­¤ç±»è·¨åˆ†åŒºè®¿é—®ã€‚</li><li>é…ç½®äº† IMMEDIATE å¤„ç†çš„è·¨åˆ†åŒºæ¨¡å¼è¯·æ±‚ / æŒ‡ç¤ºä¹Ÿå¯èƒ½è§¦å‘ç«‹å³æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨ã€‚äº§ç”Ÿçš„åŠ¨ä½œå°†åœ¨è°ƒç”¨è€…çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ (ä¾‹å¦‚ï¼Œå¦ä¸€ä¸ªåˆ†åŒºä¸­çš„ BSW æ¨¡å—)ã€‚å¯¹äºè¿™äº› IMMEDIATE è·¨åˆ†åŒºæ¨¡å¼è¯·æ±‚ / æŒ‡æ ‡ï¼Œè¿˜éœ€è¦è€ƒè™‘ â€œè·¨åˆ†åŒºæ“ä½œâ€ ç« ä¸­çš„ç›¸åŒé—®é¢˜ã€‚</li></ul><h1 id="modemanagement"><a class="anchor" href="#modemanagement">#</a> ModeManagement</h1><h2 id="1-scope-of-document"><a class="anchor" href="#1-scope-of-document">#</a> 1 Scope of Document</h2><blockquote><p>The goal of this document is to define the functional and non-functional requirements for all modules of the AUTOSAR mode managementï¼š</p><ul><li>ECU State Manager [2] (EcuM) which manages startup and shutdown of the ECU. This includes triggering the shutdown when all requests for run are released;</li><li>Watchdog Manager [3] (WdgM) which collects the indications of aliveness and correct execution order from the independent applications and relays them to the hardware watchdog in a suitable way;</li><li>Communication Manager [4] (ComM) which coordinates the communication of the independent applications.</li><li>Basic Software Mode Manager (BswM) which organizes mode handling and mode related interaction of SW-Cs and the BSW modules.</li></ul><p>All modules are needed if more than one independent software component resides on the ECU.</p></blockquote><p>æœ¬æ–‡æ¡£çš„ç›®æ ‡æ˜¯å®šä¹‰ AUTOSAR æ¨¡å¼ç®¡ç†çš„æ‰€æœ‰æ¨¡å—çš„åŠŸèƒ½å’ŒéåŠŸèƒ½è¦æ±‚:</p><ul><li>ECU çŠ¶æ€ç®¡ç†å™¨ï¼ˆECUMï¼‰<ul><li>ç®¡ç† ECU çš„ startup å’Œ shutdown ï¼ŒåŒ…æ‹¬åœ¨æ‰€æœ‰çš„è¿è¡Œè¯·æ±‚è¢«é‡Šæ”¾åæ‰§è¡Œ shutdown.</li></ul></li><li>çœ‹é—¨ç‹—ç®¡ç†å™¨ï¼ˆWdgMï¼‰<ul><li>ä»ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­æ”¶é›†å¯é å’Œæ­£ç¡®çš„æ‰§è¡Œå‘½ä»¤çš„æŒ‡ç¤ºï¼Œå¹¶ä»¥é€‚å½“çš„æ–¹å¼å°†å…¶è½¬å‘ç»™ç¡¬ä»¶ç›‘ç£æœºæ„ï¼›</li></ul></li><li>é€šä¿¡ç®¡ç†å™¨ï¼ˆComMï¼‰<ul><li>è´Ÿè´£åè°ƒç‹¬ç«‹åº”ç”¨ç¨‹åºçš„é€šä¿¡ã€‚</li></ul></li><li>åŸºæœ¬è½¯ä»¶æ¨¡å¼ç®¡ç†å™¨ (BSWM)<ul><li>ç”¨äºç»„ç»‡æ¨¡å¼å¤„ç†å’Œ SWC å’Œ BSW æ¨¡å—çš„æ¨¡å¼ç›¸å…³äº¤äº’ã€‚</li></ul></li></ul><h2 id="4-requirements-specification"><a class="anchor" href="#4-requirements-specification">#</a> 4 Requirements Specification</h2><h3 id="41-ecu-state-manager-ecum"><a class="anchor" href="#41-ecu-state-manager-ecum">#</a> 4.1 ECU State Manager (EcuM)</h3><blockquote><p>The ECU State Manager [2] is a basic software module that manages the ECU states and the transitions between these states.</p><p>It manages all wake-up events and configures the ECU for SLEEP when requested.</p></blockquote><p>ECU çŠ¶æ€ç®¡ç†å™¨æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è½¯ä»¶æ¨¡å—ï¼Œç”¨äºç®¡ç† ECU çŠ¶æ€å’Œè¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚</p><p>å®ƒç®¡ç†æ‰€æœ‰å”¤é†’äº‹ä»¶ï¼Œå¹¶æ ¹æ®ç¡çœ çš„è¯·æ±‚é…ç½® ECUã€‚</p><blockquote><p>The ECU State Manager [2] shall support individual preparation-activities and transitions to bring up the ECU or put it into a decreased power mode (low-power mode,e.g. sleep / standby).</p><p>By a well defined usage of ECU State Manager [2] features and capabilities, this module can then be used to perform a pre-defined strategy of power-consumption, thus allowing efficient energy management for the ECU.</p></blockquote><p>ECU çŠ¶æ€ç®¡ç†å™¨ [2] åº”æ”¯æŒå•ä¸ªå‡†å¤‡æ´»åŠ¨å’Œè¿‡æ¸¡æ´»åŠ¨ï¼Œä»¥å¯åŠ¨ ECU æˆ–å°†å…¶æ”¾å…¥é™ä½åŠŸç‡æ¨¡å¼ (ä½åŠŸç‡æ¨¡å¼ï¼Œä¾‹å¦‚ç¡çœ  / å¾…æœº)ã€‚é€šè¿‡æ˜ç¡®å®šä¹‰ä½¿ç”¨ ECU çŠ¶æ€ç®¡ç†å™¨ [2] è¯¥æ¨¡å—å…·æœ‰åŠŸèƒ½å’Œèƒ½åŠ›ï¼Œå¯ç”¨äºæ‰§è¡Œé¢„å…ˆå®šä¹‰çš„åŠŸè€—ç­–ç•¥ï¼Œä»è€Œä¸º ECU å®ç°é«˜æ•ˆçš„èƒ½æºç®¡ç†ã€‚</p><p><strong>Configuration (Common)</strong></p><blockquote><p><strong>[SRS_ModeMgm_09122] Configuration of users of the ECU State Manager</strong></p></blockquote><p>æ‰€æœ‰çš„çŠ¶æ€åˆ‡æ¢éƒ½æ˜¯ç”¨æˆ·é…ç½®çš„ï¼Œæ‰€ä»¥é¢„å…ˆé…ç½®å¥½ï¼Œä¸æ˜¯é¢„æœŸçš„çŠ¶æ€åˆ‡æ¢ä¸äºˆå“åº”</p><blockquote><p><strong>[SRS_ModeMgm_09100] Selection of wake-up sources shall be configurable</strong></p></blockquote><p>å”¤é†’æºå¯é…ç½®çš„</p><blockquote><p>Depending on the ECU, the allowed wake-up source may varyï¼š</p><ul><li>reception of a CAN frame,</li><li>direct input(s),</li><li>either CAN frames or direct inputs,</li><li>ç­‰ç­‰</li></ul></blockquote><p><strong>Normal Operation (Common)</strong></p><blockquote><p><strong>[SRS_ModeMgm_09104] ECU State Manager shall take over control after OS shutdown</strong></p></blockquote><p>OS å…³é—­åç”± ECUM æ¥ç®¡ã€‚å› ä¸º OS å¯åŠ¨ä¹Ÿæ˜¯ç”± ECUM å¯åŠ¨çš„ã€‚</p><blockquote><p><strong>[SRS_ModeMgm_09128] Several shutdown targets shall be supported</strong></p></blockquote><p>æ”¯æŒé…ç½®å‡ ä¸ª shutdown ç›®æ ‡</p><blockquote><p>Power Off</p><p>Reset of ECU</p><p>Sleep Modes</p></blockquote><blockquote><p><strong>[SRS_ModeMgm_09270] The ECU State Manager shall provide a service for the selection of the shutdown target</strong></p></blockquote><p>æœåŠ¡åŒ–å§</p><blockquote><p><strong>[SRS_ModeMgm_09271] The ECU State Manager shall provide a service for the retrieval of the current shutdown target</strong></p></blockquote><p>èƒ½æ£€ç´¢å½“å‰çš„ shutdown ç›®æ ‡ï¼Œå°±å¢åˆ æ”¹æŸ¥å‘—</p><blockquote><p><strong>[SRS_ModeMgm_09119] Several sleep modes shall be available</strong></p><p><strong>[SRS_ModeMgm_09102] API for selecting the sleep mode shall be provided</strong></p><p><strong>[SRS_ModeMgm_09272] The ECU State Manager shall provide a service for the retrieval of the last sleep targets</strong></p></blockquote><p>è·Ÿ sleep çš„å®ç°å’Œ shutdown ä¸€æ ·çš„æ ‡å‡†</p><blockquote><p><strong>[SRS_ModeMgm_09072] ECU shutdown shall be forced</strong></p></blockquote><p>è¦æœ‰ä¸€ä¸ªå¼ºåˆ¶å…³æœºçš„æ¥å£</p><blockquote><p><strong>[SRS_ModeMgm_09017] The ECU State Manager shall provide an API to query the current ECU state</strong></p></blockquote><p>æŸ¥è¯¢ ECU çŠ¶æ€çš„æ¥å£</p><blockquote><p><strong>[SRS_ModeMgm_09136] The ECU State Manager shall be the receiver of all wake up events</strong></p></blockquote><p>ECUM æ˜¯æ‰€æœ‰å”¤é†’äº‹ä»¶çš„æ¥æ”¶è€…ï¼ŒåºŸè¯æ•´ä¸ªèŠ¯ç‰‡çš„çŠ¶æ€éƒ½æ˜¯ ECUM è¯´äº†ç®—</p><blockquote><p><strong>[SRS_ModeMgm_09098] Storing the wake-up reasons shall be available</strong></p></blockquote><p>è¦å­˜å‚¨ä¸‹æ¥å½“å‰çš„å”¤é†’åŸå› ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤–éƒ¨é€šä¿¡è·å–</p><blockquote><p><strong>[SRS_ModeMgm_09097] The ECU State Manager module shall start a timeout after receiving a wake-up indication</strong></p></blockquote><p>è¦æœ‰ä¸€ä¸ªå”¤é†’éªŒè¯çš„æ“ä½œï¼Œå¹¶æœ‰è¶…æ—¶å¤„ç†ã€‚</p><blockquote><p><strong>[SRS_ModeMgm_09126] An API for querying the wake-up reason shall be provided</strong></p></blockquote><p>å¯ä»¥è·å–æœ€è¿‘çš„å”¤é†’åŸå› </p><blockquote><p><strong>[SRS_ModeMgm_09274] The ECU State Manager shall provide a service for the retrieval of the selected reset modality</strong></p><p><strong>[SRS_ModeMgm_09274] The ECU State Manager shall provide a service for the retrieval of the selected reset modality</strong></p><p><strong>[SRS_ModeMgm_09101] An API to query the reset reason shall be provided</strong></p><p><strong>[SRS_ModeMgm_09276] The ECU State Manager shall provide a service allowing the selection of the boot target</strong></p><p><strong>[SRS_ModeMgm_09275] The ECU State Manager shall provide a service for querying the time of previous resets</strong></p></blockquote><p>ä¸€å †æ¥å£è¦æ”¯æŒ</p><blockquote><p><strong>[SRS_ModeMgm_09127] The ECU State Manager shall de-initialize Basic Software modules where appropriate during the shutdown process</strong></p></blockquote><p>ECUM è¦åœ¨ shutdown çš„è¿‡ç¨‹ä¸­ååŠ© bsw å»åˆå§‹åŒ–ã€‚</p><blockquote><p><strong>[SRS_ModeMgm_09116] Requesting and releasing the RUN state shall be provided</strong></p></blockquote><p>è¦æä¾›è¯·æ±‚å’Œé‡Šæ”¾ RUN çŠ¶æ€çš„æ¥å£</p><p><strong>Fixed</strong></p><blockquote><p>Please note that the Specification of ECU State Manager [2] with fixed state machine is not part of this Release anymore.</p><p>The ECU State Manager [2] Fixed is a variant of the EcuM which has a fixed set of states: OFF, RUN, SLEEP and transient states: STARTUP, WAKEUP, SHUTDOWN).</p></blockquote><p>ä¹Ÿæ˜¯ ECUM çš„çŠ¶æ€ï¼Œä¸è¿‡è§„èŒƒäº†å¹¶å›ºå®šäº†å‡ ç§çŠ¶æ€</p><blockquote><p><strong>[SRS_ModeMgm_09120] Configuration of initialization process of Basic Software modules shall be available</strong></p><p><strong>[SRS_ModeMgm_09147] Configuration of de-initialization process of Basic Software modules shall be provided</strong></p><p><strong>[SRS_ModeMgm_09146] Configuration of time triggered increased inoperation shall be provided</strong></p><p><strong>[SRS_ModeMgm_09001] The number and names of main states and the transitions between main states shall be standardized.</strong></p><p><strong>[SRS_ModeMgm_09173] A Run State shall have a minimum duration</strong></p><p><strong>[SRS_ModeMgm_09114] Starting/invoking the shutdown process shall be provided</strong></p><p><strong>[SRS_ModeMgm_09113] Initialization of Basic Software modules shall be done</strong></p><p><strong>[SRS_ModeMgm_09009] The ECU State Manager shall provide the ability to execute external, statically-configured code at each transition between ECU states</strong></p><p><strong>[SRS_ModeMgm_09118] The ECU State Manager shall provide a mechanism to enter a step by step decreasing power mode</strong></p></blockquote><p>æ”¯æŒåˆ†çº§åˆ«ä½åŠŸè€—</p><blockquote><p><strong>[SRS_ModeMgm_09115] The ECU State Manager shall include a mechanism to evaluate the condition to stay in the RUN state</strong></p></blockquote><p>çŠ¶æ€ç®¡ç†è¦å¯ä»¥åˆ¤æ–­å¯ä»¥ä¿æŒåœ¨ RUN çš„æ¡ä»¶</p><blockquote><p><strong>[SRS_ModeMgm_09164] Shutdown synchronization for SW-Components shall be supported</strong></p></blockquote><p>æ”¯æŒ SWC çš„ shutdown åŒæ­¥</p><blockquote><p><strong>[SRS_ModeMgm_09165] The ECU State Manager shall provide services to request and release the POST-RUN state</strong></p><p><strong>[SRS_ModeMgm_09166] The ECU State Manager shall evaluate the condition to stay in the POST-RUN state</strong></p><p><strong>[SRS_ModeMgm_09145] Wake-sleep operation shall be supported</strong></p></blockquote><p><strong>Flex</strong></p><blockquote><p><strong>[SRS_ModeMgm_09234] The EcuM shall handle the initialization of Basic Software modules</strong></p><p><strong>[SRS_ModeMgm_09235] The ECU State Manager shall offer two targets for shutting down the ECU</strong></p><p><strong>[SRS_ModeMgm_09185] A persistent Alarm Clock used by local SW-Cs shall be provided</strong></p><p><strong>[SRS_ModeMgm_09186] Alarm Clock shall be active while the ECU is powered</strong></p><p><strong>[SRS_ModeMgm_09187] In Case of wakeup, all the alarm clock shall be canceled</strong></p><p><strong>[SRS_ModeMgm_09188] In Case of startup, all the alarm clock shall be canceled</strong></p><p><strong>[SRS_ModeMgm_09189] Consecutive requests shall honor the earliest expiring alarm only</strong></p><p><strong>[SRS_ModeMgm_09190] The alarm clock service shall allow setting an alarm relative to the current time using a time resolution of seconds</strong></p><p><strong>[SRS_ModeMgm_09199] The alarm clock service shall allow setting an alarm absolute by using an absolute time with a resolution of seconds</strong></p><p><strong>[SRS_ModeMgm_09194] The alarm clock service shall allow setting the clock</strong></p><p><strong>[SRS_ModeMgm_09277] The ECU State Manager shall provide an alarm clock service which shall allow the retrieval of clock values</strong></p></blockquote><p>è‡ªæˆ‘æ„Ÿè§‰æ²¡é‚£ä¹ˆé‡è¦</p><blockquote><p><strong>[SRS_ModeMgm_09236] There shall be one instance of the function EcuM_Init that distinguishes between the different cores</strong></p></blockquote><p>è¦åŒºåˆ†å¤šæ ¸ï¼Œåªæœ‰ master æ ¸å¯ä»¥å¯åŠ¨å…¶ä»–æ ¸å¿ƒã€‚</p><blockquote><p><strong>[SRS_ModeMgm_09237] RTE_Start shall be called on each core.</strong></p><p>RTE [7]_Start shall be called locally on each core by means of tasks triggered by the BswM on the main core through dedicated available actions.</p></blockquote><p>RTE_Start åº”é€šè¿‡ä¸»æ ¸å¿ƒä¸Šçš„ BswM é€šè¿‡ä¸“ç”¨å¯ç”¨åŠ¨ä½œè§¦å‘çš„ä»»åŠ¡åœ¨æ¯ä¸ªæ ¸å¿ƒä¸Šæœ¬åœ°è°ƒç”¨ï¼Œæ¯ä¸ªæ ¸å¿ƒéƒ½éœ€è¦åˆå§‹åŒ–ï¼Œä¸”éœ€è¦åŒæ­¥ï¼Œé¿å…å…¶ä»–æ ¸æå‰è¿›å…¥ OS è°ƒåº¦</p><blockquote><p><strong>[SRS_ModeMgm_09238] State changes shall be ECU global</strong></p><p>Only the entire ECU changes into either</p><ul><li>"off",</li><li>"fully functional"</li><li>or "sleeping"(halted or set to poll)</li></ul></blockquote><blockquote><p><strong>[SRS_ModeMgm_09239] To shutdown, ShutdownAllCores shall be called on the</strong><br><strong>master core after synchronizing all cores</strong></p></blockquote><p>å…³é—­ä¹Ÿéœ€è¦åŒæ­¥</p><blockquote><p><strong>[SRS_ModeMgm_09254] Validation and handling of a wakeup event shall be done locally</strong></p></blockquote><p>å”¤é†’äº‹ä»¶ä¹Ÿè¦åœ¨æœ¬æ ¸å¿ƒä¸Š</p><h3 id="42-watchdog-manager"><a class="anchor" href="#42-watchdog-manager">#</a> 4.2 Watchdog Manager</h3><p><strong>Functional Overview</strong></p><blockquote><p>The Watchdog Manager [3] is a basic software module of the standardized basic software architecture of AUTOSAR (service layer).</p></blockquote><p>çœ‹é—¨ç‹—ç®¡ç†å™¨æ˜¯ AUTOSAR (æœåŠ¡å±‚) æ ‡å‡†åŒ–åŸºæœ¬è½¯ä»¶æ¶æ„çš„ BSW æ¨¡å—</p><blockquote><p>It is intended to supervise the reliability of application execution with respect to timing constraints (temporal program flow monitoring) and with respect to the correct sequence of execution (logical program flow monitoring).</p></blockquote><p>æ—¨åœ¨ç›‘ç£åº”ç”¨ç¨‹åºæ‰§è¡Œçš„å¯é æ€§ï¼ŒåŒ…æ‹¬æ—¶é—´çº¦æŸ (æ—¶é—´ç¨‹åºæµç¨‹ç›‘æ§) å’Œæ‰§è¡Œçš„æ­£ç¡®é¡ºåº (é€»è¾‘ç¨‹åºæµç¨‹ç›‘æ§)</p><blockquote><p>Derived from the layered architecture approach [9], a decoupling between application timing constraints and watchdog hardware timing constraints becomes possible.</p></blockquote><p>æºè‡ªåˆ†å±‚æ¶æ„æ–¹æ³•ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå®šæ—¶çº¦æŸå’Œçœ‹é—¨ç‹—ç¡¬ä»¶å®šæ—¶çº¦å®šä¹‹é—´çš„è§£è€¦æˆä¸ºå¯èƒ½ã€‚</p><blockquote><p>Based on this decoupling the Watchdog Manager [3] provides temporal program flow monitoring (alive-supervision) of several independent applications as well as logical program flow monitoring (the supervision of the correct execution order) while triggering the watchdog hardware.</p></blockquote><p>åŸºäºè¿™ç§è§£è€¦ï¼ŒWatchdog Manager åœ¨è§¦å‘çœ‹é—¨ç‹—ç¡¬ä»¶æ—¶ï¼Œæä¾›å¯¹å‡ ä¸ªç‹¬ç«‹åº”ç”¨ç¨‹åºçš„æ—¶é—´ç¨‹åºæµç›‘æ§ (alive-supervision) ä»¥åŠé€»è¾‘ç¨‹åºæµç›‘æ§ (å¯¹æ­£ç¡®æ‰§è¡Œé¡ºåºçš„ç›‘ç£)ã€‚</p><blockquote><p>The following features are provided by the Watchdog Manager</p><ul><li>Supervision of multiple individual applications located on the ECU, having in dependent timing constraints and requiring a special supervision of runtime be haviour and aliveness.</li><li>Logical supervision of safety-related tasks and periodic functions (main functions).</li><li>Fault-reaction mechanism for each independent supervised entity.</li><li>Possibility to switch off supervision of individual applications, without violating the watchdog triggering (e.g. for inhibited applications).</li><li>Triggering of internal or external, standard or window, watchdog, via a watchdog driver. The access to the internal or external watchdog will be handled by the Watchdog Interface.</li><li>Selection of the watchdog mode (Off Mode, Slow Mode, Fast Mode) depending on the ECU state and the hardware capabilities.</li></ul></blockquote><p>çœ‹é—¨ç‹—çš„ç‰¹æ€§</p><p><strong>Functional Requirements</strong></p><blockquote><p><strong>[SRS_ModeMgm_09107] The Watchdog Manager shall provide an initialization service</strong></p><p><strong>[SRS_ModeMgm_09109] It shall be possible to prohibit the disabling of watchdog</strong></p></blockquote><p>åº”è¯¥å¯ä»¥ç¦æ­¢å¤±èƒ½çœ‹é—¨ç‹—</p><blockquote><p><strong>[SRS_ModeMgm_09112] The Watchdog Manager shall cyclically check the periodicity of the supervised entities</strong></p><p><strong>[SRS_ModeMgm_09221] The Watchdog Manager shall check the correct sequence of code execution in supervised entities</strong></p></blockquote><p>çœ‹é—¨ç‹—ç®¡ç†å™¨ä¸ä»…æ£€æŸ¥ä»£ç çš„æ‰§è¡Œæ—¶é—´è¿˜æ£€æŸ¥æ‰§è¡Œæ—¶åº</p><blockquote><p><strong>[SRS_ModeMgm_09125] The Watchdog Manager shall provide a service allowing the Update temporal program flow monitoring</strong></p><p><strong>[SRS_ModeMgm_09222] The Watchdog Manager shall provide a service allowing the Update logical program flow monitoring</strong></p></blockquote><p>è¦åœ¨æ£€æŸ¥ç‚¹é‚£é‡Œåš trace</p><blockquote><p><strong>[SRS_ModeMgm_09160] The Watchdog Manager shall provide the indication of failed temporal monitoring</strong></p></blockquote><p>è¦æœ‰å¤±è´¥çš„æŒ‡ç¤ºï¼Œæé†’ SWC æˆ–å…¶ä»–æ¨¡å—</p><blockquote><p><strong>[SRS_ModeMgm_09161] The Watchdog Manager shall reset the triggering condition in the Watchdog Driver in Case of temporal failure</strong></p></blockquote><p>æ²¡çœ‹æ‡‚å•¥æ„æ€</p><blockquote><p><strong>[SRS_ModeMgm_09226] The Watchdog Manager shall reset reset the triggering condition in the Watchdog Driver in Case of logical program flow violation</strong></p></blockquote><p>ç¨‹åºæµé”™è¯¯æ—¶çœ‹é—¨ç‹—è§¦å‘</p><blockquote><p><strong>[SRS_ModeMgm_09169] The Watchdog Manager shall be able to immediately reset the MCU</strong></p><p><strong>[SRS_ModeMgm_09162] The Watchdog Manager shall be able to notify the software of an upcoming watchdog reset</strong></p></blockquote><p>å°±æ˜¯çœ‹é—¨ç‹—è§¦å‘æ—¶å¯ä»¥é€šçŸ¥åˆ°å…¶ä»–è½¯ä»¶</p><blockquote><p><strong>[SRS_ModeMgm_09163] It shall be possible to configure a delay before provoking a watchdog reset</strong></p></blockquote><p>å¯ä»¥é…ç½®çœ‹é—¨ç‹—è§¦å‘å<strong>å»¶æ—¶å¤šä¹…åé‡å¯</strong></p><blockquote><p><strong>[SRS_ModeMgm_09143] The Watchdog Manager shall set the triggering condition during inactive monitoring</strong></p><p><strong>[SRS_ModeMgm_09231] The Watchdog Manager shall periodically set the triggering condition in the Watchdog Driver as long as the monitoring has not failed</strong></p></blockquote><p>è¦è®¾ç½®è§¦å‘æ¡ä»¶ï¼ŒåŒæ—¶ä¹Ÿè¦å®šæœŸå»è®¾ç½®çœ‹é—¨ç‹—çš„è§¦å‘æ¡ä»¶</p><blockquote><p><strong>[SRS_ModeMgm_09110] The watchdog Manager shall provide a service interface, to select a mode of the Watchdog Manager</strong></p></blockquote><p>æœ‰å‡ ä¸ªæ¨¡å¼</p><ul><li>off</li><li>slow</li><li>fast</li></ul><blockquote><p><strong>[SRS_ModeMgm_09028] The Watchdog Manager shall support multiple watchdog instances</strong>****</p></blockquote><p>æ”¯æŒå¤šä¸ªçœ‹é—¨ç‹—å®ç°ï¼Œæ„Ÿè§‰è¿™ä¸ªæ€æƒ³çœŸçš„åŠ</p><blockquote><p><strong>[SRS_ModeMgm_09233] The Watchdog Manager shall support independent triggering condition values for each watchdog instance</strong></p></blockquote><p>æ¯ä¸ªçœ‹é—¨ç‹—éƒ½æœ‰è‡ªå·±çš„é…ç½®å’Œè§¦å‘æ¡ä»¶</p><blockquote><p><strong>[SRS_ModeMgm_09232] The Watchdog Manager shall provide a service to cause a watchdog reset</strong></p><p><strong>[SRS_ModeMgm_09106] The list of entities supervised by the Watchdog Manager shall be configurable at pre-compile time</strong></p><p><strong>[SRS_ModeMgm_09220] It shall be possible to configure all the transition relations</strong></p><p><strong>[SRS_ModeMgm_09158] The Watchdog Manager shall support Post build time and mode dependent selectable configuration sets for the Watchdog Manager</strong></p><p><strong>[SRS_ModeMgm_09223] The Watchdog Manager shall support Post build time and mode dependent selectable configuration of transition relations</strong></p></blockquote><p>æ€»ä¹‹å°±æ˜¯é…é…é…</p><p><strong>Fault Operation</strong></p><blockquote><p><strong>[SRS_ModeMgm_09159] The Watchdog Manager shall report failure of temporal or program flow monitoring to DEM</strong></p></blockquote><p>æœ‰æŠ¥é”™æœºåˆ¶</p><h3 id="43-communication-manager"><a class="anchor" href="#43-communication-manager">#</a> 4.3 Communication Manager</h3><p><strong>Functional Overview</strong></p><blockquote><p>The Communication Manager [4] collects and coordinates the communication access requests from communication requestors (users, see glossary).</p></blockquote><p>é€šè®¯ç®¡ç†æ”¶é›†å’Œåè°ƒæ¥è‡ªé€šä¿¡è¯·æ±‚è€… (ç”¨æˆ·ï¼Œè¯·å‚è§æœ¯è¯­è¡¨) çš„é€šä¿¡è®¿é—®è¯·æ±‚ã€‚</p><blockquote><p>The purpose of the Communication Manager [4] is:</p><ul><li>Simplifying the usage of the communication protocol stack for the user. This includes the starting and stopping physical channel communication and a simplified network management handling.</li><li>Temporarily disabling sending of messages to prevent the ECU from (actively) waking up the physical channel(s).</li><li>Controlling of more than one physical channels of an ECU by implementing a state machine for every physical channel.</li><li>Requesting the appropriate communication state to the BusState Manager</li><li>Simplifying the resource management by allocating all resources necessary for the requested communication mode.</li></ul></blockquote><p>ComM æœ‰è¿™ä¹ˆå‡ ä¸ªç›®çš„</p><ul><li>ç®€åŒ–äº†ç”¨æˆ·å¯¹é€šä¿¡åè®®æ ˆçš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬ç‰©ç†ä¿¡é“é€šä¿¡çš„å¯åŠ¨å’Œåœæ­¢ä»¥åŠç®€åŒ–çš„ç½‘ç»œç®¡ç†å¤„ç†</li><li>æš‚æ—¶ç¦ç”¨å‘é€æ¶ˆæ¯ï¼Œä»¥é˜²æ­¢ ECU (ä¸»åŠ¨) å”¤é†’ç‰©ç†ä¿¡é“ã€‚</li><li>é€šè¿‡ä¸ºæ¯ä¸ªç‰©ç†é€šé“å®ç°çŠ¶æ€æœºæ¥æ§åˆ¶ ECU çš„å¤šä¸ªç‰©ç†é€šé“ã€‚</li><li>å‘ BusState Manager è¯·æ±‚é€‚å½“çš„é€šä¿¡çŠ¶æ€</li><li>é€šè¿‡åˆ†é…æ‰€è¯·æ±‚çš„é€šä¿¡æ¨¡å¼æ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œç®€åŒ–äº†èµ„æºç®¡ç†ã€‚</li></ul><blockquote><p>In order to do so, the Communication Manager [4] defines "communication modes",<br>indicating if a given physical channel is available for the application and how (send/<br>receive; only receive, neither send nor receive).</p></blockquote><p>ä¸ºæ­¤ï¼Œé€šä¿¡ç®¡ç†å™¨ [4] å®šä¹‰ â€œé€šä¿¡æ¨¡å¼â€ï¼ŒæŒ‡ç¤ºç»™å®šçš„ç‰©ç†ä¿¡é“æ˜¯å¦å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ (å‘é€ / æ¥æ”¶ï¼›ä»…æ¥æ”¶ï¼Œæ—¢ä¸å‘é€ä¹Ÿä¸æ¥æ”¶)ã€‚</p><p><strong>Functional Requirements</strong></p><blockquote><p><strong>[SRS_ModeMgm_09078] The Communication Manager shall coordinate multiple communication requests</strong></p><p><strong>[SRS_ModeMgm_09246] The communication manager shall arbitrate and coordinate requests from users on physical channel and users on PNCs</strong></p><p><strong>[SRS_ModeMgm_09247] For each configured PNC an independent state machine shall be instantiated</strong></p></blockquote><p>ComM æ¥åè°ƒé€šä¿¡è¯·æ±‚ï¼Œä¹Ÿæ¥ç®¡ç† PNCï¼Œè€Œä¸”æ¯ä¸ª PNC éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€æœº</p><blockquote><p><strong>[SRS_ModeMgm_09248] it shall be possible to distinguish between internal and external PNC activation requests</strong></p></blockquote><p>è¦åŒºåˆ† PNC çš„å†…éƒ¨æˆ–å¤–éƒ¨æ¿€æ´»è¯·æ±‚</p><blockquote><p><strong>[SRS_ModeMgm_00049] The Communication Manager shall initiate the wake-up and keep awake physical channels</strong></p></blockquote><p>ComM å‘èµ·å”¤é†’å¹¶ä¿æŒç‰©ç†é€šé“å”¤é†’</p><blockquote><p><strong>[SRS_ModeMgm_09080] Each physical channel shall be controlled by an independent communication mode</strong></p></blockquote><p>æ¯ä¸ªç‰©ç†ä¿¡é“åº”ç”±ç‹¬ç«‹çš„é€šä¿¡æ¨¡å¼æ§åˆ¶</p><blockquote><p><strong>[SRS_ModeMgm_09081] The Communication Manager shall provide an API allowing collecting communication requests</strong></p></blockquote><p>ComM åº”æä¾›å…è®¸æ”¶é›†é€šä¿¡è¯·æ±‚çš„ API</p><blockquote><p><strong>[SRS_ModeMgm_09083] The Communication Manager shall support two communication modes for each physical channel</strong></p></blockquote><p>ComM åº”æ”¯æŒæ¯ä¸ªç‰©ç†ä¿¡é“çš„ä¸¤ç§é€šä¿¡æ¨¡å¼</p><blockquote><p><strong>[SRS_ModeMgm_09084] The Communication Manager shall provide an API which allows application to query the current communication mode</strong></p></blockquote><p>ComM åº”æä¾›ä¸€ä¸ªå…è®¸åº”ç”¨ç¨‹åºæŸ¥è¯¢å½“å‰é€šä¿¡æ¨¡å¼çš„ API</p><blockquote><p><strong>[SRS_ModeMgm_09172] It shall be possible to evaluate the current communication mode</strong></p></blockquote><p>åº”æœ‰å¯èƒ½è¯„ä¼°å½“å‰çš„é€šä¿¡æ¨¡å¼</p><blockquote><p><strong>[SRS_ModeMgm_09149] The Communication Manager shall provide an API for querying the requested communication mode</strong></p></blockquote><p>ComM åº”æä¾›ä¸€ä¸ª APIï¼Œç”¨äºæŸ¥è¯¢è¯·æ±‚çš„é€šä¿¡æ¨¡å¼</p><blockquote><p><strong>[SRS_ModeMgm_09085] The Communication Manager shall provide an indication of communication mode changes</strong></p></blockquote><p>æ¨¡å¼æ”¹å˜çš„æ—¶å€™è¦æœ‰æŒ‡ç¤º</p><blockquote><p><strong>[SRS_ModeMgm_09168] The Communication Manager shall support users that are connected to no physical channel</strong></p></blockquote><p>æŠ½è±¡å‘—ï¼Œä¸Šä¸‹å±‚çº§è§£è€¦</p><blockquote><p><strong>[SRS_ModeMgm_09071] It shall be possible to limit communication modes independently for each physical channel</strong></p></blockquote><p>åº”å¯ä¸ºæ¯ä¸ªç‰©ç†ä¿¡é“ç‹¬ç«‹é™åˆ¶é€šä¿¡æ¨¡å¼</p><blockquote><p><strong>[SRS_ModeMgm_09157] It shall be possible to revoke a communication mode limitation, independently for each physical channel</strong></p></blockquote><p>åº”è¯¥å¯ä»¥å¯¹æ¯ä¸ªç‰©ç†ä¿¡é“ç‹¬ç«‹åœ°æ’¤é”€é€šä¿¡æ¨¡å¼é™åˆ¶</p><blockquote><p><strong>[SRS_ModeMgm_09087] The Minimum duration of communication request after wakeup shall be configurable</strong></p></blockquote><p>å”¤é†’åçš„æœ€å°ç»´æŒæ—¶é—´å¯é…ç½®</p><blockquote><p><strong>[SRS_ModeMgm_09089] The Communication Manager shall be able to prevent waking up physical channels</strong></p></blockquote><p>åº”è¯¥å¯ä»¥é…ç½®ç¦æ­¢å”¤é†’ç‰©ç†é€šé“</p><blockquote><p><strong>[SRS_ModeMgm_09155] The Communication Manager shall provide a counter for inhibited communication requests</strong></p><p><strong>[SRS_ModeMgm_09156] It shall be provided an API to retrieve the number of inhibited "Full Communication" mode requests</strong></p></blockquote><p>ç»™å„ç§è¯·æ±‚è®¡æ•°</p><blockquote><p><strong draft="">[SRS_ModeMgm_09249]</strong> <strong>PNC gateway and coordination functionality</strong></p></blockquote><p><strong>Description:</strong></p><blockquote><p>Communication Manager shall be aware of the distribution of each PNC over different ComM channels (where each channel represents a particular connection to a bus (e.g. CAN, FlexRay) or network (e.g. switched Ethernet network)) and shall take care to forward the activation requests from one channel to the other.</p></blockquote><p>ComM åº”äº†è§£æ¯ä¸ª PNC åœ¨ä¸åŒ ComM é€šé“ä¸Šçš„åˆ†å¸ƒ (æ¯ä¸ªé€šé“è¡¨ç¤ºå¯¹æ€»çº¿ä¾‹å¦‚ CANã€FlexRay) æˆ–ç½‘ç»œ (ä¾‹å¦‚äº¤æ¢å¼ä»¥å¤ªç½‘ç½‘ç»œ) çš„ç‰¹å®šè¿æ¥)ï¼Œå¹¶åº”å°å¿ƒåœ°å°†æ¿€æ´»è¯·æ±‚ä»ä¸€ä¸ªé€šé“è½¬å‘åˆ°å¦ä¸€ä¸ªé€šé“ã€‚</p><blockquote><p>The Communication Manager of a PNC gateway can either act per PNC as top-level PNC coordinator or as intermediate PNC coordinator.</p></blockquote><p>PNC ç½‘å…³çš„ ComM å¯ä»¥ä½œä¸ºæ¯ä¸ª PNC çš„é¡¶çº§ PNC åè°ƒå™¨æˆ–ä¸­é—´ PNC åè°ƒäººã€‚</p><blockquote><p>The top-level PNC coordinator is responsible for the coordinated shutdown of all PNC members, because it is the only node which has the full overview of the states of all PNCs.</p></blockquote><p>æœ€é¡¶çº§ PNC åè°ƒå™¨è´Ÿè´£åè°ƒå…³é—­æ‰€æœ‰ PNC æˆå‘˜ï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€å…¨é¢äº†è§£æ‰€æœ‰ PNC çŠ¶æ€çš„èŠ‚ç‚¹ã€‚</p><blockquote><p>If the top-level PNC coordinator detects, that a PNC request has been released, then a NM message is transmitted where this PNC is indicated as released.</p></blockquote><p>å¦‚æœé¡¶çº§ PNC åè°ƒå™¨æ£€æµ‹åˆ°å·²é‡Šæ”¾äº† PNC è¯·æ±‚ï¼Œåˆ™å‘é€ä¸€ä¸ª NM æ¶ˆæ¯ï¼Œå…¶ä¸­è¯¥ PNC è¢«æŒ‡ç¤ºä¸ºå·²é‡Šæ”¾ã€‚</p><blockquote><p>The NM message is forwarded as usual NM message by the intermediate PNC coordinate to the PNC leaf nodes. If the optional feature "synchronized PNC shutdown" is enabled the top-level PNC coordinator transmits a NM message as PN shutdown message.</p></blockquote><p>NM æ¶ˆæ¯ç”±ä¸­é—´ PNC åè°ƒå™¨ä½œä¸ºå¸¸è§„ NM æ¶ˆæ¯è½¬å‘åˆ° PNC å¶èŠ‚ç‚¹ã€‚å¦‚æœå¯ç”¨äº†å¯é€‰åŠŸèƒ½ â€œåŒæ­¥ PNC å…³æœºâ€ï¼Œåˆ™é¡¶çº§ PNC åè°ƒå™¨å°† NM æ¶ˆæ¯ä½œä¸º PN å…³æœºæ¶ˆæ¯å‘é€ã€‚</p><blockquote><p>The intermediate PNC coordinator is responsible to forward a PN shutdown message (request for a synchronized PNC shutdown) per channel has fast as possible.</p></blockquote><p>ä¸­é—´ PNC åè°ƒå™¨è´Ÿè´£å°½å¯èƒ½å¿«åœ°åœ¨æ¯ä¸ªä¿¡é“ä¸Šè½¬å‘ PN å…³é—­æ¶ˆæ¯ (è¯·æ±‚åŒæ­¥ PNC å…³é—­)</p><p><strong>Rationale:</strong></p><blockquote><p>A PNC can span over different buses which are not necessarily connected to each involved ECU.</p></blockquote><p>PNC å¯ä»¥è·¨è¶Šä¸åŒçš„æ€»çº¿ï¼Œè€Œè¿™äº›æ€»çº¿ä¸ä¸€å®šä¸æ¯ä¸ªç›¸å…³ ECU ç›¸è¿ã€‚</p><blockquote><p>AUTOSAR supports Partial Network topologies, where different PNCs are coordinated by different ECUs in the role of a top-level PNC coordinator.</p></blockquote><p>AUTOSAR æ”¯æŒéƒ¨åˆ†ç½‘ç»œæ‹“æ‰‘ï¼Œå…¶ä¸­ä¸åŒçš„ PNCs ç”±ä¸åŒçš„ ECU åè°ƒï¼Œæ‰®æ¼”æœ€é«˜çº§åˆ« PNC åè°ƒå™¨çš„è§’è‰²ã€‚</p><blockquote><p>Please note, a PNC can have only one top-level coordinator across a Partial Network.</p><p>This has to be ensured by a proper Partial Network communication design.</p></blockquote><p>è¯·æ³¨æ„ï¼Œä¸€ä¸ª PNC åœ¨éƒ¨åˆ†ç½‘ç»œä¸­åªèƒ½æœ‰ä¸€ä¸ªé¡¶çº§åè°ƒå™¨ï¼Œå¿…é¡»é€šè¿‡é€‚å½“çš„å±€éƒ¨ç½‘ç»œé€šä¿¡è®¾è®¡æ¥ç¡®ä¿è¿™ä¸€ç‚¹ã€‚</p><p><strong>Use Case:</strong></p><blockquote><p>ECU A is connected to network 1 and 2,</p><p>ECU B is connected to network 2 and 3,</p><p>ECU C is connected to network 3;</p><p>as PNC 1 involves SWCs on all these ECUs, the communication manager on each ECU must know where and how to forward the activation requests.</p><p>ECU A is acting as top-level PNC coordinator for PNC1. If all ECUs have released PNC1 and optional feature "synchronized PNC shutdown" is enabled, then ECU A transmit a PN shutdown message on network 1 and 2 to start a synchronized PNC shutdown of PNC1.</p><p>ECU B is acting as intermediate PNC coordinator and forwards the request for a synchronized PNC shutdown of PNC1 to network 3</p></blockquote><p>ä¸€ä¸ªå°ä¾‹å­</p><blockquote><p><strong>[SRS_ModeMgm_09250] PNC activation requests shall be exchanged with the Network Management via a PNC bit vector</strong></p></blockquote><p>PNC æ¿€æ´»è¯·æ±‚åº”é€šè¿‡ PNC ä½çŸ¢é‡ä¸ç½‘ç»œç®¡ç†å™¨äº¤æ¢</p><blockquote><p>Communication Manager shall provide callback functions get external PNC activation requests as PNC bit vector</p><p>and call functions of the Network Management in order to forward PNC activation requests as PNC bit vector according to the specified bit codes.</p><p>The content of the PNC bit vector is provided/required by the Network Management.</p></blockquote><p>ComM å’Œ PNC å’Œ NM ä¹‹é—´çš„äº¤äº’ï¼ŒComM åº”æä¾›å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿å°†å¤–éƒ¨ PNC æ¿€æ´»è¯·æ±‚ä½œä¸º PNC ä½çŸ¢é‡æ¥æ”¶ï¼Œç„¶åè½¬å‘ï¼ŒPNC ä½å‘é‡çš„å†…å®¹ç”± NM æä¾› / è¦æ±‚ã€‚</p><blockquote><p><strong draft="">[SRS_ModeMgm_09278]</strong> <strong>The Communication Manager shall support synchronous and asynchronous request upon a indicated wakeup</strong></p><p><strong draft="">[SRS_ModeMgm_09279]</strong> <strong>The Communication Manager shall support a coordinated release of PNCs</strong></p></blockquote><p>ä¸€äº›æ”¯æŒé¡¹</p><blockquote><p><strong>[SRS_ModeMgm_09251] PNC communication state shall be forwarded to the BswM</strong></p></blockquote><p>å› ä¸ºè¦æ¶‰åŠå…¶ä»–æ¨¡å—æ‰€ä»¥è¦æŠŠ PNC çš„çŠ¶æ€å‘Šè¯‰ BswM</p><blockquote><p><strong draft="">[SRS_ModeMgm_09256]</strong> <strong>PNC Gateway Functionality shall consider systems with more than one gateways connected to the same network</strong></p><p>If there are multiple PNC Gateways within the system, then mirroring of cluster-requests need to be limited to avoid keeping awake each other (forwarding of cluster-requests is unaffected). For this, the following distinction shall be possible:</p><ul><li>Channel Connector of PNC Gateway is of type "active", then PNC requests are forwarded and mirrored on the channel</li><li>Channel Connector of PNC Gateway is of type "passive", then PNC requests are only forwarded, but not mirrored on the channel</li><li>Channel Connector of PNC Gateway is of type "none", then PNC requests are not forwarded and not mirrored back on the channel</li></ul><p>Constraint: If there are multiple PNC Gateways within the system, there shall always be one Gateway on top of the PNC Gateways hierarchical topology.</p></blockquote><p>ä¹Ÿè¦è€ƒè™‘å¤šä¸ª gateways è¿æ¥åˆ°åŒä¸€ä¸ªç½‘ç»œä¸‹çš„æƒ…å†µåˆ†ä¸‰ç§ç±»å‹</p><blockquote><p><strong draft="">[SRS_ModeMgm_09257]</strong> <strong>ComM shall forward PNC-Clusters also to busses that are currently not awake</strong></p><p><strong draft="">[SRS_ModeMgm_09258]</strong> <strong>Optional Dynamic Extension of PNC Gateway</strong></p><p>The PNC Gateway shall be extended to support a dynamic PNC Learning mechanism</p></blockquote><p>ç‰›å•Šï¼Œè¿˜æ”¯æŒåŠ¨æ€å­¦ä¹ </p><blockquote><p><strong draft="">[SRS_ModeMgm_09259]</strong> <strong>ComM API shall provide interfaces to access PNC Mapping (optional)</strong></p><p>The API of the ComM shall provide interfaces for the configurable PNC Mapping stored in NVRAM:</p><ul><li>to read out the current entries (includes "statically" entries) *</li><li>to update / add entries (optional) *</li><li>to reset all entries ("statically" entries will be unaffected)</li></ul><p>* for testing reasons only</p></blockquote><p>è¦æœ‰è¿™ä¸ªæ¥å£</p><blockquote><p><strong draft="">[SRS_ModeMgm_09260]</strong> <strong>ComM API shall provide an interface to start PNC Learning mechanism for PNC Mapping (optional)</strong></p><p><strong draft="">[SRS_ModeMgm_09261]</strong> <strong>ComM shall forward the information for Partial Networking Learning (optional)</strong></p><p><strong draft="">[SRS_ModeMgm_09262]</strong> <strong>ComM shall set all its assigned PNCs when partial networking learning is requested (optional)</strong></p></blockquote><p>å„ç§å­¦ä¹ </p><blockquote><p><strong draft="">[SRS_ModeMgm_09263]</strong> <strong>ComM API shall provide an interface to set PNC-membership on Host-ECU (optional)</strong></p><p><strong draft="">[SRS_ModeMgm_09264]</strong> <strong>ComM API shall provide an interface to configure PN filter mask (optional)</strong></p></blockquote><p>æä¾›æ¥å£</p><blockquote><p><strong draft="">[SRS_ModeMgm_09265]</strong> <strong>ComM shall send the information for Partial Networking Learning (optional)</strong></p></blockquote><p>ComM åº”ä¸ºéƒ¨åˆ†è”ç½‘å­¦ä¹ å‘é€ä¿¡æ¯</p><blockquote><p><strong>[SRS_ModeMgm_09266] ComM shall support communication channels that act as communication slaves with wake-up capability</strong></p></blockquote><p>ComM åº”æ”¯æŒä½œä¸ºå…·æœ‰å”¤é†’èƒ½åŠ›çš„é€šä¿¡ä»æœºçš„é€šä¿¡ä¿¡é“</p><blockquote><p><strong draft="">[SRS_ModeMgm_09267]</strong> <strong>ComM shall support communication channels which act as communication slaves without wake-up capability</strong></p><p><strong>[SRS_ModeMgm_09268] ComM shall support the possibility to forward the information if the communication request is active or passive to itâ€™s lower layer layer</strong></p><p><strong draft="">[SRS_ModeMgm_09269]</strong> <strong>The Communication Manager shall support synchronized PNC shutdown</strong></p></blockquote><p>å°±æ”¯æŒè¿™äº›ç©æ„</p><blockquote><p><strong>[SRS_ModeMgm_09090] Relationship between users and physical channels shall be configurable at pre compile time</strong></p><p><strong>[SRS_ModeMgm_09133] It shall be possible to assign physical channels to the Communication Manager</strong></p><p><strong>[SRS_ModeMgm_09132] It shall be possible to assign Network Management to physical channels</strong></p><p><strong>[SRS_ModeMgm_09141] The Communication Manager shall be able to configure the physical channel wake-up prevention</strong></p><p><strong>[SRS_ModeMgm_09243] The Communication Manager shall be able to handle the Partial Networks on Flexray, CAN and Ethernet</strong></p><p><strong>[SRS_ModeMgm_09244] The number of supported PNCs shall be configurable strictly at pre-compile time</strong></p><p><strong>[SRS_ModeMgm_09245] Enabling or disabling the Partial Network Cluster management in ComM shall be post-build selectable.</strong></p><p><strong>[SRS_ModeMgm_09207] ComM shall allow for additional bus specific state managers</strong></p></blockquote><p>éƒ½æ˜¯è¦æ”¯æŒé…ç½®çš„</p><h3 id="44-basic-software-mode-manager"><a class="anchor" href="#44-basic-software-mode-manager">#</a> 4.4 Basic Software Mode Manager</h3><p><strong>Functional Overview</strong></p><blockquote><p>The VFB defines and the RTE implements the concept of Mode Declaration Groups.</p></blockquote><p>VFB å®šä¹‰æ¨¡å¼å£°æ˜ç»„ï¼ŒRTE å®ç°æ¨¡å¼å£°æ˜ç»„çš„æ¦‚å¿µã€‚</p><blockquote><p>There can be multiple Mode Declaration Groups that are independent of each other.E.g. in Figure 1 the Mode Declaration Group is "AMM_KeySwitch" and the Modes in this group are "Off", "Accessory", "Ignition".</p></blockquote><p>å¯ä»¥æœ‰å¤šä¸ªå½¼æ­¤ç‹¬ç«‹çš„æ¨¡å¼å£°æ˜ç»„ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾ 1 ä¸­ï¼Œå¼å£°æ˜ç»„ä¸º â€œAMM_KeySwitchâ€ï¼Œè¯¥ç»„ä¸­çš„æ¨¡å¼ä¸º â€œOffâ€â€œAccessoryâ€ å’Œ â€œIgnitionâ€ã€‚</p><blockquote><p>A Mode Declaration Group can not contain parallel Modes. Parallel Modes must be implemented by separate Mode Declaration Groups. E.g. diagnostic modes are independent of key switch modes, i.e., they go into a validMode Declaration Group "AMM_Diagnostics".</p></blockquote><p>æ¨¡å¼å£°æ˜ç»„ä¸èƒ½åŒ…å«å¹¶è¡Œæ¨¡å¼ã€‚å¹¶è¡Œæ¨¡å¼å¿…é¡»ç”±å•ç‹¬çš„æ¨¡å¼å£°æ˜ç»„å®ç°ã€‚ä¾‹å¦‚ï¼Œè¯Šæ–­æ¨¡å¼ä¸é”®å¼€å…³æ¨¡å¼æ— å…³ï¼Œå³å®ƒä»¬è¿›å…¥æœ‰æ•ˆçš„æ¨¡å¼å£°æ˜ç»„ â€œAMM_Diagnosticsâ€</p><blockquote><p>There is no hierarchy of Modes within a Mode Group. E.g. "Diagnostics_On" and "Diagnostics_Off" cannot have sub-modes.</p></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240820134255891.png" alt="image-20240820134255891"></p><p><strong>Interfaces between Mode -Requester, -Manager and -User</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240820134342051.png" alt="image-20240820134342051"></p><p><strong>Relation of Modes</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240820134756896.png" alt="image-20240820134756896"></p><p>è¿™äº›å±‚çº§çš„æ¨¡å¼éƒ½æ˜¯å½¼æ­¤å½±å“çš„</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240820134942160.png" alt="image-20240820134942160"></p><p><strong>Functional Requirements</strong></p><blockquote><p><strong>[SRS_ModeMgm_09174] The BSW Mode Manager shall support the â€™disable normal Communicationâ€™</strong></p></blockquote><p>æ”¯æŒç¦ç”¨æ­£å¸¸é€šä¿¡</p><blockquote><p>It shall be possible to disable normal communication and at the same time keep a predefined set of PDU groups active including diagnostic communication.</p></blockquote><p>å¯ä»¥ç¦ç”¨æ­£å¸¸é€šä¿¡ï¼ŒåŒæ—¶ä¿æŒä¸€ç»„é¢„å®šä¹‰çš„ PDU ç»„å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ŒåŒ…æ‹¬è¯Šæ–­é€šä¿¡ã€‚</p><blockquote><p><strong>[SRS_ModeMgm_09179] The BSW Mode Manager shall provide an Interface to allow Mode Requests of SW-Câ€™s</strong></p><p><strong>[SRS_ModeMgm_09228] The BSW Mode Manager shall provide an Interface to allow Mode Requests of BSW Modules</strong></p></blockquote><p>ç»™ä¸Šä¸‹æä¾›æ¥å£</p><blockquote><p><strong>[SRS_ModeMgm_09180] The BSW Mode Manager shall evaluate the current mode requests</strong></p><p><strong>[SRS_ModeMgm_09182] The BSW Mode Manager shall propagate a performed mode change to all local SW-Cs</strong></p><p><strong>[SRS_ModeMgm_09184] The mode manager shall be able to use a COM interface to activate, respectively deactivate, I-PDU groups</strong></p><p><strong>[SRS_ModeMgm_09229] The mode manager shall be able to make generic, configured callouts of void functions to other BSW modules</strong></p><p><strong>[SRS_ModeMgm_09230] All actions shall only be performed on mode change</strong></p></blockquote><p>æ‰€æœ‰çš„åŠ¨ä½œéƒ½åªæœ‰åœ¨æ¨¡å¼æ”¹å˜æ—¶æ‰§è¡Œï¼Œå§æ§½æœ‰æ‰€æ„Ÿæ‚Ÿã€‚</p><p>å†™ä»£ç å°±é¦–å…ˆå†™ä¸€ä¸ªæ¨¡å¼ç®¡ç†çš„ï¼Œä¹‹åè®¾å®šå‡ºç”¨åˆ°çš„å‡ ä¸ªæ¨¡å¼ï¼Œç„¶åè®¾è®¡å„ä¸ªæ¨¡å¼ä¹‹é—´åˆ‡æ¢çš„åŠ¨ä½œ</p><p>åˆå§‹åŒ–ä¹Ÿæ˜¯çŠ¶æ€ï¼Œå§æ§½æ‚Ÿäº†</p><blockquote><p><strong>[SRS_ModeMgm_09240] ComM shall notify BswM of any PNC communication state change</strong></p></blockquote><p>å‰é¢å¥½åƒè¯´è¿‡è¿™ä¸ªå§</p><blockquote><p><strong>[SRS_ModeMgm_09241] BswM shall be able to request communication modes for existing CommUsers</strong></p><p><strong>[SRS_ModeMgm_09253] The BswM shall be able to set the halt mode for each single CPU Core independently</strong></p></blockquote><p>ä¸€äº›æ¨¡å¼å§æˆ‘è§‰å¾—</p><blockquote><p><strong>[SRS_ModeMgm_09177] The rules of the mode arbitration shall be pre-compile and post-build configurable</strong></p><p><strong>[SRS_ModeMgm_09178] The lists of mode transition specific actions shall be pre-compile and post-build configurable</strong></p><p><strong>[SRS_ModeMgm_09175] A configurable Set of Mode dependent enabled and concomitant disabled IPDU groups shall be supported</strong></p><p><strong>[SRS_ModeMgm_09176] Configurable Sets of Mode dependent enabled I-PDU Groups shall be supported</strong></p><p><strong>[SRS_ModeMgm_09183] Configurable Mode Activation initiated Reset of Signals to Initial Values shall be supported</strong></p></blockquote><p>è¿™äº›é…ç½®è¦æ”¯æŒ</p><h1 id="ecustatemanager"><a class="anchor" href="#ecustatemanager">#</a> ECUStateManager</h1><h2 id="1-introduction-and-functional-overview"><a class="anchor" href="#1-introduction-and-functional-overview">#</a> 1 Introduction and Functional Overview</h2><blockquote><p>The ECU Manager module (as specified in this document) is a basic software module (see [1]) that manages common aspects of ECU states. Specifically, the ECU Manager module:</p><ul><li>Initializes and de-initializes the OS, the SchM and the BswM as well as some basic software driver modules.</li><li>configures the ECU for SLEEP and SHUTDOWN when requested.</li><li>manages all wakeup events on the ECU</li></ul></blockquote><p>ECUM æ˜¯ BSW å±‚</p><ul><li>ç®¡ç†åˆå§‹åŒ– OSã€SchMã€BswMã€ä»¥åŠä¸€äº›åŸºæœ¬çš„è½¯ä»¶é©±åŠ¨æ¨¡å—</li><li>ç®¡ç† ECU çš„çŠ¶æ€</li><li>ç®¡ç†å”¤é†’äº‹ä»¶</li></ul><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240724153319855.png" alt="image-20240724153319855"></p><blockquote><p>The ECU Manager module provides the wakeup validation protocol to distinguish â€™realâ€™ wakeup events from â€™erraticâ€™ ones.</p></blockquote><p>EcuM æä¾›äº†å”¤é†’éªŒè¯åè®®ï¼Œæ¥åŒºåˆ†çœŸå®å”¤é†’å’Œä¸ç¨³å®šå”¤é†’</p><blockquote><p>Furthermore:</p><ul><li>Partial or fast startup where he ECU starts up with limited capabilities and later, as determined by the application, continues startup step by step.</li><li>Interleaved startup where the ECU starts minimally and then starts the RTE to execute functionality in SW-Cs as soon as possible. It then continues to start further BSW and SW-Cs, thus interleaving BSW and application functionality..</li><li>Multiple operational states where the ECU has more than one RUN state. This, among other things, refines the notion of a spectrum of SLEEP states to RUN states. There can now be a continuum of operational states spanning from the classic RUN (fully operational) to the deepest SLEEP (processor halted).</li><li>Multi-Core ECUs: STARTUP, SHUTDOWN, SLEEP and WAKEUP are coordi nated on all cores of the ECU.</li></ul></blockquote><p>æ­¤å¤–</p><ul><li>éƒ¨åˆ†æˆ–å¿«é€Ÿå¯åŠ¨ï¼ŒECU ä»¥æœ‰é™çš„åŠŸèƒ½å¯åŠ¨ï¼Œç„¶åæ ¹æ®åº”ç”¨ç¨‹åºçš„å†³å®šï¼Œç»§ç»­é€æ­¥å¯åŠ¨ã€‚</li><li>äº¤é”™å¯åŠ¨ï¼ŒECU æœ€å°å¯åŠ¨ï¼Œç„¶åå¯åŠ¨ RTE ä»¥å°½å¿«æ‰§è¡Œ SW-Cs ä¸­çš„åŠŸèƒ½ã€‚ç„¶åï¼Œå®ƒç»§ç»­å¯åŠ¨è¿›ä¸€æ­¥çš„ BSW å’Œ SW-Csï¼Œä»è€Œå°† BSW å’Œåº”ç”¨ç¨‹åºåŠŸèƒ½äº¤ç»‡åœ¨ä¸€èµ·ã€‚</li><li>å¤šä¸ªè¿è¡ŒçŠ¶æ€ï¼ŒECU å…·æœ‰å¤šä¸ª RUN çŠ¶æ€ã€‚è¿™å°†ç¡çœ çŠ¶æ€è°±çš„æ¦‚å¿µç»†åŒ–ä¸ºè¿è¡ŒçŠ¶æ€ã€‚ç°åœ¨å¯ä»¥æœ‰ä¸€ç³»åˆ—æ“ä½œçŠ¶æ€ï¼Œä»ç»å…¸çš„ RUN (å®Œå…¨è¿è¡Œ) åˆ°æœ€æ·±çš„ç¡çœ  (å¤„ç†å™¨åœæ­¢)</li><li>å¤šæ ¸ ECU: å¯åŠ¨ï¼Œå…³é—­ï¼Œç¡çœ å’Œå”¤é†’æ˜¯åè°ƒåœ¨æ‰€æœ‰æ ¸å¿ƒçš„ ECUã€‚</li></ul><blockquote><p>Flexible ECU management employs the generic mode management facilities provided by the following modules:</p><ul><li>RTE and BSW Scheduler module [2] are now amalgamated into one module: This module supports freely configurable BSW and application modes and their mode-switching facilities.</li><li>BSW Mode Manager module [3]: This module implements configurable rules and action lists to evaluate the conditions for switching ECU modes and to implement the necessary actions to do so.</li></ul></blockquote><p>BswM æ¨¡å—é…åˆ EcuM æ¥å®ç°æ¨¡å¼åˆ‡æ¢</p><blockquote><p>Thus with Flexible ECU Management, most ECU states are no longer implemented in the ECU Manager module itself. In general, the ECU Manager module takes over control when the generic mode management facilities are unavailable in:</p><ul><li>Early STARTUP phases,</li><li>Late SHUTDOWN phases,</li><li>SLEEP phases where the facilities are locked out by the scheduler</li></ul><p>During the UP Phase of the ECU Manager module the BSW Mode Manager is responsible for further actions. Whereas, the ECU Manager module arbitrates RUN and POST_RUN Requests from SW-Cs and notifies BswM about the status of the modes.</p></blockquote><p>åœ¨ ECU ç®¡ç†å™¨æ¨¡å—çš„ UP é˜¶æ®µï¼ŒBSW æ¨¡å¼ç®¡ç†å™¨è´Ÿè´£è¿›ä¸€æ­¥çš„è¡ŒåŠ¨ï¼Œè€Œ ECU ç®¡ç†å™¨æ¨¡å—åˆ™ä»²è£æ¥è‡ª SW-C çš„ RUN å’Œ POST RUN è¯·æ±‚ï¼Œå¹¶é€šçŸ¥ BSwM å…³äºå¼çš„çŠ¶æ€ã€‚</p><h2 id="7-functional-specification"><a class="anchor" href="#7-functional-specification">#</a> 7 Functional Specification</h2><h3 id="71-phases-of-the-ecu-manager-module"><a class="anchor" href="#71-phases-of-the-ecu-manager-module">#</a> 7.1 Phases of the ECU Manager Module</h3><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240724161658298.png" alt="image-20240724161658298"></p><blockquote><p><strong>7.1.1</strong> <strong>STARTUP Phase</strong></p><p>The purpose of the STARTUP phase is to initialize the basic software modules to the</p><p>point where Generic Mode Management facilities are operational.</p><p><strong>7.1.2</strong> <strong>UP Phase</strong></p><p><strong>7.1.3</strong> <strong>SHUTDOWN Phase</strong></p><p><strong>7.1.4</strong> <strong>SLEEP Phase</strong></p><p>The ECU saves energy in the SLEEP phase.</p><p>The ECU Manager module wakes the ECU up in response to intended or unintended wakeup events. Since unintended wakeup events should be ignored, the ECU Manager module provides a protocol to validate wakeup events. The protocol specifies a cooperative process between the driver which handles the wakeup source and the ECU Manager (see section 7.6.4 ).</p><p>å“åº”é¢„æœŸæˆ–è€…éé¢„æœŸçš„å”¤é†’äº‹ä»¶ï¼Œå¹¶ä¸”æœ‰å“åº”çš„å”¤é†’éªŒè¯æœºåˆ¶</p><p><strong>7.1.5</strong> <strong>OFF Phase</strong></p></blockquote><h3 id="72-structural-description-of-the-ecu-manager"><a class="anchor" href="#72-structural-description-of-the-ecu-manager">#</a> 7.2 Structural Description of the ECU Manager</h3><p><strong>Standardized AUTOSAR Software Modules</strong></p><blockquote><p>Some Basic Software driver modules are initialized, shut down and re-initialized upon wakeup by the ECU Manager module.</p><p>The OS is initialized and shut down by the ECU Manager.</p><p>After the OS initialization, additional initialization steps are undertaken by the ECU Manager module before passing control to the BswM. The BswM hands execution control back to the ECU Manager module immediately before OS shutdown. Details are provided in the chapters 7.3 STARTUP and 7.4 SHUTDOWN .</p></blockquote><p>ä¸€äº›æ ‡å‡†åŒ–çš„è½¯ä»¶æ¨¡å—</p><p><strong>Software Components</strong></p><blockquote><p>SW-Components contain the AUTOSAR ECUâ€™s application code. A SW-C interacts with the ECU Manager module using AUTOSAR ports.</p></blockquote><h3 id="73-startup-phase"><a class="anchor" href="#73-startup-phase">#</a> 7.3 STARTUP Phase</h3><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240724181823042.png" alt="image-20240724181823042"></p><p><strong>StartPreOS Sequence</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240725110729816.png" alt="image-20240725110729816"></p><p><strong>Activities in the StartPostOS Sequence</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240725111024887.png" alt="image-20240725111024887"></p><h3 id="74-shutdown-phase"><a class="anchor" href="#74-shutdown-phase">#</a> 7.4 SHUTDOWN Phase</h3><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162235012.png" alt="image-20240823162235012"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162326111.png" alt="image-20240823162326111"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162348543.png" alt="image-20240823162348543"></p><h3 id="75-sleep-phase"><a class="anchor" href="#75-sleep-phase">#</a> 7.5 SLEEP Phase</h3><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162413491.png" alt="image-20240823162413491"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162521318.png" alt="image-20240823162521318"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162542307.png" alt="image-20240823162542307"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823162654622.png" alt="image-20240823162654622"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823163040612.png" alt="image-20240823163040612"></p><h3 id="76-up-phase"><a class="anchor" href="#76-up-phase">#</a> 7.6 UP Phase</h3><blockquote><p>In the UP Phase, the EcuM_MainFunction is executed regularly and it has three major functions:</p><ul><li>To check if wakeup sources have woken up and to initiate wakeup validation, if necessary (see 7.6.4 Activities in the WakeupValidation Sequence)</li><li>To update the Alarm Clock timer</li><li>Arbitrate RUN and POST_RUN requests and releases.</li></ul></blockquote><p>åœ¨ UP é˜¶æ®µï¼ŒEcuM MainFunction ä¼šå®šæœŸæ‰§è¡Œï¼Œå®ƒæœ‰ä¸‰ä¸ªä¸»è¦åŠŸèƒ½:</p><ul><li>æ£€æŸ¥å”¤é†’æºæ˜¯å¦å·²å”¤é†’ï¼Œå¹¶åœ¨å¿…è¦æ—¶å¯åŠ¨å”¤é†’éªŒè¯ (å‚è§å”¤é†’éªŒè¯åºåˆ—ä¸­çš„ 7.6.4 æ´»åŠ¨)</li><li>æ›´æ–°é—¹é’Ÿå®šæ—¶å™¨</li><li>å¯¹ RUN å’Œ POST_RUN è¯·æ±‚å’Œé‡Šæ”¾è¿›è¡Œä»²è£ã€‚</li></ul><p><strong>Alarm Clock Handling</strong></p><p><strong>Interaction of Wakeup Sources and the ECU Manager</strong></p><p><strong>Wakeup Validation Timeout</strong></p><p><strong>Requirements for Drivers with Wakeup Sources</strong></p><p><strong>Requirements for Wakeup Validation</strong></p><p><strong>Wakeup Sources with Integrated Power Control</strong></p><h3 id="77-shutdown-targets"><a class="anchor" href="#77-shutdown-targets">#</a> 7.7 Shutdown Targets</h3><blockquote><p>"Shutdown Targets" is a descriptive term for all states ECU where no code is executed.</p><p>They are called shutdown targets because they are the destination states where the state machine will drive to when the UP phase is left. The following states are shutdown targets:</p><ul><li>Off</li><li>Sleep</li><li>Reset</li></ul></blockquote><h3 id="78-alarm-clock"><a class="anchor" href="#78-alarm-clock">#</a> 7.8 Alarm Clock</h3><h3 id="79-multicore"><a class="anchor" href="#79-multicore">#</a> 7.9 MultiCore</h3><blockquote><p>The BSW modules can be distributed over different partitions and therefore over different cores. Some BSW modules as the BswM have to be included into every partition. Other modules like the OS or the EcuM have be included into one partition per core.</p></blockquote><p>BSW æ¨¡å—å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†åŒºä¸­ï¼Œå› æ­¤å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šã€‚ä¸€äº› BSW æ¨¡å—ï¼Œå¦‚ BsWMï¼Œå¿…é¡»åŒ…å«åœ¨æ¯ä¸ªåˆ†åŒºä¸­ã€‚å…¶ä»–æ¨¡å—ï¼Œå¦‚ OS æˆ– EcuMï¼Œå¿…é¡»åŒ…å«åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823170909487.png" alt="image-20240823170909487"></p><blockquote><p>In a multi core architecture the EcuM has to be distributed in a way, that one instance per core exists.</p></blockquote><p>åœ¨å¤šæ ¸å¿ƒæ¶æ„ä¸­ï¼ŒEcuM å¿…é¡»ä»¥æ¯ä¸ªæ ¸å¿ƒå­˜åœ¨ä¸€ä¸ªå®ä¾‹çš„æ–¹å¼è¿›è¡Œåˆ†å¸ƒã€‚</p><blockquote><p>There is one designated master core in which the boot loader starts the master EcuM via EcuM_Init.</p></blockquote><p>æœ‰ä¸€ä¸ªæŒ‡å®šçš„ä¸»æ ¸å¿ƒï¼Œå¼•å¯¼åŠ è½½ç¨‹åºåœ¨å…¶ä¸­é€šè¿‡ EcuM_Init å¯åŠ¨ä¸» EcuMã€‚</p><blockquote><p>The master EcuM starts some drivers, determines the Post Build configuration and starts all remaining cores with all their satellite EcuMs.</p></blockquote><p>ä¸» EcuM å¯åŠ¨ä¸€äº›é©±åŠ¨ç¨‹åºï¼Œç¡®å®šæ„å»ºåé…ç½®ï¼Œå¹¶ä½¿ç”¨å…¶æ‰€æœ‰å«æ˜Ÿ EcuM æ¥å¯åŠ¨æ‰€æœ‰å‰©ä½™çš„æ ¸å¿ƒã€‚</p><blockquote><p>Each EcuM now starts the core local OS and all core local BswMs (in every partition resides exactly one BswM).</p></blockquote><p>æ¯ä¸ª EcuM ç°åœ¨éƒ½å¯åŠ¨æ ¸å¿ƒæœ¬åœ°æ“ä½œç³»ç»Ÿå’Œæ‰€æœ‰æ ¸å¿ƒæœ¬åœ° BswM (æ¯ä¸ªåˆ†åŒºä¸­éƒ½é©»ç•™ç€ä¸€ä¸ª BsWM</p><blockquote><p>If the same image of EcuM is executed on every core of the ECU, the ECU Managerâ€™s behavior has to differ on the different cores.</p></blockquote><p>å¦‚æœ EcuM çš„ç›¸åŒæ˜ åƒåœ¨ ECU çš„æ¯ä¸ªæ ¸å¿ƒä¸Šæ‰§è¡Œï¼Œåˆ™ ECU Manager åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šçš„è¡Œä¸ºå¿…é¡»æœ‰æ‰€ä¸åŒã€‚</p><blockquote><p>This can be accomplished by the ECU Manager by testing first whether it is on a master or a slave core and act appropriately.</p></blockquote><p>è¿™å¯ä»¥é€šè¿‡ ECU ç®¡ç†å™¨æ¥å®Œæˆï¼Œé¦–å…ˆæµ‹è¯•å®ƒæ˜¯å¦ä½äºä¸»æ ¸å¿ƒæˆ–ä»å±æ ¸å¿ƒä¸Šï¼Œå¹¶é‡‡å–é€‚å½“çš„è¡ŒåŠ¨ã€‚</p><blockquote><p>The ECU Manager module supports the same phases on a MultiCore ECU as are available on conventional ECUs (i.e. STARTUP, UP, SHUTDOWN and SLEEP).</p></blockquote><p>ECU Manager æ¨¡å—æ”¯æŒä¸ä¼ ç»Ÿ ECU ç›¸åŒçš„å¤šæ ¸ ECU é˜¶æ®µ (å³ STARTUPã€UPã€SHUTDOWN å’Œ SLEEP)</p><blockquote><p>If safety mechanisms are used, The ECU State Manager has to run with full trust level.</p></blockquote><p>å¦‚æœä½¿ç”¨å®‰å…¨æœºåˆ¶ï¼ŒECU çŠ¶æ€ç®¡ç†å™¨å¿…é¡»åœ¨å®Œå…¨ä¿¡ä»»çº§åˆ«è¿è¡Œã€‚</p><blockquote><p>This section uses previous ECU Manager terms for various ECU states, notably Run/PostRun.</p></blockquote><p>æœ¬èŠ‚ä½¿ç”¨ä»¥å‰çš„ ECU Manager æœ¯è¯­æ¥æè¿°å„ç§ ECU çŠ¶æ€ï¼Œç‰¹åˆ«æ˜¯ Run/PostRunã€‚</p><blockquote><p>With flexible ECU management, the system integrator determines the ECUâ€™s statesâ€™ names and semantics.</p></blockquote><p>é€šè¿‡çµæ´»çš„ ECU ç®¡ç†ï¼Œç³»ç»Ÿé›†æˆå•†ç¡®å®š ECU çš„çŠ¶æ€åç§°å’Œè¯­ä¹‰ã€‚</p><blockquote><p>Methods to ensure a de-initialization phase must be upheld, however. The names used here are therefore not normative.</p></blockquote><p>ä½†æ˜¯ï¼Œå¿…é¡»åšæŒç¡®ä¿å»åˆå§‹åŒ–é˜¶æ®µçš„æ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨çš„åç§°ä¸æ˜¯è§„èŒƒæ€§çš„ã€‚</p><p><strong>Master Core</strong></p><blockquote><p>There is one explicit master core. Which core the master core is, is determined by the boot loader.</p></blockquote><p>æœ‰ä¸€ä¸ªæ˜¾å¼çš„ä¸»æ ¸ï¼Œä¸»æ ¸æ˜¯ä»€ä¹ˆï¼Œç”±å¼•å¯¼åŠ è½½ç¨‹åºå†³å®šã€‚</p><blockquote><p>The EcuM of the master core gets started as first BSW module and performs initialization actions.</p></blockquote><p>ä¸»æ ¸å¿ƒçš„ EcuM ä½œä¸ºç¬¬ä¸€ä¸ª BSW æ¨¡å—å¯åŠ¨ï¼Œå¹¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p><blockquote><p>Then is starts all other cores with all other EcuMs.</p></blockquote><p>ç„¶åç”¨æ‰€æœ‰å…¶ä»– EcuM å¯åŠ¨æ‰€æœ‰å…¶ä»–æ ¸å¿ƒã€‚</p><blockquote><p>When these are started, it initializes together with each satellite EcuM the core local OS and BswM.</p></blockquote><p>å½“è¿™äº›å¯åŠ¨æ—¶ï¼Œå®ƒä¼šä¸æ¯ä¸ªå«æ˜Ÿ EcuM ä¸€èµ·åˆå§‹åŒ–æ ¸å¿ƒæœ¬åœ°æ“ä½œç³»ç»Ÿå’Œ BsWMã€‚</p><p><strong>Slave Core</strong></p><blockquote><p>On every slave core, one satellite EcuM has to run. If a core contains more than one partition, only on EcuM per core has to exist.</p></blockquote><p>åœ¨æ¯ä¸ªä»å±æ ¸å¿ƒä¸Šï¼Œå¿…é¡»è¿è¡Œä¸€ä¸ªå«æ˜Ÿ EcuMã€‚å¦‚æœä¸€ä¸ªæ ¸å¿ƒåŒ…å«å¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªæ ¸å¿ƒå¿…é¡»åªå­˜åœ¨äº EcuM ä¸Šã€‚</p><p><strong>Master Core - Slave Core Signalling</strong></p><blockquote><p>This section discusses the general mechanisms with which BSW can communicate over cores. It presupposed general knowledge of the SchM, which is described and specified in the RTE.</p></blockquote><p>æœ¬èŠ‚è®¨è®ºäº† BSW åœ¨æ ¸å¿ƒä¸Šè¿›è¡Œé€šä¿¡çš„ä¸€èˆ¬æœºåˆ¶ï¼Œå‰ææ˜¯äººä»¬å¯¹ SchM æœ‰ä¸€å®šçš„äº†è§£ï¼Œè¿™åœ¨ RTE ä¸­å·²ç»ä½œäº†æè¿°å’Œé˜è¿°ã€‚</p><blockquote><p>The Operating System provides a basic mechanism for synchronizing the starts of the operating systems on the master and slave cores.</p></blockquote><p>æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªåŸºæœ¬æœºåˆ¶ï¼Œç”¨äºåŒæ­¥æ“ä½œç³»ç»Ÿåœ¨ä¸»ä»å†…æ ¸ä¸Šçš„å¯åŠ¨ã€‚</p><blockquote><p>The Scheduler Manager provides basic mechanisms for communication of BSW modules across partition boundaries.</p></blockquote><p>Scheduler Manager ä¸º BSW æ¨¡å—è·¨åˆ†åŒºè¾¹ç•Œé€šä¿¡æä¾›äº†åŸºæœ¬æœºåˆ¶ã€‚</p><blockquote><p>One BSW Mode Manager per core is responsible for starting and stopping the RTE.</p></blockquote><p>æ¯ä¸ªæ ¸å¿ƒä¸­æœ‰ä¸€ä¸ª BSW æ¨¡å¼ç®¡ç†å™¨è´Ÿè´£å¯åŠ¨å’Œåœæ­¢ RTEã€‚</p><p><strong>Example for Shutdown Synchronization</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826134415650-172510160353732.png" alt="image-20240826134415650"></p><p><strong>UP Phase</strong></p><blockquote><p>From the hardware perspective, it is possible that wakeup interrupts could occur on all cores. Then the whole ECU gets woken up and the EcuM running on that processes the wakeup event.</p></blockquote><p>ä»ç¡¬ä»¶è§’åº¦æ¥çœ‹ï¼Œæ‰€æœ‰å†…æ ¸éƒ½å¯èƒ½å‘ç”Ÿå”¤é†’ä¸­æ–­ï¼Œç„¶åæ•´ä¸ª ECU è¢«å”¤é†’ï¼Œè¿è¡Œåœ¨è¯¥ ECU ä¸Šçš„ EcuM å¤„ç†å”¤é†’äº‹ä»¶ã€‚</p><p><strong>STARTUP Phase</strong></p><blockquote><p>The ECU Manager module functions nearly identically on all cores. That is, as for the single-core case, the ECU Manager module performs the steps specified for Startup;</p></blockquote><p>ECU Manager æ¨¡å—åœ¨æ‰€æœ‰å†…æ ¸ä¸Šçš„åŠŸèƒ½å‡ ä¹ç›¸åŒï¼Œå³å¯¹äºå•å†…æ ¸çš„æƒ…å†µï¼ŒECU Manager æ¨¡å—æ‰§è¡ŒæŒ‡å®šçš„å¯åŠ¨æ­¥éª¤ï¼›</p><blockquote><p>most importantly starting the OS, initializing the SchM and starting the core local BswMs.</p></blockquote><p>æœ€é‡è¦çš„æ˜¯å¯åŠ¨æ“ä½œç³»ç»Ÿï¼Œåˆå§‹åŒ– SchM å¹¶å¯åŠ¨æ ¸å¿ƒæœ¬åœ° BswMã€‚</p><blockquote><p>After each EcuM has called StartOs on its core, the OS synchronizes the cores before executing the core-individual startup hooks and synchronizes the cores again before executing the first tasks on each core.</p></blockquote><p>æ¯ä¸ª EcuM åœ¨å…¶æ ¸å¿ƒä¸Šè°ƒç”¨ StartOs åï¼ŒOS åœ¨æ‰§è¡Œæ ¸å¿ƒçº§å¯åŠ¨æŒ‚é’©ä¹‹å‰åŒæ­¥æ ¸å¿ƒï¼Œå¹¶åœ¨æ¯ä¸ªæ ¸å¿ƒä¸Šæ‰§è¡Œç¬¬ä¸€ä¸ªä»»åŠ¡ä¹‹å‰å†æ¬¡åŒæ­¥æ ¸å¿ƒã€‚</p><blockquote><p>StartPostOS is executed on each core and the SchM is initialized on each core. All core local BswMs are initialized by each EcuM.</p></blockquote><p>StartPostOS åœ¨æ¯ä¸ªæ ¸å¿ƒä¸Šæ‰§è¡Œï¼ŒSchM åœ¨æ¯ä¸ªæ ¸å¿ƒåˆå§‹åŒ–ã€‚æ‰€æœ‰æ ¸å¿ƒæœ¬åœ° BswMs éƒ½ç”±æ¯ä¸ª EcuM åˆå§‹åŒ–ã€‚</p><blockquote><p>One BswM on every partition has to start the RTE for that core.</p></blockquote><p>æ¯ä¸ªåˆ†åŒºä¸Šæœ‰ä¸€ä¸ª BswM å¿…é¡»ä¸ºè¯¥æ ¸å¿ƒå¯åŠ¨ RTE.</p><p><strong>Master Core STARTUP</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135159450-172510162535834.png" alt="image-20240826135159450"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135243337.png" alt="image-20240826135243337"></p><p><strong>Slave Core STARTUP</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135405363.png" alt="image-20240826135405363"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135454522.png" alt="image-20240826135454522"></p><p><strong>SHUTDOWN Phase</strong></p><blockquote><p>When the ECU shall be shut down, the master ECU Manager module calls ShutdownAllCores rather than somehow calling ShutdownOS on the individual cores. The ShutdownAllCores stops the OS on all cores and stops all cores as well.</p></blockquote><p>ç›®å‰åªæ”¯æŒæ‰€æœ‰æ ¸å¿ƒåŒæ—¶å…³é—­</p><p><strong>Master Core SHUTDOWN</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135814637.png" alt="image-20240826135814637"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135832000.png" alt="image-20240826135832000"></p><p><strong>Slave Core SHUTDOWN</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135921626.png" alt="image-20240826135921626"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826135936834.png" alt="image-20240826135936834"></p><p><strong>SLEEP Phase</strong></p><p>å°±æ˜¯è¦åŒæ­¥ï¼Œæ— èŠæ­»äº†</p><p><strong>Runnables and Entry points</strong></p><p>P93 æ²¡çœ‹æ‡‚å¹²å•¥çš„</p><h3 id="710-ecum-mode-handling"><a class="anchor" href="#710-ecum-mode-handling">#</a> 7.10 EcuM Mode Handling</h3><blockquote><p>The ECU State Manager provides interfaces for SW-Cs to request and release the modes RUN and POST_RUN optionally.</p></blockquote><p>ECU çŠ¶æ€ç®¡ç†å™¨ä¸º SWC æä¾›æ¥å£ï¼Œå¯é€‰æ‹©åœ°è¯·æ±‚å’Œé‡Šæ”¾ RUN å’Œ POST_RUN æ¨¡å¼ã€‚</p><blockquote><p>EcuMFlex arbitrates the requests and releases made by SW-Cs and propagates the result to BswM.</p></blockquote><p>EcuMFlex å¯¹ SWC æå‡ºçš„è¯·æ±‚å’Œé‡Šæ”¾è¿›è¡Œä»²è£ï¼Œå¹¶å°†ç»“æœä¼ æ’­åˆ° BswMã€‚</p><blockquote><p>The cooperation between EcuM and BswM is necessary as only the BswM can decide when a transition to a different mode can be made.</p></blockquote><p>EcuM å’Œ BsWM ä¹‹é—´çš„åˆä½œæ˜¯å¿…è¦çš„ï¼Œå› ä¸ºåªæœ‰ BswM å¯ä»¥å†³å®šä½•æ—¶å¯ä»¥è¿‡æ¸¡åˆ°ä¸åŒçš„æ¨¡å¼ã€‚</p><blockquote><p>Due to the fact that the EcuM does not have an own state machine, the EcuM relies on the state transitions made by BswM.</p></blockquote><p>ç”±äº EcuM æ²¡æœ‰è‡ªå·±çš„çŠ¶æ€æœºï¼Œæ‰€ä»¥ EcuM ä¾èµ–äº BswM æ‰€åšçš„çŠ¶æ€è½¬æ¢ã€‚</p><blockquote><p>Therefore the EcuM does not request a state. Furthermore it notifies the BswM about the current arbitration of all requests.</p></blockquote><p>å› æ­¤ï¼ŒEcuM ä¸è¯·æ±‚æŸä¸ªçŠ¶æ€ï¼Œè€Œä¸”å®ƒå°†æ‰€æœ‰è¯·æ±‚çš„å½“å‰ä»²è£æƒ…å†µé€šçŸ¥ BswMã€‚</p><blockquote><p>And the BswM is notified when the RTE has executed all Runnables belonging to a certain mode.</p></blockquote><p>å½“ RTE æ‰§è¡Œäº†å±äºæŸä¸ªæ¨¡å¼çš„æ‰€æœ‰ Runnables æ—¶ï¼ŒBswM å°†æ”¶åˆ°é€šçŸ¥ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826140757779.png" alt="image-20240826140757779"></p><h3 id="711-advanced-topics"><a class="anchor" href="#711-advanced-topics">#</a> 7.11 Advanced Topics</h3><p><strong>Relation to Bootloader</strong></p><blockquote><p>The Bootloader is not part of AUTOSAR. Still, the application needs an interface to activate the bootloader. For this purpose, two functions are provided: EcuM_Select_BootTarget and EcuM_GetBootTarget .</p></blockquote><p>å¼•å¯¼åŠ è½½ç¨‹åºä¸æ˜¯ AUTOSAR çš„ä¸€éƒ¨åˆ†ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåº”ç”¨ç¨‹åºéœ€è¦ä¸€ä¸ªæ¥å£æ¥æ¿€æ´»å¼•å¯¼åŠ è½½ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼šEcuM_Select_BootTarget å’Œ EcuM_GetBootTarget ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826141145160.png" alt="image-20240826141145160"></p><p><strong>Relation to Complex Drivers</strong></p><blockquote><p>If a complex driver handles a wakeup source, it must follow the protocol for handling wakeup events specified in this document.</p></blockquote><p><strong>Handling Errors during Startup and Shutdown</strong></p><blockquote><p>BSW modules are responsible themselves for reporting errors occurring during their initialization directly to the DEM module or the DET module, as specified in their SWSs.</p></blockquote><p>BSW æ¨¡å—è‡ªè¡Œè´Ÿè´£å°†åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ç›´æ¥æŠ¥å‘Šç»™ DEM æ¨¡å—æˆ– DET æ¨¡å—ï¼Œå¦‚å…¶ SWS ä¸­æ‰€æŒ‡å®šçš„é‚£æ ·ã€‚</p><blockquote><p>The ECU Manager module does not report the errors. The BSW module is also responsible for taking any special measures to react to errors occurring during their initialization.</p></blockquote><p>ECU Manager æ¨¡å—ä¸æŠ¥å‘Šé”™è¯¯ã€‚BSW æ¨¡å—è¿˜è´Ÿè´£é‡‡å–ä»»ä½•ç‰¹åˆ«æªæ–½æ¥åº”å¯¹åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="712-errorhook"><a class="anchor" href="#712-errorhook">#</a> 7.12 ErrorHook</h3><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826141436988.png" alt="image-20240826141436988"></p><h3 id="713-error-classification"><a class="anchor" href="#713-error-classification">#</a> 7.13 Error classification</h3><p><strong>Development Errors</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826141611330.png" alt="image-20240826141611330"></p><p><strong>Runtime Errors</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826141637010.png" alt="image-20240826141637010"></p><h2 id="9-sequence-charts"><a class="anchor" href="#9-sequence-charts">#</a> 9 Sequence Charts</h2><h3 id="91-state-sequences"><a class="anchor" href="#91-state-sequences">#</a> 9.1 State Sequences</h3><p>å‚ç…§å‰é¢çš„çŠ¶æ€åˆ‡æ¢åºåˆ—å›¾</p><h3 id="92-wakeup-sequences"><a class="anchor" href="#92-wakeup-sequences">#</a> 9.2 Wakeup Sequences</h3><p><strong>GPT Wakeup Sequences</strong></p><p>General Purpose Timer (GPT)</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826141923686.png" alt="image-20240826141923686"></p><p><strong>ICU Wakeup Sequences</strong></p><p>Input Capture Unit (ICU)</p><p>ICU ä¸æ˜¯å”¤é†’æºï¼Œå› æ­¤ä¸ GPT ä¸åŒï¼Œå®ƒåªæ˜¯è§¦å‘ä¸­æ–­ç„¶åäº¤ç”± EcuM å»æ£€æŸ¥å”¤é†’ä¿¡å·</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826142206291.png" alt="image-20240826142206291"></p><p><strong>CAN Wakeup Sequences</strong></p><blockquote><p>On CAN a wake up can be detected by the transceiver or the communication controller using either an interrupt or polling. Wake up source identifiers should be shared between transceiver and controller as the ECU State Manager module only needs to know the network that has woken up and passes that on to the Communication Manager module.</p></blockquote><p>åœ¨ CAN ä¸Šï¼Œæ”¶å‘å™¨æˆ–é€šä¿¡æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ä¸­æ–­æˆ–è½®è¯¢æ¥æ£€æµ‹å”¤é†’ã€‚å”¤é†’æºæ ‡è¯†ç¬¦åº”åœ¨æ”¶å‘å™¨å’Œæ§åˆ¶å™¨ä¹‹é—´å…±äº«ï¼Œå› ä¸º ECU çŠ¶æ€ç®¡ç†å™¨æ¨¡å—åªéœ€è¦çŸ¥é“å”¤é†’çš„ç½‘ç»œï¼Œå¹¶å°†å…¶ä¼ é€’ç»™é€šä¿¡ç®¡ç†å™¨æ¨¡å—ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826142620855.png" alt="image-20240826142620855"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826142814534.png" alt="image-20240826142814534"></p><p><strong>LIN Wakeup Sequences</strong></p><p><strong>FlexRay Wakeup Sequences</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826143106053.png" alt="image-20240826143106053"></p><p><strong>Ethernet Wakeup Sequence</strong></p><blockquote><p>On a Ethernet switched network with OA TC10 compliant Ethernet hardware a wake up can be detected by the used Ethernet hardware (PHY).</p></blockquote><p>åœ¨å…·æœ‰ OA TC10 å…¼å®¹çš„ä»¥å¤ªç½‘ç¡¬ä»¶çš„ä»¥å¤ªäº¤æ¢ç½‘ç»œä¸Šï¼Œå¯ç”¨çš„ä»¥å¤ªç½‘ç»œç¡¬ä»¶ (PHY) å¯ä»¥æ£€æµ‹åˆ°å”¤é†’ã€‚</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826143417427.png" alt="image-20240826143417427"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826143433321.png" alt="image-20240826143433321"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826143454607.png" alt="image-20240826143454607"></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240826143508844.png" alt="image-20240826143508844"></p><h1 id="bswmodemanager"><a class="anchor" href="#bswmodemanager">#</a> BSWModeManager</h1><h2 id="1-introduction-and-functional-overview-2"><a class="anchor" href="#1-introduction-and-functional-overview-2">#</a> 1 Introduction and functional overview</h2><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240820174856654.png" alt="image-20240820174856654"></p><blockquote><p>This specification specifies the functionality, API and the configuration of the AUTOSAR Basic Software module BSW Mode Manager (BswM).</p><p>The BSW Mode Manager is the module that implements the part of the Vehicle Mode Management and Application Mode Management concept that resides in the BSW.</p><p>Its responsibility is to arbitrate mode requests from application layer SW-Cs or other BSW modules based on simple rules, and perform actions based on the arbitration result.</p></blockquote><p>å°±æ˜¯è¦æ ‡å‡†åŒ–è¿™ä¸ª BSWM</p><p>BSW æ¨¡å¼ç®¡ç†å™¨æ˜¯å®ç° BSW ä¸­è½¦è¾†æ¨¡å¼ç®¡ç†å’Œåº”ç”¨æ¨¡å¼ç®¡ç†æ¦‚å¿µçš„éƒ¨åˆ†ï¼Œ</p><p>å…¶èŒè´£æ˜¯åŸºäºç®€å•è§„åˆ™å¯¹åº”ç”¨å±‚ SWC æˆ–å…¶ä»– BSW æ¨¡å—çš„æ¨¡å¼è¯·æ±‚è¿›è¡Œä»²è£ï¼Œå¹¶æ ¹æ®ä»²è£ç»“æœæ‰§è¡Œæ“ä½œã€‚</p><h2 id="5-dependencies-to-other-modules"><a class="anchor" href="#5-dependencies-to-other-modules">#</a> 5 Dependencies to other modules</h2><ul><li><p><strong>RTE</strong></p><ul><li>The BswM receives mode requests from the SW-Cs via the RTE. Mode Switch Notifications are also propagated to the SW-Cs via the RTE.</li></ul></li><li><p><strong>EcuM - Flex</strong></p><ul><li>EcuM Flex can indicate the state of its wakeup sources to BswM. When ECU Mode Handling is used, BswM can set the state of EcuM - Flex and receives status of certain modes based on the RUN Request Protocol.</li></ul></li><li><p><strong>ComM</strong></p><ul><li>Mode Switch Indications originating from the ComM go through the BswM for further propagation to the SW-Cs. The BswM can request communication modes at the ComM by means of ComMUsers.</li></ul></li><li><p><strong>COM</strong></p><ul><li>The handling of I-PDU Groups in COM is performed by the BswM. As a part of IPDU group start/stop, it is possible to have the included signal values reset to their corresponding initialization values. BswM handles the enabling and disabling of deadline monitoring of signals in COM.BswM can also trigger transmission of an I-PDU.</li></ul></li><li><p><strong>PduR</strong></p><ul><li>The BswM can enable and disable routing groups of I-PDUs in the PDU router.</li></ul></li><li><p><strong>CanSM</strong></p><ul><li>Mode Switch Indications originating from the CanSM go through the BswM for further propagation to the SW-Cs.</li></ul></li><li><p><strong>LinSM</strong></p><ul><li>BswM coordinates switching of LIN Schedule Tables in the LinSM with starting and stopping of the corresponding I-PDU groups in COM.</li><li>Mode Switch Indications originating from the LinSM go through the BswM for further propagation to the SW-Cs.</li></ul></li><li><p><strong>LinTp</strong></p><ul><li>The LIN Transport Protocol that is a part of LinIf requests modes from BswM to makesure that the correct LIN Schedule Table is active during LinTp operation.</li></ul></li><li><p><strong>FrSM</strong></p><ul><li>Mode Switch Indications originating from the FrSM go through the BswM for further propagation to the SW-Cs.</li><li>The usage of "Single Slot Mode" on FlexRay is controlled by the FrSM by request of BswM. The send capability of the FlexRay stack can be controlled by the BswM via FrSM by calling the API FrSM_SetEcuPassive.</li></ul></li><li><p><strong>EthSM</strong></p><ul><li>Mode Switch Indications originating from the EthSM go through the BswM for further propagation to the SW-Cs.</li></ul></li><li><p><strong>DCM</strong></p><ul><li><p>The DCM performs mode requests to the BswM based on the diagnostic requests it receives.</p></li><li><p>Example: DCM can request "Disable Normal Communication". During this mode BswM</p><p>will turn off the corresponding I-PDU groups and NM PDUs.</p></li></ul></li><li><p><strong>J1939Dcm</strong></p><ul><li>The J1939Dcm reports communication state changes to the BswM for further propagation to the SW-Cs. BswM changes states of J1939Dcm via J1939Dcm_SetState.</li></ul></li><li><p><strong>J1939Nm</strong></p><ul><li>The J1939Nm provides a state indication via BswM_J1939Nm_StateChangeNotification.</li></ul></li><li><p><strong>J1939Rm</strong></p><ul><li>BswM changes states of J1939Rm via J1939Rm_SetState.</li></ul></li><li><p><strong>NM Interface</strong></p><ul><li>BswM will use the Nm_EnableCommunication and Nm_DisableCommunication to control the NM communication based on the current mode.</li><li>Example: In "Disable Normal Communication" mode, the BswM needs to disable NM communication on the corresponding NM channel.</li><li>The Nm uses BswM_Nm_CarWakeUpIndication to indicate a CarWakeup.</li></ul></li><li><p><strong>NvM</strong></p><ul><li>The NvM module reports the state of its blocks to the BswM via "integration code" registered as NvM callbacks. BswM has actions causing the NvM to read and write all blocks during startup and shutdown.</li></ul></li><li><p><strong>OS</strong></p><ul><li>The features of OS that are required by BswM, are implementation specific.</li></ul></li><li><p><strong>Sd</strong></p><ul><li>The BswM receives status indications from Sd via several exported APIs (see chapter 8.3 for examples). These status indications from Sd can be configured as BswMModeRequestSources.</li></ul></li></ul><h2 id="7-functional-specification-2"><a class="anchor" href="#7-functional-specification-2">#</a> 7 Functional specification</h2><blockquote><p>This chapter specifies the functional behavior of the BSW Mode Manager. The operation of the BSW Mode Manager basic functionality can be described as two different tasks: Mode Arbitration and Mode Control.</p></blockquote><p>BSW æ¨¡å¼ç®¡ç†å™¨åŸºæœ¬åŠŸèƒ½çš„æ“ä½œå¯ä»¥æè¿°ä¸ºä¸¤ä¸ªä¸åŒçš„ä»»åŠ¡:</p><ul><li>æ¨¡å¼ä»²è£</li><li>æ¨¡å¼æ§åˆ¶</li></ul><blockquote><p>The Mode Arbitration part initiates mode switches resulting from rule-based arbitration of mode requests and mode indications received from SW-Cs or other BSW modules.</p></blockquote><p>æ¨¡å¼ä»²è£éƒ¨åˆ†å¯åŠ¨ï¼ˆä» SW-Cs æˆ–å…¶ä»– BSW æ¨¡å—æ¥æ”¶çš„ï¼ˆæ¨¡å¼è¯·æ±‚ï¼‰å’Œï¼ˆæ¨¡å¼æŒ‡ç¤ºï¼‰çš„åŸºäºè§„åˆ™çš„ä»²è£å¯¼è‡´çš„ï¼‰æ¨¡å¼åˆ‡æ¢ã€‚</p><blockquote><p>The Mode Control part performs the mode switches by execution of action lists containing mode switch operations of other BSW modules.</p></blockquote><p>æ¨¡å¼æ§åˆ¶éƒ¨åˆ†é€šè¿‡æ‰§è¡ŒåŒ…å«å…¶ä»– BSW æ¨¡å—æ¨¡å¼åˆ‡æ¢æ“ä½œçš„æ“ä½œåˆ—è¡¨æ¥æ‰§è¡Œæ¨¡å¼åˆ‡æ¢</p><blockquote><p>The BswM should be seen as a mode management framework module in which behavior is completely defined by its configuration.</p></blockquote><p>BswM åº”è¯¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ¨¡å¼ç®¡ç†æ¡†æ¶æ¨¡å—ï¼Œå…¶ä¸­çš„è¡Œä¸ºå®Œå…¨ç”±å…¶é…ç½®æ¥å®šä¹‰ã€‚</p><blockquote><p>There may be different ways of implementing the BswM, such as generation of the complete BswM based on the configuration, or as a rule interpreter that parses an encoded configuration at run time.</p></blockquote><p>å¯èƒ½æœ‰ä¸åŒçš„å®ç° BswM çš„æ–¹å¼ï¼Œä¾‹å¦‚æ ¹æ®é…ç½®ç”Ÿæˆå®Œæ•´çš„ BsWMï¼Œæˆ–è€…ä½œä¸ºè§„åˆ™è§£é‡Šå™¨åœ¨è¿è¡Œæ—¶è§£æç¼–ç é…ç½®ã€‚</p><blockquote><p>However, this specification does not intend to specify any implementation details of the BSW Mode Manager. Hence, any examples stated in this document describing design details should be treated as explanatory text and not as requirements.</p></blockquote><p>ç„¶è€Œï¼Œè¯¥è§„èŒƒå¹¶ä¸æ‰“ç®—æŒ‡å®š BSW æ¨¡å¼ç®¡ç†å™¨çš„ä»»ä½•å®ç°ç»†èŠ‚ã€‚å› æ­¤ï¼Œæœ¬æ–‡ä»¶ä¸­æè¿°è®¾è®¡ç»†èŠ‚çš„ä»»ä½•ç¤ºä¾‹éƒ½åº”è¢«è§†ä¸ºè§£é‡Šæ€§æ–‡æœ¬ï¼Œè€Œä¸æ˜¯è¦æ±‚ã€‚</p><h3 id="mode-arbitration"><a class="anchor" href="#mode-arbitration">#</a> Mode Arbitration</h3><blockquote><p>The Mode Arbitration performed by the BswM is simple and rule-based. The rules used for mode arbitration are specified in the configuration of the BSW Mode Manager module.</p></blockquote><p>BswM æ‰§è¡Œçš„æ¨¡å¼ä»²è£æ˜¯ç®€å•ä¸”åŸºäºè§„åˆ™çš„ï¼Œæ¨¡å¼ä»²è£ä½¿ç”¨çš„è§„åˆ™åœ¨ Bsw æ¨¡å¼ç®¡ç†å™¨æ¨¡å—çš„é…ç½®ä¸­æŒ‡å®šã€‚</p><p><strong>Arbitration Rules</strong></p><blockquote><p>A rule is a logical expression that is composed of a set of mode request conditions.</p></blockquote><p>è§„åˆ™æ˜¯é€»è¾‘è¡¨è¾¾å¼ï¼Œç”±ä¸€ç»„æ¨¡å¼è¯·æ±‚æ¡ä»¶ç»„æˆã€‚</p><p><strong>Mode Conditions and Logical Expressions.</strong></p><blockquote><p>The logical expression that comprises a mode arbitration rule can use different operators such as</p><ul><li>AND</li><li>OR</li><li>XOR</li><li>NOT</li><li>NAND</li></ul></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240821165600924.png" alt="image-20240821165600924"></p><p><strong>Requirements of Mode Arbitration</strong></p><blockquote><p>As mentioned above, the BswM accepts mode requests and mode indications as input for the mode arbitration.</p></blockquote><p>å¦‚ä¸Šæ‰€è¿°ï¼ŒBswM æ¥å—æ¨¡å¼è¯·æ±‚å’Œæ¨¡å¼æŒ‡ç¤ºä½œä¸ºæ¨¡å¼ä»²è£çš„è¾“å…¥ã€‚</p><p><strong>Immediate and Deferred Operation</strong></p><blockquote><p>There are two different ways to schedule the processing of the mode arbitration.</p><p>It is either done immediately within the context of a mode request/indication,</p><p>or deferred (cyclically) to the main function of the BswM.</p></blockquote><p>ä¸¤ç§æ¨¡å¼ç«‹å³æ“ä½œå’Œå»¶è¿Ÿæ“ä½œ</p><p><strong>Arbitration Behavior after Initialization</strong></p><h3 id="mode-control"><a class="anchor" href="#mode-control">#</a> Mode Control</h3><blockquote><p>The Mode Control part of BswM performs all required actions based on the results of the mode arbitration.</p></blockquote><p>æ ¹æ®æ¨¡å¼ä»²è£çš„ç»“æœè¿›è¡Œæ‰§è¡Œæ‰€å¿…é¡»çš„æ“ä½œ</p><blockquote><p>The actions in an Action List can be of three types:</p><ol><li><p>Calls to other BSW modules or the RTE. A set of pre-defined actions are listed in 7.2.4.</p></li><li><p>Links to other action lists to be included in the execution.</p></li><li><p>Mode arbitration rules. These rules will be evaluated when the corresponding action list is executed. In this way, a hierarchy of rules is obtained.</p></li></ol></blockquote><p>1. è°ƒç”¨ BSW æˆ–è€… RTE</p><p>2. åŒ…å«å…¶ä»–æ“ä½œåˆ—è¡¨</p><p>3. åµŒå¥—çš„ä»²è£è§„åˆ™</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240821173105981.png" alt="image-20240821173105981"></p><p><strong>Mode Processing Cycle</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240821173543692.png" alt="image-20240821173543692"></p><p><strong>Requirements on Mode Control</strong></p><p><strong>Triggered and Conditional action lists</strong></p><blockquote><p>There are two ways that an action list may be executed based on evaluation of rules.</p><p>Either it is executed every time the rule is evaluated with the corresponding result, or only when the evaluation result has changed from the previous evaluation.</p></blockquote><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ¯æ¬¡ç»“æœç›¸åŒæ—¶æ‰§è¡Œ</li><li>æ¯æ¬¡ç»“æœä¸åŒæ—¶æ‰§è¡Œ</li></ul><p><strong>Available Actions</strong></p><p><strong>Behavior of Mode Control after Initialization</strong></p><p>ç”¨æ¥é…ç½®ç¬¬ä¸€æ¬¡åˆå§‹åŒ–åçš„æ‰§è¡Œè§„åˆ™</p><h3 id="waiting-functionality"><a class="anchor" href="#waiting-functionality">#</a> <strong>Waiting Functionality</strong></h3><blockquote><p>Sometimes it is necessary to delay specific actions or wait for further mode controls. For this reason a Timer handling was added to the BswM.</p></blockquote><p>æœ‰æ—¶éœ€è¦å»¶è¿Ÿç‰¹å®šæ“ä½œæˆ–ç­‰å¾…è¿›ä¸€æ­¥çš„æ¨¡å¼æ§åˆ¶ã€‚ä¸ºæ­¤ï¼Œåœ¨ BswM ä¸­æ·»åŠ äº†è®¡æ—¶å™¨å¤„ç†</p><h3 id="multi-partition-support"><a class="anchor" href="#multi-partition-support">#</a> Multi Partition Support</h3><blockquote><p>For multiple BswM instances, each BswM instance will generate its own separate service component description based on its own config set. The integrator will need to allocate these separate service components to the corresponding partition.</p><p>BswM is present in each partition with a partition specific configuration (separate instance of BswMConfig per partition). The contained action lists are executed partition locally</p></blockquote><p>å¯¹äºå¤šä¸ª BswM å®ä¾‹ï¼Œæ¯ä¸ª BswM å®ä¾‹å°†æ ¹æ®è‡ªå·±çš„é…ç½®é›†ç”Ÿæˆè‡ªå·±çš„å•ç‹¬çš„æœåŠ¡ç»„ä»¶æè¿°ã€‚é›†æˆå™¨éœ€è¦å°†è¿™äº›å•ç‹¬çš„æœåŠ¡ç»„ä»¶åˆ†é…ç»™ç›¸åº”çš„åˆ†åŒºã€‚</p><h3 id="error-classification"><a class="anchor" href="#error-classification">#</a> Error classification</h3><blockquote><p>Section 7.2 "Error Handling" of the document "General Specification of Basic Software Modules" describes the error handling of the Basic Software in detail. Above all, it constitutes a classification scheme consisting of five error types which may occur in BSW modules.</p></blockquote><p>æ–‡æ¡£ã€ŠåŸºæœ¬è½¯ä»¶æ¨¡å—é€šç”¨è§„èŒƒã€‹ç¬¬ 7.2 èŠ‚ â€œé”™è¯¯å¤„ç†â€ è¯¦ç»†æè¿°äº†åŸºæœ¬è½¯ä»¶çš„é”™è¯¯å¤„ç†ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå®ƒæ„æˆäº†ä¸€ä¸ªç”± BSW æ¨¡å—ä¸­å¯èƒ½å‡ºç°çš„äº”ç§é”™è¯¯ç±»å‹ç»„æˆçš„åˆ†ç±»æ–¹æ¡ˆã€‚</p><p><strong>Development Errors</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823145641445.png" alt="image-20240823145641445"></p><p><strong>Runtime Errors</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823145721965.png" alt="image-20240823145721965"></p><h3 id="bswm-interfaces-and-ports"><a class="anchor" href="#bswm-interfaces-and-ports">#</a> BswM Interfaces and Ports</h3><blockquote><p>SW-Cs request modes from the BSW Mode Manager.</p></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823150150269.png" alt="image-20240823150150269"></p><blockquote><p>When the RTE performs the mode switch, it informs all connected entities (BSW Modules or SW-Cs) that are connected via Mode Switch R-Ports to the providing port.</p></blockquote><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823150834103.png" alt="image-20240823150834103"></p><p><strong>Mode Request Ports</strong></p><p><strong>Mode Switch Ports</strong></p><p><strong>Notifications of Mode Switches</strong></p><p><strong>Component Type and Internal Behavior</strong></p><h3 id="ethernet-switch-port-group-switching"><a class="anchor" href="#ethernet-switch-port-group-switching">#</a> Ethernet switch port group switching</h3><blockquote><p>The current version of the SWS BswM supports Ethernet switch port group switching.</p></blockquote><p>ç›®å‰ç‰ˆæœ¬çš„ SWS BswM æ”¯æŒä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£ç»„äº¤æ¢ã€‚</p><blockquote><p>Based on the current requested PNC, BswM maps the PNC request to a configured EthIfSwitchPortGroup and calls EthIf_SwitchPortGroupRequestMode.</p></blockquote><p>æ ¹æ®å½“å‰è¯·æ±‚çš„ PNCï¼ŒBSWM å°† PNC è¯·æ±‚æ˜ å°„åˆ°é…ç½®çš„ EthIfSwitchPortGroup , å¹¶è°ƒç”¨ EthIf_SwitchPortGroupRequestMode.</p><blockquote><p>The BswM is indicated by the EthIf, if the accumulated link state has changed.</p></blockquote><p>å¦‚æœç´¯ç§¯é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ BswM ç”± Ethlf æŒ‡ç¤ºã€‚</p><blockquote><p>The accumulated link state could be used to inform an application. This could be used to cover error scenarios where the requested and the current accumulated link state of EthIfSwitchPortGroups are contradicting and error handling needs to be initiated.</p></blockquote><p>ç´¯ç§¯é“¾è·¯çŠ¶æ€å¯ä»¥ç”¨äºé€šçŸ¥åº”ç”¨ç¨‹åºã€‚è¿™å¯ä»¥ç”¨äºè¦†ç›–é”™è¯¯æƒ…å†µï¼Œå…¶ä¸­è¯·æ±‚çš„ EthIfSwitchPortGroups çš„å½“å‰ç´¯ç§¯é“¾è·¯çŠ¶æ€ä¸å½“å‰ç´¯ç§¯é“¾è·¯çŠ¶æ€ç›¸çŸ›ç›¾ï¼Œå¹¶ä¸”éœ€è¦å¯åŠ¨é”™è¯¯å¤„ç†ã€‚</p><blockquote><p>The AUTOSAR_EXP_ModemanagementGuide document contains guidelines for the BswM configuration regarding Ethernet switch port group switching.</p></blockquote><p>AUTOSAR_EXP_ModemanagementGuide æ–‡æ¡£åŒ…å«æœ‰å…³ä»¥å¤ªç½‘äº¤æ¢æœºç«¯å£ç»„äº¤æ¢çš„ BswM é…ç½®æŒ‡å—ã€‚</p><h3 id="service-discovery-control"><a class="anchor" href="#service-discovery-control">#</a> Service Discovery Control</h3><p><strong>General</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823151826995.png" alt="image-20240823151826995"></p><blockquote><p>Following steps, fulfilled by configuration tools are neccessary:</p><ol><li>Analyze SWC descriptions to find the affected ports</li><li>Analyze the ECUC to deduce the related entities in Service Discovery</li><li>Create Rules and ActionLists to implement the desired behavior provided by BswM</li><li>Create the BswMModeRequestSources for the notifications from Service Discovery Module(s)</li><li>Create the BswM side of the required S/R ports serving as input for the rules</li><li>Create the BswM side of the provided ModeSwitch ports for indications towards SWCs</li><li>Connect the ports between BswM Service SWC and Applications SWCs based on the well-defined naming schema</li></ol></blockquote><p><strong>Client Service/Event Subscription Request</strong></p><blockquote><p>A software-component that implements the client functionality acts as a mode requester and exposes a PPortPrototype typed by a SenderReceiverInterface.</p></blockquote><p>å®ç°å®¢æˆ·ç«¯åŠŸèƒ½çš„è½¯ä»¶ç»„ä»¶å……å½“æ¨¡å¼è¯·æ±‚å™¨ï¼Œå¹¶é€šè¿‡ SenderReceiverInterface å…¬å¼€ PPortPrototype</p><blockquote><p>By this means, the software-component can send mode requests towards the BswM in order to subscribe and stop subscribe of dedicated events and methods.</p></blockquote><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè½¯ä»¶ç»„ä»¶å¯ä»¥å‘ BSWM å‘é€æ¨¡å¼è¯·æ±‚ï¼Œä»¥ä¾¿è®¢é˜…å’Œåœæ­¢è®¢é˜…ä¸“ç”¨äº‹ä»¶å’Œæ–¹æ³•</p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823152819401.png" alt="image-20240823152819401"></p><blockquote><p>Figure 7.7 shows the chain that builds up an event subscription request in case (SomeIP) Service Discovery is used. The elements in gray color are configured elements.</p></blockquote><p>å›¾ 7.7 æ˜¾ç¤ºäº†åœ¨ä½¿ç”¨ (SomelP) Service Discovery æ—¶ç”Ÿæˆäº‹ä»¶è®¢é˜…è¯·æ±‚çš„é“¾ã€‚ç°è‰²å…ƒç´ æ˜¯é…ç½®å…ƒç´ ã€‚</p><blockquote><p>The corresponding request port (SWC_P1_Req) can be deduced by evaluating the portgroup reference which references the application events (here Ev1).</p></blockquote><p>é€šè¿‡è¯„ä¼°å¼•ç”¨åº”ç”¨ç¨‹åºäº‹ä»¶çš„ç«¯å£ç»„å¼•ç”¨ (è¿™é‡Œ Ev1)ï¼Œå¯ä»¥æ¨å¯¼å‡ºç›¸åº”çš„è¯·æ±‚ç«¯å£ (SWC_P1_Req)</p><blockquote><p>The relation between application events to the corresponding SD Events (here Ev1 in Eventgroup1) is available by means of the Ecu Configuration.</p></blockquote><p>åº”ç”¨ç¨‹åºäº‹ä»¶ä¸å¯¹åº”çš„ SD äº‹ä»¶ (è¿™é‡Œæ˜¯ Eventgroup1) ä¸­çš„ EV1) ä¹‹é—´çš„å…³ç³»å¯ä»¥é€šè¿‡ Ecu é…ç½®æ¥å®ç°ã€‚</p><p><strong>Client Service/Event Subscription state notification</strong></p><blockquote><p>A software-component that acts as a client and is interested in the subscription status for the events and methods exposes an RPortPrototype typed by a ModeSwitchInterface.</p></blockquote><p>ä½œä¸ºå®¢æˆ·ç«¯å¹¶å¯¹äº‹ä»¶å’Œæ–¹æ³•çš„è®¢é˜…çŠ¶æ€æ„Ÿå…´è¶£çš„è½¯ä»¶ç»„ä»¶é€šè¿‡ ModeSwitchInterface å…¬å¼€ RPortPrototype .</p><blockquote><p>By this means the software-component can be notified by the BswM whether a subscription is in place.</p></blockquote><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒBSwM å¯ä»¥é€šçŸ¥è½¯ä»¶ç»„ä»¶æ˜¯å¦å·²è®¢é˜…ã€‚</p><p><strong>Server Service Offer Request</strong></p><blockquote><p>A software-component that implements the server functionality acts as a mode requester and exposes a PPortPrototype typed by a SenderReceiverInterface.</p></blockquote><p>å®ç°æœåŠ¡å™¨åŠŸèƒ½çš„è½¯ä»¶ç»„ä»¶å……å½“æ¨¡å¼è¯·æ±‚å™¨ï¼Œå¹¶å…¬å¼€ç”± SenderReceiverInterface é”®å…¥çš„ PPortPrototype.</p><blockquote><p>By this means, the software-component can send mode requests towards the BswM in order to offer and stop offer that service instance.</p></blockquote><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè½¯ä»¶ç»„ä»¶å¯ä»¥å‘ BsWM å‘é€æ¨¡å¼è¯·æ±‚ï¼Œä»¥æä¾›å’Œåœæ­¢æä¾›è¯¥æœåŠ¡å®ä¾‹ã€‚</p><blockquote><p>On the side of the BswM, a RPortPrototypetyped by the same SenderReceiver-Interface is used to requests for mode switches.</p></blockquote><p>åœ¨ BswM çš„å¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ª RPort åŸå‹ç”±ç›¸åŒçš„å‘é€æ–¹æ¥æ”¶æ–¹æ¥å£ç±»å‹ç”¨äºè¯·æ±‚æ¨¡å¼åˆ‡æ¢ã€‚</p><blockquote><p>Unlike the client use cases, the server service offer is only allowed by one port, that means that per instance of a service only one single port is supported.</p></blockquote><p>ä¸å®¢æˆ·ç«¯ç”¨ä¾‹ä¸åŒï¼ŒæœåŠ¡å™¨æœåŠ¡æä¾›åªå…è®¸ä¸€ä¸ªç«¯å£ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæœåŠ¡å®ä¾‹åªæ”¯æŒä¸€ä¸ªå•ç‹¬çš„ç«¯å£ã€‚</p><p><strong>Server Service/Event Subscription State Notification</strong></p><blockquote><p>A server instance sending events or field notifications might not need to produce and send those events if there are no subscriptions for that server instance events.</p></blockquote><p>å¦‚æœæ²¡æœ‰å¯¹æœåŠ¡å™¨å®ä¾‹äº‹ä»¶çš„è®¢é˜…ï¼Œå‘é€äº‹ä»¶æˆ–å­—æ®µé€šçŸ¥çš„æœåŠ¡å™¨å®ä¾‹å¯èƒ½ä¸éœ€è¦ç”Ÿæˆå’Œå‘é€è¿™äº›äº‹ä»¶ã€‚</p><blockquote><p>In order to notify the server instance whether there is at least one subscriber interested in the serverâ€™s events a ModeSwitchInterface is available to receive the subscription notifications.</p></blockquote><p>ä¸ºäº†é€šçŸ¥æœåŠ¡å™¨å®ä¾‹æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªè®¢é˜…è€…å¯¹æœåŠ¡å™¨çš„äº‹ä»¶æ„Ÿå…´è¶£ï¼ŒModeSwitchInterface å¯ç”¨æ¥æ¥æ”¶è®¢é€šçŸ¥ã€‚</p><blockquote><p>A software-component that acts as a server and is interested in the subscription status for the service instance events exposes an RPortPrototype typed by a ModeSwitch Interface.</p></blockquote><p>ä½œä¸ºæœåŠ¡å™¨å¹¶æ„Ÿå…´è¶£äºæœåŠ¡å®ä¾‹äº‹ä»¶çš„è®¢é˜…çŠ¶æ€çš„è½¯ä»¶ç»„ä»¶å…¬å¼€äº†ç”± ModeSwitch æ¥å£ç±»å‹åŒ–çš„ RPortPrototype .</p><blockquote><p>By this means, the software-component can be notified by the BswM on subscription changes.</p></blockquote><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒBSWM å¯ä»¥å°±è®¢é˜…å˜æ›´é€šçŸ¥è½¯ä»¶ç»„ä»¶ã€‚</p><p><strong>Connecting ports at configuration time</strong></p><h2 id="9-sequence-diagrams"><a class="anchor" href="#9-sequence-diagrams">#</a> 9 Sequence diagrams</h2><p><strong>Deferred operation of BswM</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823161524797.png" alt="image-20240823161524797"></p><p><strong>Immediate operation of BswM</strong></p><p><img data-src="../../../img.assets/24-08-31%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6%E4%B9%A0AutoSar%E7%B3%BB%E5%88%97%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%87%EF%BC%883%EF%BC%89ModeManagement/image-20240823161555207.png" alt="image-20240823161555207"></p><p>ç»“æŸå•¦å®ï¼ç¡è§‰ğŸ›ï¸</p><div class="tags"><a href="/tags/AUTOSAR/" rel="tag"><i class="ic i-tag"></i> AUTOSAR</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-09-22 10:34:00" itemprop="dateModified" datetime="2024-09-22T10:34:00+08:00">2024-09-22</time> </span><span id="archives/c9ca48bd.html" class="item leancloud_visitors" data-flag-title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement" title="é˜…è¯»æ¬¡æ•°"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">é˜…è¯»æ¬¡æ•°</span> <span class="leancloud-visitors-count"></span> <span class="text">æ¬¡</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="flechazo å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/images/alipay.png" alt="flechazo æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div><div><img data-src="/images/paypal.png" alt="flechazo è´å®"><p>è´å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>flechazo <i class="ic i-at"><em>@</em></i>æˆ‘åœ¨äººé—´è´©å–é»„æ˜ï¼Œåªä¸ºæ”¶é›†ä¸–é—´æ¸©æŸ”é‡è§ä½ .</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://flechazoclf.github.io/FlechazoCLF.github.io/archives/c9ca48bd.html" title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement">https://flechazoclf.github.io/FlechazoCLF.github.io/archives/c9ca48bd.html</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/archives/38a44ca9.html" itemprop="url" rel="prev" data-background-image="/archives/38a44ca9.html../../../wallpaper/6.png" title="åŒ»é™¢æ£€æŸ¥èº«ä½“å•å­è®°å½•"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> è‡ªæˆ‘æå‡</span><h3>åŒ»é™¢æ£€æŸ¥èº«ä½“å•å­è®°å½•</h3></a></div><div class="item right"><a href="/archives/47a7fa40.html" itemprop="url" rel="next" data-background-image="/archives/47a7fa40.html../../../wallpaper/7.png" title="å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸€ã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€çŸ¥è¯†ï¼ˆ6ï¼‰å¯é æ€§ä¸ç³»ç»Ÿæ€§èƒ½è¯„æµ‹åŸºç¡€"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> åµŒå…¥å¼</span><h3>å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸€ã€è®¡ç®—æœºç³»ç»ŸåŸºç¡€çŸ¥è¯†ï¼ˆ6ï¼‰å¯é æ€§ä¸ç³»ç»Ÿæ€§èƒ½è¯„æµ‹åŸºç¡€</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E6%9F%B4%E5%B8%A6%E4%BD%A0%E5%AD%A6autosar%E7%B3%BB%E5%88%97%E4%B8%89-%E6%A0%87%E5%87%86%E5%92%8C%E8%A7%84%E8%8C%83%E7%AF%873modemanagement"><span class="toc-number">1.</span> <span class="toc-text">å°æŸ´å¸¦ä½ å­¦ AutoSar ç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#modemanagementguide"><span class="toc-number">2.</span> <span class="toc-text">ModeManagementGuide</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-overall-mechanisms-and-concepts"><span class="toc-number">2.1.</span> <span class="toc-text">2 Overall mechanisms and concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-declaration-of-modes"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1 Declaration of modes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-mode-managers-and-mode-users"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.2 Mode managers and mode users</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-modes-in-the-rte"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.3 Modes in the RTE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-modes-in-the-basic-software-scheduler"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.4 Modes in the Basic Software Scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-communication-of-modes"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.5 Communication of modes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-configuration-of-the-basic-software-modemanager"><span class="toc-number">2.2.</span> <span class="toc-text">3 Configuration of the Basic Software Modemanager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#32-semantics-of-bswm-configuration-interfaces-and-behavioral-aspects"><span class="toc-number">2.2.1.</span> <span class="toc-text">3.2 Semantics of BswM Configuration: Interfaces and behavioral aspects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-ecu-state-management"><span class="toc-number">2.2.2.</span> <span class="toc-text">3.3 ECU state management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-communication-management"><span class="toc-number">2.2.3.</span> <span class="toc-text">3.4 Communication Management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-diagnostics"><span class="toc-number">2.2.4.</span> <span class="toc-text">3.5 Diagnostics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-bswm-to-bswm-interaction-on-multicore-ecus"><span class="toc-number">2.2.5.</span> <span class="toc-text">3.6 BswM to BswM interaction on multicore ECUs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-inter-partition-actions"><span class="toc-number">2.2.6.</span> <span class="toc-text">3.7 Inter-partition Actions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-inter-partition-requestsindications"><span class="toc-number">2.2.7.</span> <span class="toc-text">3.8 Inter-partition Requests/Indications</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#modemanagement"><span class="toc-number">3.</span> <span class="toc-text">ModeManagement</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-scope-of-document"><span class="toc-number">3.1.</span> <span class="toc-text">1 Scope of Document</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-requirements-specification"><span class="toc-number">3.2.</span> <span class="toc-text">4 Requirements Specification</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-ecu-state-manager-ecum"><span class="toc-number">3.2.1.</span> <span class="toc-text">4.1 ECU State Manager (EcuM)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-watchdog-manager"><span class="toc-number">3.2.2.</span> <span class="toc-text">4.2 Watchdog Manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-communication-manager"><span class="toc-number">3.2.3.</span> <span class="toc-text">4.3 Communication Manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-basic-software-mode-manager"><span class="toc-number">3.2.4.</span> <span class="toc-text">4.4 Basic Software Mode Manager</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecustatemanager"><span class="toc-number">4.</span> <span class="toc-text">ECUStateManager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-introduction-and-functional-overview"><span class="toc-number">4.1.</span> <span class="toc-text">1 Introduction and Functional Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-functional-specification"><span class="toc-number">4.2.</span> <span class="toc-text">7 Functional Specification</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-phases-of-the-ecu-manager-module"><span class="toc-number">4.2.1.</span> <span class="toc-text">7.1 Phases of the ECU Manager Module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-structural-description-of-the-ecu-manager"><span class="toc-number">4.2.2.</span> <span class="toc-text">7.2 Structural Description of the ECU Manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#73-startup-phase"><span class="toc-number">4.2.3.</span> <span class="toc-text">7.3 STARTUP Phase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#74-shutdown-phase"><span class="toc-number">4.2.4.</span> <span class="toc-text">7.4 SHUTDOWN Phase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#75-sleep-phase"><span class="toc-number">4.2.5.</span> <span class="toc-text">7.5 SLEEP Phase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#76-up-phase"><span class="toc-number">4.2.6.</span> <span class="toc-text">7.6 UP Phase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#77-shutdown-targets"><span class="toc-number">4.2.7.</span> <span class="toc-text">7.7 Shutdown Targets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#78-alarm-clock"><span class="toc-number">4.2.8.</span> <span class="toc-text">7.8 Alarm Clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#79-multicore"><span class="toc-number">4.2.9.</span> <span class="toc-text">7.9 MultiCore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#710-ecum-mode-handling"><span class="toc-number">4.2.10.</span> <span class="toc-text">7.10 EcuM Mode Handling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#711-advanced-topics"><span class="toc-number">4.2.11.</span> <span class="toc-text">7.11 Advanced Topics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#712-errorhook"><span class="toc-number">4.2.12.</span> <span class="toc-text">7.12 ErrorHook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#713-error-classification"><span class="toc-number">4.2.13.</span> <span class="toc-text">7.13 Error classification</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-sequence-charts"><span class="toc-number">4.3.</span> <span class="toc-text">9 Sequence Charts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#91-state-sequences"><span class="toc-number">4.3.1.</span> <span class="toc-text">9.1 State Sequences</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#92-wakeup-sequences"><span class="toc-number">4.3.2.</span> <span class="toc-text">9.2 Wakeup Sequences</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bswmodemanager"><span class="toc-number">5.</span> <span class="toc-text">BSWModeManager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-introduction-and-functional-overview-2"><span class="toc-number">5.1.</span> <span class="toc-text">1 Introduction and functional overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-dependencies-to-other-modules"><span class="toc-number">5.2.</span> <span class="toc-text">5 Dependencies to other modules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-functional-specification-2"><span class="toc-number">5.3.</span> <span class="toc-text">7 Functional specification</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mode-arbitration"><span class="toc-number">5.3.1.</span> <span class="toc-text">Mode Arbitration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mode-control"><span class="toc-number">5.3.2.</span> <span class="toc-text">Mode Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waiting-functionality"><span class="toc-number">5.3.3.</span> <span class="toc-text">Waiting Functionality</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multi-partition-support"><span class="toc-number">5.3.4.</span> <span class="toc-text">Multi Partition Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#error-classification"><span class="toc-number">5.3.5.</span> <span class="toc-text">Error classification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bswm-interfaces-and-ports"><span class="toc-number">5.3.6.</span> <span class="toc-text">BswM Interfaces and Ports</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ethernet-switch-port-group-switching"><span class="toc-number">5.3.7.</span> <span class="toc-text">Ethernet switch port group switching</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service-discovery-control"><span class="toc-number">5.3.8.</span> <span class="toc-text">Service Discovery Control</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-sequence-diagrams"><span class="toc-number">5.4.</span> <span class="toc-text">9 Sequence diagrams</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/archives/dfcb5141.html" rel="bookmark" title="LDæ–‡ä»¶åœ¨AUTOSARå·¥ç¨‹ä¸­çš„ä½œç”¨å’Œè¯­æ³•è§£æ">LDæ–‡ä»¶åœ¨AUTOSARå·¥ç¨‹ä¸­çš„ä½œç”¨å’Œè¯­æ³•è§£æ</a></li><li><a href="/archives/cbed58a6.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSaræ€»ç›®å½•">å°æŸ´å¸¦ä½ å­¦AutoSaræ€»ç›®å½•</a></li><li><a href="/archives/b20010d9.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ1ï¼‰æ¦‚å¿µå’Œç›®æ ‡">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ1ï¼‰æ¦‚å¿µå’Œç›®æ ‡</a></li><li><a href="/archives/e0c2534f.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ5ï¼‰CommunicationManagement">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ5ï¼‰CommunicationManagement</a></li><li><a href="/archives/e8a5cc27.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ2ï¼‰AutoSaræ¶æ„">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ2ï¼‰AutoSaræ¶æ„</a></li><li><a href="/archives/e8bc299.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ5ï¼‰makefileåŸºç¡€">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ5ï¼‰makefileåŸºç¡€</a></li><li><a href="/archives/5e71c9a6.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ3ï¼‰Cè¯­è¨€åŸºç¡€">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ3ï¼‰Cè¯­è¨€åŸºç¡€</a></li><li><a href="/archives/7cac95ec.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ4ï¼‰ç¼–è¯‘">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ4ï¼‰ç¼–è¯‘</a></li><li><a href="/archives/3c7f112.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ6ï¼‰è½¦è§„çº§MCUå…¥é—¨RH850">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ6ï¼‰è½¦è§„çº§MCUå…¥é—¨RH850</a></li><li><a href="/archives/3f4a19e2.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ7ï¼‰æœ¯è¯­">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ7ï¼‰æœ¯è¯­</a></li><li><a href="/archives/962e9003.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ1ï¼‰General">å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ1ï¼‰General</a></li><li><a href="/archives/db4ff6ff.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ2ï¼‰BSWGeneral">å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ2ï¼‰BSWGeneral</a></li><li class="active"><a href="/archives/c9ca48bd.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement">å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ3ï¼‰ModeManagement</a></li><li><a href="/archives/fd244a42.html" rel="bookmark" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ4ï¼‰RTE">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ4ï¼‰RTE</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="flechazo" data-src="/images/avatar.jpg"><p class="name" itemprop="name">flechazo</p><div class="description" itemprop="description">æˆ‘åœ¨äººé—´è´©å–æ˜Ÿå…‰</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">192</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">44</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">41</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Fnb25pMzdD" title="https://github.com/Agoni37C"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9qaXVfc2hlbmc=" title="https://www.zhihu.com/people/jiu_sheng"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvcGxheWxpc3Q/aWQ9NzE3NTI4NzIwNQ==" title="https://music.163.com/#/playlist?id=7175287205"><i class="ic i-cloud-music"></i></span> <span class="exturl item weixin" data-url="aHR0cDovL21wLndlaXhpbi5xcS5jb20vbXAvaG9tZXBhZ2U/X19iaXo9TXpBeE9ETTJOVFEwTnc9PSZoaWQ9MiZzbj05ZThkZGVkOGU3MTgxYTA4YTA1MjFiOTQ2MjIyY2Q3MiZzY2VuZT0xOCN3ZWNoYXRfcmVkaXJlY3Q=" title="http://mp.weixin.qq.com/mp/homepage?__biz=MzAxODM2NTQ0Nw==&amp;hid=2&amp;sn=9e8dded8e7181a08a0521b946222cd72&amp;scene=18#wechat_redirect"><i class="ic i-address-card"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDQxODc1ODQ0P3NwbV9pZF9mcm9tPTMzMy4xMDA3LjAuMA==" title="https://space.bilibili.com/441875844?spm_id_from=333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDAwLw=="><i class="ic i-home"></i>é¦–é¡µ</span></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äº</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>å°ä¼™ä¼´ä»¬</a></li><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDAxLw=="><i class="ic i-magic"></i>å¯¼èˆªé¡µğŸš€</span></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>å°å¤©åœ°ğŸ¼</a><ul class="submenu"><li class="item"><a href="/broken-thoughts/" rel="section"><i class="ic i-heart"></i>ç¢ç¢å¿µ</a></li><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDAyLw=="><i class="ic i-heart"></i>äº‘å°ğŸªç›˜</span></li><li class="item"><a href="/mypages/Videoparse/" rel="section"><i class="ic i-heart"></i>è§†é¢‘è§£æ</a></li><li class="item"><a href="/movies/" rel="section"><i class="ic i-heart"></i>å½±é›†</a></li><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDA5Lw=="><i class="ic i-heart"></i>æ¸¸æˆğŸ®å°ç«™</span></li><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDA2Lw=="><i class="ic i-heart"></i>åŠ¨æ„Ÿå¤©åœ°ğŸ¶</span></li><li class="item"><span class="exturl" data-url="aHR0cDovLzEyMS4zNy4xNi4zMDo4MDAzLw=="><i class="ic i-heart"></i>4kå£çº¸â„</span></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æœ‰è¶£å•é¡µ</a><ul class="submenu"><li class="item"><a href="/mypageslayout/barrage/" rel="section"><i class="ic i-list-alt"></i>å¼¹å¹•å¢™</a></li><li class="item"><a href="/mypages/crossing-the-cliff/" rel="section"><i class="ic i-th"></i>åœ£è¯è€äººè¿‡æ¡¥</a></li><li class="item"><a href="/mypages/eat/" rel="section"><i class="ic i-tags"></i>ä»Šå¤©åƒä»€ä¹ˆ</a></li><li class="item"><a href="/mypages/clock/" rel="section"><i class="ic i-list-alt"></i>å¥½çœ‹çš„é—¹é’Ÿ</a></li><li class="item"><a href="/mypages/QQpage/" rel="section"><i class="ic i-list-alt"></i>QQå±•ç¤ºé¡µ</a></li><li class="item"><a href="/mypages/jianli/" rel="section"><i class="ic i-th"></i>ç®€å†</a></li><li class="item"><a href="/mypages/love/" rel="section"><i class="ic i-tags"></i>æ‰§å­ä¹‹æ‰‹</a></li><li class="item"><a href="/mypages/tiangou/" rel="section"><i class="ic i-list-alt"></i>èˆ”ç‹—è¯­å½•</a></li><li class="item"><a href="/mypages/washing/" rel="section"><i class="ic i-th"></i>æ´—è¡£æœº</a></li><li class="item"><a href="/mypages/todolist/" rel="section"><i class="ic i-tags"></i>è¡ŒåŠ¨æ¸…å•</a></li><li class="item"><a href="/mypages/yindao2/" rel="section"><i class="ic i-list-alt"></i>å¼•å¯¼é¡µ</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/archives/38a44ca9.html" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/archives/47a7fa40.html" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/QT/" title="åˆ†ç±»äº QT">QT</a></div><span><a href="/archives/d989430a.html" title="ä¸€ç§flashçš„å­˜å‚¨æ–¹å¼,åŸºäºGD25Q64">ä¸€ç§flashçš„å­˜å‚¨æ–¹å¼,åŸºäºGD25Q64</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/AUTOSAR/" title="åˆ†ç±»äº AUTOSAR">AUTOSAR</a></div><span><a href="/archives/962e9003.html" title="å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ1ï¼‰General">å°æŸ´å¸¦ä½ å­¦ä¹ AutoSarç³»åˆ—ä¸‰ã€æ ‡å‡†å’Œè§„èŒƒç¯‡ï¼ˆ1ï¼‰General</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/english/" title="åˆ†ç±»äº english">english</a> <i class="ic i-angle-right"></i> <a href="/categories/english/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E8%8B%B1%E8%AF%AD/" title="åˆ†ç±»äº ä»é›¶å¼€å§‹å­¦è‹±è¯­">ä»é›¶å¼€å§‹å­¦è‹±è¯­</a></div><span><a href="/archives/311979d6.html" title="ğŸ–58ä¸ªæ—¥å¸¸å®¶ç”µå•è¯">ğŸ–58ä¸ªæ—¥å¸¸å®¶ç”µå•è¯</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%B8%88/" title="åˆ†ç±»äº åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆ">åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆ</a></div><span><a href="/archives/c3251f5b.html" title="å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸‰ã€åµŒå…¥å¼ç¡¬ä»¶è®¾è®¡ï¼ˆ1ï¼‰åµŒå…¥å¼ç³»ç»Ÿç”µæºç®¡ç†">å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸‰ã€åµŒå…¥å¼ç¡¬ä»¶è®¾è®¡ï¼ˆ1ï¼‰åµŒå…¥å¼ç³»ç»Ÿç”µæºç®¡ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/QT/" title="åˆ†ç±»äº QT">QT</a></div><span><a href="/archives/dec6794a.html" title="QTç»™è¾“å…¥æ¡†æ·»åŠ è‡ªåŠ¨è¡¥å…¨æç¤ºè¯">QTç»™è¾“å…¥æ¡†æ·»åŠ è‡ªåŠ¨è¡¥å…¨æç¤ºè¯</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/blog/" title="åˆ†ç±»äº blogğŸŒ®">blogğŸŒ®</a> <i class="ic i-angle-right"></i> <a href="/categories/blog/hexo/" title="åˆ†ç±»äº hexo">hexo</a></div><span><a href="/archives/2b388030.html" title="markdownè¯­æ³•æ±‡æ€»">markdownè¯­æ³•æ±‡æ€»</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/C%E8%AF%AD%E8%A8%80/" title="åˆ†ç±»äº Cè¯­è¨€">Cè¯­è¨€</a></div><span><a href="/archives/48b3f971.html" title="Cè¯­è¨€defineçš„éªšæ“ä½œ">Cè¯­è¨€defineçš„éªšæ“ä½œ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/AUTOSAR/" title="åˆ†ç±»äº AUTOSAR">AUTOSAR</a></div><span><a href="/archives/3f4a19e2.html" title="å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ7ï¼‰æœ¯è¯­">å°æŸ´å¸¦ä½ å­¦AutoSarç³»åˆ—ä¸€ã€åŸºç¡€çŸ¥è¯†ç¯‡ï¼ˆ7ï¼‰æœ¯è¯­</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/C%E8%AF%AD%E8%A8%80/" title="åˆ†ç±»äº Cè¯­è¨€">Cè¯­è¨€</a></div><span><a href="/archives/8ef5993a.html" title="cè¯­è¨€å¼‚æˆ–çš„å¦™ç”¨">cè¯­è¨€å¼‚æˆ–çš„å¦™ç”¨</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/technique/" title="åˆ†ç±»äº æŠ€æœ¯æ•™ç¨‹ğŸƒ">æŠ€æœ¯æ•™ç¨‹ğŸƒ</a> <i class="ic i-angle-right"></i> <a href="/categories/technique/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E5%B8%88/" title="åˆ†ç±»äº åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆ">åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆ</a></div><span><a href="/archives/3b468ee7.html" title="å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸‰ã€åµŒå…¥å¼ç¡¬ä»¶è®¾è®¡ï¼ˆ2ï¼‰ç”µå­ç”µè·¯è®¾è®¡">å°æŸ´å†²åˆºè½¯è€ƒä¸­çº§åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡å¸ˆç³»åˆ—ä¸‰ã€åµŒå…¥å¼ç¡¬ä»¶è®¾è®¡ï¼ˆ2ï¼‰ç”µå­ç”µè·¯è®¾è®¡</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">Â© 2020 â€“ <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">flechazo @ flechazo</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="ç«™ç‚¹æ€»å­—æ•°">906k å­—</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">13:44</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> &amp; Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL={path:"archives/c9ca48bd.html",favicon:{show:"flechazo",hide:"(Â´Ğ”ï½€)å®¢å®˜åˆ«èµ°ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html><!-- rebuild by hrmmi -->